<!-- HTML header for doxygen 1.9.7-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="$langISO">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Infrared: Graph coloring</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<!-- $darkmode -->
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="style.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript">
  DoxygenAwesomeDarkModeToggle.init()
</script>
<script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript">
  DoxygenAwesomeInteractiveToc.init()
</script>
<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript">
  DoxygenAwesomeParagraphLink.init()
</script>
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript">
  DoxygenAwesomeFragmentCopyButton.init()
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Infrared
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_Doc_Examples_GraphColoring.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Graph coloring </div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md83">Online resources and software environment</a></li>
<li class="level1"><a href="#autotoc_md85">The graph coloring problem</a></li>
<li class="level1"><a href="#autotoc_md86">Modeling in Infrared</a></li>
<li class="level1"><a href="#autotoc_md87">Drawing the dependency graph of the model</a></li>
<li class="level1"><a href="#autotoc_md88">Plotting the tree decomposition</a></li>
<li class="level1"><a href="#autotoc_md89">Interpreting assignents (as colorings)</a><ul><li class="level2"><a href="#autotoc_md90">Conversion of assignments to coloring dictionaries</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md91">Generating colorings</a><ul><li class="level2"><a href="#autotoc_md92">Retreiving a best coloring</a></li>
<li class="level2"><a href="#autotoc_md93">Sampling of colorings</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md94">Plotting colorings</a></li>
</ul>
</div>
<div class="textblock"><hr  />
 <h1><a class="anchor" id="autotoc_md83"></a>
Online resources and software environment</h1>
<p >This document is hosted online as <a href="https://www.lix.polytechnique.fr/~will/Software/Infrared/current/Doc/GraphColoring.ipynb">Jupyter notebook</a> with precomputed results. Download this file to view, edit and run examples in Jupyter.</p>
<p >We recommend to install all required software using Mamba (or Conda) and PIP. </p><div class="fragment"><div class="line">mamba create -n infrared -c conda-forge infrared jupyter jupytext matplotlib seaborn graphviz</div>
<div class="line">mamba activate infrared</div>
<div class="line">pip install graphviz</div>
<div class="line">mamba deactivate infrared</div>
</div><!-- fragment --><p >Start the Jupyter notebook server after activating the environment </p><div class="fragment"><div class="line">mamba activate infrared</div>
<div class="line">jupyter notebook</div>
</div><!-- fragment --><p> The <a href="https://gitlab.inria.fr/amibio/Infrared/-/tree/master/Doc/Examples">original sources</a> are part of the Infrared distribution and hosted on Gitlab (in Jupytext light Script format).</p>
<hr  />
<h1><a class="anchor" id="autotoc_md85"></a>
The graph coloring problem</h1>
<p >As a toy example for the use of Infrared, we model (a small instance) of graph coloring. The graph coloring model defines variables for the graph nodes, whose possible values are the colors. Furthermore, we define inequality constraints for every edge, to ensure that connected nodes receive different colors in valid solutions.</p>
<p >This model is then extended by an objective function that counts the different colors in cycles of size four. From the model, we create an Infrared solver to find optimal solutions.</p>
<p >For instructional purposes, we furthermore show the dependency graph of the model and the tree decomposition used by the solver.</p>
<div class="fragment"><div class="line"><span class="keyword">import</span> infrared <span class="keyword">as</span> ir</div>
<div class="line"> </div>
<div class="line"><span class="comment"># specify the graph coloring instance</span></div>
<div class="line">numcolors = 4 <span class="comment"># colors 0..3</span></div>
<div class="line">numnodes = 9 <span class="comment"># nodes 1..9</span></div>
<div class="line">edges = [(1,5),(2,3),(2,5),(2,7),(3,6),(5,6),(5,7),(5,8),(5,9),(6,8),(6,9),(7,8)]</div>
<div class="line"> </div>
<div class="line"><span class="comment"># recall that we extend the standard graph coloring problem by counting different colors in cycles</span></div>
<div class="line">cycles = [(2,3,5,6),(2,5,7,8),(5,6,7,8),(5,6,8,9)]</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md86"></a>
Modeling in Infrared</h1>
<p >Setup the model and construct a solver. Report the treewidth.</p>
<div class="fragment"><div class="line">model = ir.Model()</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Note: to keep this example simple, we add a dummy variable</span></div>
<div class="line"><span class="comment"># with index 0. In this way, we can use the 1-based node indices</span></div>
<div class="line"><span class="comment"># as variable indices (without the need for index transformations)</span></div>
<div class="line">model.add_variables(1,(0,0))</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Add one variable per node</span></div>
<div class="line">model.add_variables(numnodes,numcolors)</div>
<div class="line"> </div>
<div class="line"><span class="comment"># define NotEquals constraints in Python</span></div>
<div class="line">ir.def_constraint_class(<span class="stringliteral">&#39;NotEquals&#39;</span>,</div>
<div class="line">    <span class="keyword">lambda</span> i,j: [i,j], <span class="comment"># signature and dependencies</span></div>
<div class="line">    <span class="keyword">lambda</span> x, y: x!=y)  <span class="comment"># constraint semantics</span></div>
<div class="line"> </div>
<div class="line"><span class="comment"># add one inequality constraint per edge </span></div>
<div class="line">model.add_constraints(NotEquals(i,j) <span class="keywordflow">for</span> i,j <span class="keywordflow">in</span> edges)</div>
<div class="line"> </div>
<div class="line"><span class="comment"># define cardinality for sets of 4 variables</span></div>
<div class="line">ir.def_function_class(<span class="stringliteral">&#39;Card&#39;</span>, <span class="comment"># define &quot;cardinality&quot;</span></div>
<div class="line">    <span class="keyword">lambda</span> i, j, k, l: [i,j,k,l], <span class="comment"># signature, dependencies</span></div>
<div class="line">    <span class="keyword">lambda</span> x,y,z,w: len({x,y,z,w}))  <span class="comment"># function evaluation</span></div>
<div class="line"> </div>
<div class="line"><span class="comment"># add the cardinality function for every cycle</span></div>
<div class="line">model.add_functions([Card(i,j,k,l) <span class="keywordflow">for</span> i,j,k,l <span class="keywordflow">in</span> cycles], <span class="stringliteral">&#39;card&#39;</span>)</div>
<div class="line"> </div>
<div class="line">model.set_feature_weight(-1,<span class="stringliteral">&#39;card&#39;</span>) <span class="comment"># set up in order to *minimize*</span></div>
<div class="line"> </div>
<div class="line">solver = ir.Optimizer(model)</div>
<div class="line">print(f<span class="stringliteral">&#39;Tree width: {solver.treewidth()}&#39;</span>)</div>
</div><!-- fragment --> <pre class="fragment">Tree width: 4
</pre><h1><a class="anchor" id="autotoc_md87"></a>
Drawing the dependency graph of the model</h1>
<p >Please ignore the dummy node 0 - we don't suppress it to keep things simple. Otherwise, the dependency graph is identical to the input graph as specified above.</p>
<div class="fragment"><div class="line"><span class="keyword">from</span> IPython.display <span class="keyword">import</span> Image</div>
<div class="line"><span class="keyword">import</span> re</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Plot dependency graph</span></div>
<div class="line">filename = <span class="stringliteral">&#39;dependency_graph.dot&#39;</span></div>
<div class="line">model.write_graph(filename, <span class="keyword">True</span>)</div>
<div class="line"> </div>
<div class="line">ir.dotfile_to_png(filename)</div>
<div class="line">filename = re.sub(<span class="stringliteral">r&quot;dot$&quot;</span>,<span class="stringliteral">&quot;png&quot;</span>,filename)</div>
<div class="line"> </div>
<div class="line">Image(filename=filename,width=300)</div>
</div><!-- fragment --><p ><img src="GraphColoring_files/GraphColoring_7_0.png" alt="png" class="inline"/></p>
<h1><a class="anchor" id="autotoc_md88"></a>
Plotting the tree decomposition</h1>
<p >This shows the tree decomposition of the dependency graph that is internally generated by the solver as basis for the efficient computation.</p>
<div class="fragment"><div class="line">filename=<span class="stringliteral">&quot;treedecomp&quot;</span></div>
<div class="line">solver.plot_td(filename,<span class="stringliteral">&#39;png&#39;</span>)</div>
<div class="line">Image(filename=filename+<span class="stringliteral">&quot;.png&quot;</span>,width=400)</div>
</div><!-- fragment --><p ><img src="GraphColoring_files/GraphColoring_9_0.png" alt="png" class="inline"/></p>
<h1><a class="anchor" id="autotoc_md89"></a>
Interpreting assignents (as colorings)</h1>
<h2><a class="anchor" id="autotoc_md90"></a>
Conversion of assignments to coloring dictionaries</h2>
<p >Note that the engine returns solutions as (variable to value) assignments. Since the interpretation of such assignments is typically problem-specific, it is left to the user. To display it, we translate the assignment into a printable dictionary (and remove the dummy variable).</p>
<div class="fragment"><div class="line"><span class="keyword">def </span>assignment_to_coloring(a):</div>
<div class="line">        colors=[<span class="stringliteral">&quot;red&quot;</span>,<span class="stringliteral">&quot;cyan&quot;</span>,<span class="stringliteral">&quot;yellow&quot;</span>,<span class="stringliteral">&quot;orange&quot;</span>,<span class="stringliteral">&quot;magenta&quot;</span>,<span class="stringliteral">&quot;green&quot;</span>,<span class="stringliteral">&quot;blue&quot;</span>,<span class="stringliteral">&quot;grey&quot;</span>]</div>
<div class="line">        coloring = {i:colors[v] <span class="keywordflow">for</span> i,v <span class="keywordflow">in</span> enumerate(a.values())}</div>
<div class="line">        del coloring[0]</div>
<div class="line">        <span class="keywordflow">return</span> coloring</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md91"></a>
Generating colorings</h1>
<h2><a class="anchor" id="autotoc_md92"></a>
Retreiving a best coloring</h2>
<div class="fragment"><div class="line">solver = ir.Optimizer(model)</div>
<div class="line">best_assignment = solver.optimize()</div>
<div class="line">best_coloring = assignment_to_coloring(best_assignment)</div>
<div class="line"> </div>
<div class="line">print(<span class="stringliteral">&#39;Optimal coloring:&#39;</span>, best_coloring)</div>
<div class="line">print(<span class="stringliteral">&#39;Colors in cycles:&#39;</span>, model.eval_feature(best_assignment,<span class="stringliteral">&#39;card&#39;</span>))</div>
</div><!-- fragment --> <pre class="fragment">Optimal coloring: {1: 'red', 2: 'red', 3: 'yellow', 4: 'red', 5: 'yellow', 6: 'cyan', 7: 'cyan', 8: 'red', 9: 'red'}
Colors in cycles: 12
</pre><h2><a class="anchor" id="autotoc_md93"></a>
Sampling of colorings</h2>
<p >Use the weight to control 'optimality'</p>
<div class="fragment"><div class="line">model.set_feature_weight(0,<span class="stringliteral">&#39;card&#39;</span>) <span class="comment"># weight 0: uniform</span></div>
<div class="line">solver = ir.Sampler(model)</div>
<div class="line">assignment = solver.sample()</div>
<div class="line">coloring = assignment_to_coloring(assignment)</div>
<div class="line"> </div>
<div class="line">print(<span class="stringliteral">&#39;Sampled coloring:&#39;</span>, coloring)</div>
<div class="line">print(<span class="stringliteral">&#39;Colors in cycles:&#39;</span>, model.eval_feature(assignment,<span class="stringliteral">&#39;card&#39;</span>))</div>
</div><!-- fragment --> <pre class="fragment">Sampled coloring: {1: 'yellow', 2: 'cyan', 3: 'orange', 4: 'orange', 5: 'orange', 6: 'yellow', 7: 'yellow', 8: 'cyan', 9: 'red'}
Colors in cycles: 13
</pre><h1><a class="anchor" id="autotoc_md94"></a>
Plotting colorings</h1>
<div class="fragment"><div class="line"><span class="keyword">def </span>plot_coloring(coloring):</div>
<div class="line">    <span class="keyword">import</span> graphviz</div>
<div class="line"> </div>
<div class="line">    G = graphviz.Graph(<span class="stringliteral">&#39;coloring&#39;</span>, engine=<span class="stringliteral">&quot;fdp&quot;</span>)</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(1,numnodes+1):</div>
<div class="line">        G.node(f<span class="stringliteral">&#39;{i}&#39;</span>, style=<span class="stringliteral">&quot;filled&quot;</span>, color=coloring[i])</div>
<div class="line">    <span class="keywordflow">for</span> i,j <span class="keywordflow">in</span> edges:</div>
<div class="line">        G.edge(f<span class="stringliteral">&#39;{i}&#39;</span>,f<span class="stringliteral">&#39;{j}&#39;</span>)</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> G</div>
</div><!-- fragment --><div class="fragment"><div class="line">print(cycles)</div>
<div class="line">plot_coloring(best_coloring)</div>
</div><!-- fragment --> <pre class="fragment">[(2, 3, 5, 6), (2, 5, 7, 8), (5, 6, 7, 8), (5, 6, 8, 9)]
</pre><p ><img src="GraphColoring_files/GraphColoring_19_1.svg" alt="svg" style="pointer-events: none;" class="inline"/></p>
<div class="fragment"><div class="line">plot_coloring(coloring)</div>
</div><!-- fragment --><p ><img src="GraphColoring_files/GraphColoring_20_0.svg" alt="svg" style="pointer-events: none;" class="inline"/> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4 </li>
  </ul>
</div>
</body>
</html>
