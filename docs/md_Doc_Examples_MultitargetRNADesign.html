<!-- HTML header for doxygen 1.9.7-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="$langISO">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Infrared: Multitarget RNA Design</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<!-- $darkmode -->
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="style.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript">
  DoxygenAwesomeDarkModeToggle.init()
</script>
<script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript">
  DoxygenAwesomeInteractiveToc.init()
</script>
<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript">
  DoxygenAwesomeParagraphLink.init()
</script>
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript">
  DoxygenAwesomeFragmentCopyButton.init()
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Infrared
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_Doc_Examples_MultitargetRNADesign.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Multitarget RNA Design </div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md156">Online resources and software environment</a></li>
<li class="level1"><a href="#autotoc_md158">RNA design with multiple target structures</a><ul><li class="level2"><a href="#autotoc_md159">Additional software requirements</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md160">Target structures</a></li>
<li class="level1"><a href="#autotoc_md161">Construct the Infrared model</a></li>
<li class="level1"><a href="#autotoc_md162">Some helper functions for showing the outcome of sampling</a></li>
<li class="level1"><a href="#autotoc_md163">Sampling from the design model</a></li>
<li class="level1"><a href="#autotoc_md164">Targeting features by Multi-dimensional Boltzmann sampling</a></li>
<li class="level1"><a href="#autotoc_md165">APPENDIX</a></li>
<li class="level1"><a href="#autotoc_md166">MDBS targeting distribution plots</a></li>
</ul>
</div>
<div class="textblock"><hr  />
<h1><a class="anchor" id="autotoc_md156"></a>
Online resources and software environment</h1>
<p >​</p>
<p >This document is hosted online as <a href="https://www.lix.polytechnique.fr/~will/Software/Infrared/current/Doc/MultitargetRNADesign.ipynb">Jupyter notebook</a> with precomputed results. Download this file to view, edit and run examples in Jupyter.</p>
<p >​</p>
<p >We recommend to install all required software using Mamba (or Conda) and PIP.</p>
<div class="fragment"><div class="line">mamba create -n infrared -c conda-forge infrared jupyter jupytext matplotlib seaborn graphviz</div>
<div class="line"> </div>
<div class="line">mamba activate infrared</div>
<div class="line"> </div>
<div class="line">pip install graphviz</div>
<div class="line"> </div>
<div class="line">mamba deactivate infrared</div>
</div><!-- fragment --><p >​</p>
<p >Start the Jupyter notebook server after activating the environment</p>
<div class="fragment"><div class="line">mamba activate infrared</div>
<div class="line"> </div>
<div class="line">jupyter notebook</div>
</div><!-- fragment --><p >The <a href="https://gitlab.inria.fr/amibio/Infrared/-/tree/master/Doc/Examples">original sources</a> are part of the Infrared distribution and hosted on Gitlab (in Jupytext light Script format).</p>
<p >​</p>
<hr  />
<h1><a class="anchor" id="autotoc_md158"></a>
RNA design with multiple target structures</h1>
<p >In this notebook we model the design of RNA sequences with very specific properties towards multiple targets, i.e. several target secondary structures, and GC content. The resulting functionality and methods are very similar to RNARedprint.</p>
<h2><a class="anchor" id="autotoc_md159"></a>
Additional software requirements</h2>
<p >This notebook needs additional software that can be installed using <code>conda</code> and <code>pip</code> on MacOSX or Linux.</p>
<ul>
<li>Vienna RNA package, <em>install</em> by <code>conda install -c conda-forge -c bioconda viennarna</code></li>
</ul>
<p >The following software/Python modules are optionally used to generate graphical output:</p><ul>
<li>seaborn e.g. <em>install</em> via <code>conda install seaborn</code></li>
<li>VARNA and inkscape to draw target structures: <em>install</em> VARNA (and its Python api) by<ul>
<li><code>pip install varnaapi</code></li>
<li>then, download VARNA (VARNAv3-92.jar or newer, <a href="https://varna.lri.fr/bin/VARNAv3-92.jar">https://varna.lri.fr/bin/VARNAv3-92.jar</a>) and put it into your working directory.</li>
<li><code>conda install inkscape</code></li>
</ul>
</li>
<li>logomaker to draw sequence logos, <em>install</em> by <code>conda install logomaker</code></li>
</ul>
<div class="fragment"><div class="line"><span class="keyword">import</span> sys</div>
<div class="line"><span class="keyword">import</span> subprocess</div>
<div class="line"><span class="keyword">from</span> IPython.display <span class="keyword">import</span> Image, display, SVG</div>
<div class="line"><span class="keyword">import</span> tempfile</div>
<div class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</div>
<div class="line"> </div>
<div class="line"><span class="keyword">import</span> infrared <span class="keyword">as</span> ir</div>
<div class="line"><span class="keyword">from</span> infrared <span class="keyword">import</span> rna</div>
<div class="line"><span class="keyword">import</span> RNA</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">try</span>:</div>
<div class="line">    <span class="keyword">import</span> seaborn <span class="keyword">as</span> sns</div>
<div class="line">    <span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</div>
<div class="line"><span class="keywordflow">except</span>:</div>
<div class="line">    print(<span class="stringliteral">&quot;Get seaborn to draw sample histograms.&quot;</span>)</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">try</span>:</div>
<div class="line">    <span class="keyword">import</span> logomaker</div>
<div class="line"><span class="keywordflow">except</span>:</div>
<div class="line">    print(<span class="stringliteral">&quot;Get logomaker to draw sequence logos.&quot;</span>)</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">try</span>:</div>
<div class="line">    <span class="keyword">import</span> varnaapi</div>
<div class="line"><span class="keywordflow">except</span>:</div>
<div class="line">    print(<span class="stringliteral">&quot;Get VARNA to plot target structures.&quot;</span>)</div>
<div class="line"> </div>
<div class="line"><span class="keyword">import</span> time</div>
<div class="line"><span class="keyword">def </span>report_time(f,desc=&quot;&quot;):</div>
<div class="line">    start=time.time()</div>
<div class="line">    res=f()</div>
<div class="line">    desc = <span class="stringliteral">&quot;&quot;</span> <span class="keywordflow">if</span> desc==<span class="stringliteral">&quot;&quot;</span> <span class="keywordflow">else</span> f<span class="stringliteral">&#39; ({desc})&#39;</span></div>
<div class="line">    print(f<span class="stringliteral">&#39;Time{desc}: {time.time()-start:0.2f}s&#39;</span>)</div>
<div class="line">    <span class="keywordflow">return</span> res</div>
<div class="line">    </div>
<div class="line"><span class="keyword">def </span>has_module(m): <span class="keywordflow">return</span> m <span class="keywordflow">in</span> sys.modules</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md160"></a>
Target structures</h1>
<p >RNA target structures are specified in the form of dot bracket strings (as e.g. used by the Vienna RNA package). Dot-bracket strings are linear representations of RNA secondary structure, mainly used to annotate RNA sequences. They contain one character per sequence position. Each pair of balanced opening and closing brackets specifies one base pair of the secondary structure.</p>
<p >We specify some examples and plot them using VARNA (if it is available).</p>
<div class="fragment"><div class="line"><span class="comment"># our target RNA secondary structure</span></div>
<div class="line">targets = [</div>
<div class="line"><span class="comment">#    012345678901234567890</span></div>
<div class="line">    <span class="stringliteral">&quot;((((...)))).(((...)))&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;((((((......)))...)))&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;......(((...)))......&quot;</span></div>
<div class="line">]</div>
<div class="line"> </div>
<div class="line"><span class="keyword">def </span>plotRNA(structure, sequence=None, filename=None, show=True):</div>
<div class="line">    n=len(structure)</div>
<div class="line">    <span class="keywordflow">if</span> sequence <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line">        sequence = <span class="stringliteral">&#39; &#39;</span>*n</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">if</span> filename <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span> <span class="keywordflow">and</span> <span class="keywordflow">not</span> filename.endswith(<span class="stringliteral">&quot;.svg&quot;</span>):</div>
<div class="line">       filename+=<span class="stringliteral">&quot;.svg&quot;</span> </div>
<div class="line"> </div>
<div class="line">    f = filename</div>
<div class="line">    <span class="keywordflow">if</span> filename <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line">        f = tempfile.NamedTemporaryFile(suffix=<span class="stringliteral">&quot;.svg&quot;</span>)</div>
<div class="line">        filename = f.name</div>
<div class="line">    </div>
<div class="line">    v = varnaapi.Structure(structure=structure,sequence=sequence)</div>
<div class="line">    v.set_algorithm(<span class="stringliteral">&#39;radiate&#39;</span>)</div>
<div class="line">    v.savefig(filename)</div>
<div class="line">    subprocess.run([<span class="stringliteral">&quot;inkscape&quot;</span>, <span class="stringliteral">&quot;-D&quot;</span>, filename, <span class="stringliteral">&quot;--export-overwrite&quot;</span>], capture_output=<span class="keyword">True</span>)</div>
<div class="line">    <span class="keywordflow">if</span> show:</div>
<div class="line">        display(SVG(filename))</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">return</span> f</div>
<div class="line">    </div>
<div class="line"><span class="keywordflow">for</span> i, target <span class="keywordflow">in</span> enumerate(targets):</div>
<div class="line">    print(f<span class="stringliteral">&quot;Target {i}: {target}&quot;</span>)</div>
<div class="line">    <span class="keywordflow">if</span> has_module(<span class="stringliteral">&quot;varnaapi&quot;</span>):</div>
<div class="line">        plotRNA(target)</div>
</div><!-- fragment --> <pre class="fragment">Target 0: ((((...)))).(((...)))
['java', '-cp', 'VARNAv3-93.jar', 'fr.orsay.lri.varna.applications.VARNAcmd', '-sequenceDBN', '                     ', '-structureDBN', '((((...)))).(((...)))', '-o', '/tmp/tmpw1urmqdv.svg']


Output file: /tmp/tmpw1urmqdv.svg
</pre><p ><img src="MultitargetRNADesign_files/MultitargetRNADesign_5_2.svg" alt="svg" style="pointer-events: none;" class="inline"/></p>
<pre class="fragment">Target 1: ((((((......)))...)))
['java', '-cp', 'VARNAv3-93.jar', 'fr.orsay.lri.varna.applications.VARNAcmd', '-sequenceDBN', '                     ', '-structureDBN', '((((((......)))...)))', '-o', '/tmp/tmp_8o4reys.svg']


Output file: /tmp/tmp_8o4reys.svg
</pre><p ><img src="MultitargetRNADesign_files/MultitargetRNADesign_5_5.svg" alt="svg" style="pointer-events: none;" class="inline"/></p>
<pre class="fragment">Target 2: ......(((...)))......
['java', '-cp', 'VARNAv3-93.jar', 'fr.orsay.lri.varna.applications.VARNAcmd', '-sequenceDBN', '                     ', '-structureDBN', '......(((...)))......', '-o', '/tmp/tmpszjzbd3i.svg']


Output file: /tmp/tmpszjzbd3i.svg
</pre><p ><img src="MultitargetRNADesign_files/MultitargetRNADesign_5_8.svg" alt="svg" style="pointer-events: none;" class="inline"/></p>
<h1><a class="anchor" id="autotoc_md161"></a>
Construct the Infrared model</h1>
<div class="fragment"><div class="line"><span class="keyword">def </span>construct_design_model(targets):</div>
<div class="line">    seqlen = len(targets[0])</div>
<div class="line">    </div>
<div class="line">    model = ir.Model()</div>
<div class="line"> </div>
<div class="line">    <span class="comment"># one variable X_i per position i;</span></div>
<div class="line">    <span class="comment"># the value of X_i encodes the nucleotide at position i   </span></div>
<div class="line">    model.add_variables( seqlen, 4 )</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> i,target <span class="keywordflow">in</span> enumerate(targets):</div>
<div class="line">        bps = rna.parse(target)</div>
<div class="line"> </div>
<div class="line">        model.add_constraints( rna.BPComp( i, j ) <span class="keywordflow">for</span> ( i, j ) <span class="keywordflow">in</span> bps )</div>
<div class="line"> </div>
<div class="line">        model.add_functions( [ rna.BPEnergy( i, j, <span class="keyword">False</span> ) </div>
<div class="line">                               <span class="keywordflow">for</span> ( i, j ) <span class="keywordflow">in</span> bps ], group = f<span class="stringliteral">&#39;bpenergy{i}&#39;</span> )</div>
<div class="line"> </div>
<div class="line">        model.add_feature( f<span class="stringliteral">&#39;E{i}&#39;</span>, <span class="comment"># feature name</span></div>
<div class="line">                           f<span class="stringliteral">&#39;bpenergy{i}&#39;</span>, <span class="comment"># controlled group(s)</span></div>
<div class="line">                           <span class="comment">#</span></div>
<div class="line">                           <span class="comment"># function to evaluate the feature for a sample;</span></div>
<div class="line">                           <span class="comment"># NOTE how we have to bind i</span></div>
<div class="line">                           <span class="keyword">lambda</span> sample, i=i: RNA.energy_of_struct( rna.values_to_seq( sample.values() ),</div>
<div class="line">                                                  targets[i] )</div>
<div class="line">                         )</div>
<div class="line"> </div>
<div class="line">    model.add_functions( [ rna.GCCont( i = i ) <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(seqlen) ], group = <span class="stringliteral">&#39;gc&#39;</span> )</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    model.write_graph(<span class="stringliteral">&#39;dependency_graph.dot&#39;</span>, <span class="keyword">True</span>)</div>
<div class="line">    ir.dotfile_to_pdf(<span class="stringliteral">&#39;dependency_graph.dot&#39;</span>)</div>
<div class="line"> </div>
<div class="line">    <span class="comment"># the model generates automatic features &#39;bpenergyI&#39;, &#39;gc&#39; from the function groups;</span></div>
<div class="line">    <span class="comment"># as well as total feature combining all function groups;</span></div>
<div class="line">    <span class="comment"># however, we want to diretly control Turner energy (instead of base pair energy).</span></div>
<div class="line">    <span class="comment"># For this purpose, add additional features &#39;EI&#39;</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> model</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md162"></a>
Some helper functions for showing the outcome of sampling</h1>
<div class="fragment"><div class="line"><span class="keyword">def </span>draw_logo(sequences, filename=None):</div>
<div class="line">    <span class="stringliteral">&quot;&quot;&quot;Draw sequence logo for a set of sequences&quot;&quot;&quot;</span></div>
<div class="line">    <span class="keyword">import</span> logomaker <span class="keyword">as</span> lm</div>
<div class="line">    <span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</div>
<div class="line">        </div>
<div class="line">    matrix = lm.alignment_to_matrix(sequences = sequences)</div>
<div class="line">    logo = lm.Logo(matrix)</div>
<div class="line">    logo.style_xticks(rotation=90, fmt=<span class="stringliteral">&#39;%d&#39;</span>, anchor=0, spacing=5)</div>
<div class="line">    logo.ax.xaxis.set_ticks_position(<span class="stringliteral">&#39;none&#39;</span>)</div>
<div class="line">    <span class="keywordflow">if</span> filename <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>: plt.savefig(filename)</div>
<div class="line">    plt.show()</div>
<div class="line"> </div>
<div class="line"><span class="keyword">def </span>print_sample(design):</div>
<div class="line">    seq = rna.values_to_seq( design.values() )</div>
<div class="line">    print(seq)</div>
<div class="line"> </div>
<div class="line"><span class="keyword">def </span>show_designs(designs, maxdesigns=10, plotlogo=False, plotdist=False, returnresults=False, filename=None):</div>
<div class="line">    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="stringliteral">    Produce report of sequence designs</span></div>
<div class="line"><span class="stringliteral">    Args:</span></div>
<div class="line"><span class="stringliteral">        designs    list of assignments of the design model</span></div>
<div class="line"><span class="stringliteral">        maxdesigns show first maxdesigns designs</span></div>
<div class="line"><span class="stringliteral">        plotlogo   </span><span class="keywordflow">if</span> true, plot logo</div>
<div class="line">    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="stringliteral">    </span></div>
<div class="line"><span class="stringliteral">    sequences = []</span></div>
<div class="line"><span class="stringliteral">    </span></div>
<div class="line"><span class="stringliteral">    statistics = defaultdict(list)</span></div>
<div class="line"><span class="stringliteral">    </span></div>
<div class="line"><span class="stringliteral">    </span><span class="keywordflow">for</span> i,design <span class="keywordflow">in</span> enumerate(designs):</div>
<div class="line">        seq = rna.values_to_seq( design.values() )</div>
<div class="line">        sequences.append(seq)</div>
<div class="line">        </div>
<div class="line">        </div>
<div class="line">        stats = { f<span class="stringliteral">&#39;E{j}&#39;</span>: model.eval_feature(design, f<span class="stringliteral">&#39;E{j}&#39;</span>) <span class="keywordflow">for</span> j <span class="keywordflow">in</span> range(len(targets))}</div>
<div class="line">        stats[<span class="stringliteral">&#39;GC&#39;</span>] = round(model.eval_feature(design, <span class="stringliteral">&#39;gc&#39;</span>)*100/len(seq))</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> k <span class="keywordflow">in</span> stats:</div>
<div class="line">            statistics[k].append(stats[k])</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">if</span> i&lt;maxdesigns:</div>
<div class="line">            print(seq,end=<span class="stringliteral">&quot;&quot;</span>)</div>
<div class="line">            <span class="keywordflow">for</span> k <span class="keywordflow">in</span> stats:</div>
<div class="line">                print(f<span class="stringliteral">&quot; {k}={stats[k]:.2f}&quot;</span>,end=<span class="stringliteral">&quot;&quot;</span>)</div>
<div class="line">            print()</div>
<div class="line">        </div>
<div class="line">    <span class="keywordflow">if</span> maxdesigns&lt;len(designs):</div>
<div class="line">        print(f<span class="stringliteral">&quot;... skip {len(designs)-maxdesigns} designs&quot;</span>)</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">if</span> plotlogo:</div>
<div class="line">        print()</div>
<div class="line">        print(f<span class="stringliteral">&quot;Sequence logo from {len(designs)} sequences:&quot;</span>)</div>
<div class="line">        draw_logo(sequences, </div>
<div class="line">                  filename=filename+<span class="stringliteral">&quot;_logo.svg&quot;</span> <span class="keywordflow">if</span> filename <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span> <span class="keywordflow">else</span> <span class="keywordtype">None</span>)</div>
<div class="line"> </div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">if</span> plotdist:</div>
<div class="line">        fig,axs = plt.subplots(1, 2, figsize=(10, 2.5), width_ratios=[1,2])</div>
<div class="line"> </div>
<div class="line">        <span class="comment"># plot only gc in first histogram</span></div>
<div class="line">        sns.histplot(statistics[<span class="stringliteral">&#39;GC&#39;</span>],ax=axs[0], stat=<span class="stringliteral">&#39;probability&#39;</span>, discrete=<span class="keyword">True</span>, color=[0.8,0.2,0,0.6])</div>
<div class="line">        </div>
<div class="line">        del statistics[<span class="stringliteral">&#39;GC&#39;</span>] <span class="comment"># take out gc for second histogram</span></div>
<div class="line">        </div>
<div class="line">        <span class="comment"># make Ei one based for the plot</span></div>
<div class="line">        statistics = { f<span class="stringliteral">&#39;E{i+1}&#39;</span>: statistics[f<span class="stringliteral">&#39;E{i}&#39;</span>] <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(len(statistics)) }</div>
<div class="line"> </div>
<div class="line">        sns.histplot(statistics, ax=axs[1], stat=<span class="stringliteral">&#39;probability&#39;</span>,</div>
<div class="line">                     palette={<span class="stringliteral">&#39;E1&#39;</span>:[0.0,0.8,0.2,0.5],</div>
<div class="line">                              <span class="stringliteral">&#39;E2&#39;</span>:[0.0,0.3,0.9,0.5],</div>
<div class="line">                              <span class="stringliteral">&#39;E3&#39;</span>:[0.8,0.4,0.1,0.5]}</div>
<div class="line">                    )</div>
<div class="line">        axs[1].set_ylabel(<span class="stringliteral">&quot;&quot;</span>)</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">if</span> filename <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line">            fig.savefig(filename+<span class="stringliteral">&quot;_hist.svg&quot;</span>)</div>
<div class="line">        fig.show()</div>
<div class="line">        </div>
<div class="line">    <span class="keywordflow">if</span> returnresults:</div>
<div class="line">        <span class="keywordflow">return</span> sequences, statistics</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md163"></a>
Sampling from the design model</h1>
<div class="fragment"><div class="line">model = construct_design_model(targets)</div>
<div class="line"> </div>
<div class="line">model.set_feature_weight( -2, <span class="stringliteral">&#39;bpenergy0&#39;</span> )</div>
<div class="line">model.set_feature_weight( -2, <span class="stringliteral">&#39;bpenergy1&#39;</span> )</div>
<div class="line">model.set_feature_weight( -2, <span class="stringliteral">&#39;bpenergy2&#39;</span> )</div>
<div class="line">model.set_feature_weight( -1, <span class="stringliteral">&#39;gc&#39;</span> )</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Sampling at specific weights</span></div>
<div class="line"> </div>
<div class="line">sampler = ir.BoltzmannSampler( model )</div>
<div class="line"> </div>
<div class="line">print( <span class="stringliteral">&quot;Tree width:&quot;</span>, sampler.treewidth() )</div>
<div class="line">print()</div>
<div class="line"> </div>
<div class="line"><span class="comment">#opionally, write plot of tree decomposition to file</span></div>
<div class="line"><span class="comment">#tdfile = &quot;treedecomp.pdf&quot;</span></div>
<div class="line"><span class="comment">#sampler.plot_td(tdfile)</span></div>
<div class="line"> </div>
<div class="line">samples = report_time(<span class="keyword">lambda</span>:[sampler.sample() <span class="keywordflow">for</span> _ <span class="keywordflow">in</span> range(1000)])</div>
<div class="line"> </div>
<div class="line">show_designs(samples,</div>
<div class="line">    plotlogo=has_module(<span class="stringliteral">&quot;logomaker&quot;</span>),</div>
<div class="line">    plotdist=has_module(<span class="stringliteral">&quot;matplotlib&quot;</span>))</div>
</div><!-- fragment --> <pre class="fragment">Tree width: 1

Time: 0.02s
GCGCGCCGCGCGGCGUAUCGU E0=-4.90 E1=-2.60 E2=-1.40 GC=81.00
GCGCGCUGCGCUGCGCAGCGC E0=-5.40 E1=-5.10 E2=0.40 GC=86.00
CGCGCGGCGUGACGCAUAGCG E0=-2.90 E1=-5.50 E2=-1.80 GC=76.00
GCGCGUCGCGUAGCGUUUCGC E0=-3.70 E1=-2.30 E2=-1.10 GC=71.00
CGCGCGGCGUGUCGCUCUGCG E0=-2.00 E1=-4.50 E2=-1.40 GC=81.00
CGCGCGGCGCGACGCACUGUG E0=-2.90 E1=-3.60 E2=-1.80 GC=81.00
CGCGCGGCGCGUCGCUAAGCG E0=-3.90 E1=-4.50 E2=-1.40 GC=81.00
CGCGCGGUGUGGCGCAUUGCG E0=-1.30 E1=-5.20 E2=0.10 GC=76.00
GCGCGCCGCGUGGCGCAGCGC E0=-3.50 E1=-4.00 E2=-1.10 GC=90.00
GCGCGCCGCGCUGCGUUUCGC E0=-5.40 E1=-3.80 E2=-1.40 GC=81.00
... skip 990 designs

Sequence logo from 1000 sequences:
</pre><p ><img src="MultitargetRNADesign_files/MultitargetRNADesign_11_1.png" alt="png" class="inline"/></p>
<pre class="fragment">/tmp/ipykernel_812466/627987535.py:77: UserWarning: Matplotlib is currently using module://matplotlib_inline.backend_inline, which is a non-GUI backend, so cannot show the figure.
  fig.show()
</pre><p ><img src="MultitargetRNADesign_files/MultitargetRNADesign_11_3.png" alt="png" class="inline"/></p>
<h1><a class="anchor" id="autotoc_md164"></a>
Targeting features by Multi-dimensional Boltzmann sampling</h1>
<div class="fragment"><div class="line">print(<span class="stringliteral">&quot;###########################################&quot;</span>)    </div>
<div class="line"><span class="comment"># MDBS</span></div>
<div class="line"> </div>
<div class="line">model.set_feature_weight( 0, <span class="stringliteral">&#39;E0&#39;</span> )</div>
<div class="line">model.set_feature_weight( 0, <span class="stringliteral">&#39;E1&#39;</span> )</div>
<div class="line"><span class="comment">#model.set_feature_weight( 0, &#39;E2&#39; )</span></div>
<div class="line">model.set_feature_weight( 0, <span class="stringliteral">&#39;gc&#39;</span> )</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">sampler = ir.Sampler( model )</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment"># control number of gc&#39;s; we target 70% +/- 15% GC-content</span></div>
<div class="line">seqlen = len(targets[0])</div>
<div class="line">sampler.set_target( 0.85 * seqlen, 0.02 * seqlen, <span class="stringliteral">&#39;gc&#39;</span> )</div>
<div class="line"> </div>
<div class="line"><span class="comment"># control Turner energy, target -2 +/- 1 kcal/mol</span></div>
<div class="line">sampler.set_target( -2, 0.2, <span class="stringliteral">&#39;E0&#39;</span> )</div>
<div class="line"> </div>
<div class="line"><span class="comment"># control Turner energy, target -2 +/- 1 kcal/mol</span></div>
<div class="line">sampler.set_target( -3, 0.2, <span class="stringliteral">&#39;E1&#39;</span> )</div>
<div class="line"> </div>
<div class="line"><span class="comment"># control Turner energy, target -2 +/- 1 kcal/mol</span></div>
<div class="line"><span class="comment">#sampler.set_target( -1.5, 0.2, &#39;E2&#39; )</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(10):</div>
<div class="line">    sample = sampler.targeted_sample()</div>
<div class="line">    print_sample(sample)</div>
</div><!-- fragment --> <pre class="fragment">###########################################
CGUGCGGCGCGCCGCUUCGCG
CGUGCGGCGCGUCGCGCUGCG
CGUGCGGCGCGUCGCAGCGCG
CGUGCGGCGCGCCGCAGUGCG
CGUGCGGCGCGCCGCCAUGCG
CGUGCGGCGCGUCGCUGGGCG
CGUGCGGCGCGCCGCUACGCG
CGUGCGGCGCGCCGCAAGGCG
CGUGCGGCGCGCCGCACAGCG
CGUGCGGCGCGUCGCAGGGCG
</pre><h1><a class="anchor" id="autotoc_md165"></a>
APPENDIX</h1>
<div class="fragment"><div class="line"><span class="comment"># RNAfold/3str/f3.100.0.inp</span></div>
<div class="line"> </div>
<div class="line">benchmark_targets = [</div>
<div class="line"><span class="stringliteral">&#39;((((.((....)).)))).((.(((.((((.....(((..((((((.((..(((.(.....).)))..)).)).))))..)))..)))).))).))....&#39;</span>,</div>
<div class="line"><span class="stringliteral">&#39;..(((((.....(((.(((((((.....))))..))).))).....)))))..((((((((((...))).)....))))))...((((((....))))))&#39;</span>,</div>
<div class="line"><span class="stringliteral">&#39;......(((((.....(((...(((.((.((.(((....((......))...))).)).)))))..))).............))))).((((...)))).&#39;</span></div>
<div class="line">]</div>
</div><!-- fragment --><div class="fragment"><div class="line">model = construct_design_model(benchmark_targets)</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">for</span> weight <span class="keywordflow">in</span> [-5,0]:</div>
<div class="line">    <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(3):</div>
<div class="line">        model.set_feature_weight( weight, f<span class="stringliteral">&#39;bpenergy{i}&#39;</span> )</div>
<div class="line">    model.set_feature_weight( weight, <span class="stringliteral">&#39;gc&#39;</span> )</div>
<div class="line"> </div>
<div class="line">    </div>
<div class="line"> </div>
<div class="line">    sampler = ir.BoltzmannSampler( model )</div>
<div class="line"> </div>
<div class="line">    samples = report_time(<span class="keyword">lambda</span>:</div>
<div class="line">        [sampler.sample() <span class="keywordflow">for</span> _ <span class="keywordflow">in</span> range(5000)])</div>
<div class="line">    </div>
<div class="line">    show_designs(samples,</div>
<div class="line">        plotlogo=has_module(<span class="stringliteral">&quot;logomaker&quot;</span>),</div>
<div class="line">        plotdist=has_module(<span class="stringliteral">&quot;matplotlib&quot;</span>),</div>
<div class="line">        filename=f<span class="stringliteral">&quot;f3_{weight}&quot;</span>)</div>
</div><!-- fragment --> <pre class="fragment">Time: 0.40s
CUCCCGCCCUUGCAGGGGGGGGGCCUCCCCCUCCCCCGCUGGCUAAGCGGGAGGGCGGCGGGGCUUCCCGCUUUAGCCGCCGGAGGGGGGGGCACCCCCC E0=-35.20 E1=-53.90 E2=-29.80 GC=81.00
CGGGGGCGUACGCUCCCGCCGCGGCUGCCGCGGUGCGGGGGCCUAAGCCUCACGCCGCCGCGCCGUGCGGCUUAAGGCGGCCGUGCGGCGGCCACGCCGC E0=-35.10 E1=-45.40 E2=-22.70 GC=83.00
CUUGCGCCUACGCGCAGGGGGGGCCUCCCCCCCCCCCGGCGGAAGAGCGCAAGGGUGGAGGGGCUUCCCGCUCUUUCCACCGGUGGGGGGGGCACCCCCC E0=-31.40 E1=-49.20 E2=-30.40 GC=78.00
GCGCCGCCGUGGCGGCGCGGGGGCGUCGCCCCUUCGCGCCGGAAAAGCGGUUGGAGGGACGCGCCACGCGGUUAUUCCCUCGCACGGCGGCGUUCCGCCG E0=-37.00 E1=-43.90 E2=-24.30 GC=78.00
UGGCGCGGUACCGCGCCGCCCCCGCAGCGGGGCGGCGCUGCCAAAACGCGUACCGCCCAGCGCGGUGCGCCUUUUUGGGCGCGUGCCGCCGCGAGGCGGC E0=-32.00 E1=-45.70 E2=-24.60 GC=80.00
UCGCCGCCGUCGCAGUGGGGGGGCCACCCCCCGCCCCGCUGGGGUGGCGGCAGGCCGGGGGGGCCUCCCGUCAAUCCCGGCGGACGGGGGGGCUCCCCCG E0=-33.80 E1=-49.60 E2=-30.00 GC=85.00
CCCCCCGCCUCCGGGGGGGGCGCCCACCGCGCCGCCCCCCCGCUUACGGGGUGCGCCGCGGGGGCACCCCCUAUAGCGGCGGGAGGCGGCGGGAGCCGCC E0=-41.00 E1=-51.40 E2=-29.80 GC=87.00
GGCGGCGGCUGUGUCGCCCCCCCGGUGGGGGGCGGGGUGGCUUUAUCGCUGACCGGCCCCCCCGGUGGGUGAUAGGGGCCGUCAGCCCCCCCGAGGGGGC E0=-23.60 E1=-48.60 E2=-32.70 GC=80.00
UGGGGGCGACCGCCCCCGCCGCGGCUGCCGCGUUGCGGGGGCUUUUGCCCCACGACGCCGCGCCGUGCGGCAAAAGGCGUCUGGUCGGCGGCUUCGCCGA E0=-27.80 E1=-46.30 E2=-23.20 GC=78.00
CGGCGCGGGCCCGUGCCGCUCCCGCAGCGGGAAGGCGCCGCCGAAAUGCGCACCUCCCGGCGCGGUGCGUCUUAUCGGGAGCGGCCCGCCGCGUGGCGGG E0=-31.30 E1=-42.90 E2=-30.10 GC=81.00
... skip 4990 designs

Sequence logo from 5000 sequences:
</pre><p ><img src="MultitargetRNADesign_files/MultitargetRNADesign_16_1.png" alt="png" class="inline"/></p>
<pre class="fragment">/tmp/ipykernel_812466/627987535.py:77: UserWarning: Matplotlib is currently using module://matplotlib_inline.backend_inline, which is a non-GUI backend, so cannot show the figure.
  fig.show()


Time: 0.46s
GAGGAGUAUGAAUCUUUUUUGUGAACGAUGCGUUGAGAGGGUCUUGAUUUCUUGGGGUCUCUUUGGAAGGGCAGGGGUUUUUUCGUGUUGUUUAUGACAU E0=18.40 E1=6.40 E2=7.50 GC=43.00
GACUGGUACGGGUCAGUUCUGUGAGGGAUGUGCCGGAGUGGCGGUGAUCAGUUGGAGUGUUUUCGGGAGAGCACCCGCUCCUCUGUAUCGUUCUCGGUGU E0=-12.10 E1=-3.30 E2=8.80 GC=58.00
CGAUAACGCUCGUUGUUGUCAUGGUCAUCGUGUUACGGCAACGGUAGUUAUUUAGUACGAUGUUGAGCGAUUACCUGUGUUCGAGUGGUAGUUCUGCUGC E0=2.90 E1=-4.10 E2=7.10 GC=47.00
AUGUUUGUUUGUGGGUAUAGUGUCGAUGGCGUAGUAUCUUUAGGUCUGGGCUGUUGUGGCGCGGCAUGUUGGAACCUAUGGGUGGGUUGUUGAUAUAACC E0=-0.40 E1=3.60 E2=12.60 GC=48.00
GGAUAUAGCCAUAUAUUCUUUUCGGCGGGAGAUGAGGCUGUCGAGCUGUGUAUUGAUUGCUUCGAUGGAUGGUUUCGGUCGUUGGUUUUUUUGUGAAAGC E0=-1.40 E1=-3.60 E2=5.60 GC=45.00
UGUUAUGAGCCUACGACAUUUUCGUAGUGGGACAGUGUUGUCGUAUCGUGGCUUGUUCGGUGCGGGGUGCCAUCGCGGAUGCGGUUUAUUAUGAGGUGAA E0=-1.20 E1=-0.50 E2=6.60 GC=51.00
GUGACUGCAGAUAGUCACGGUGUCGGCGGCGCCACGUCGUUGUUGUCGGUCUGUGGUGUUGCGACGCGUUGAUAAGUGUCGAUUUGUCGCCGGCGUGGCG E0=1.40 E1=-1.80 E2=-5.80 GC=61.00
GCGUCCGCUCACGGGUGUGGCGUUGGUGGCGCUACAUCUCUGUUUAUGGACGGUGGUGUCAUAAUCUGUUGUACGGUGCUGAUGGGCUGCUAGCGUAGCU E0=6.90 E1=-12.60 E2=1.00 GC=57.00
UGGUGUAGGUUUGUGCUAUUUUUGUCAUAGAGAAAUAUUACCUCGCUGUACGUUUUUUUGUGUAACGUAUUGUUGAGGGGAUGGUCUAUUGUGUAAUAGG E0=-1.60 E1=9.90 E2=16.80 GC=37.00
AGAGGGUAACGGUCCUCUUCGCGAGUAGUGUGCCGGGGGGGUAGCAAUCUUUUGGAAUAUUUUCGGGAGAAUGUUUGUUUCUUGUUGUUGUUUACGAUGA E0=7.60 E1=-1.90 E2=7.20 GC=46.00
... skip 4990 designs

Sequence logo from 5000 sequences:
</pre><p ><img src="MultitargetRNADesign_files/MultitargetRNADesign_16_4.png" alt="png" class="inline"/></p>
<p ><img src="MultitargetRNADesign_files/MultitargetRNADesign_16_5.png" alt="png" class="inline"/></p>
<pre class="fragment">/tmp/ipykernel_812466/627987535.py:77: UserWarning: Matplotlib is currently using module://matplotlib_inline.backend_inline, which is a non-GUI backend, so cannot show the figure.
  fig.show()
</pre><p ><img src="MultitargetRNADesign_files/MultitargetRNADesign_16_7.png" alt="png" class="inline"/></p>
<div class="fragment"><div class="line"><span class="keyword">def </span>model_objective(model, assignment):</div>
<div class="line">    <span class="keywordflow">return</span> sum(f.weight*model.eval_feature(assignment,fname) <span class="keywordflow">for</span> fname, f <span class="keywordflow">in</span> model.features.items() <span class="keywordflow">if</span> f.weight!=0)</div>
</div><!-- fragment --><div class="fragment"><div class="line">model = construct_design_model(benchmark_targets)</div>
<div class="line">model.set_feature_weight( -3, <span class="stringliteral">&#39;E0&#39;</span> )</div>
<div class="line">model.set_feature_weight( -4, <span class="stringliteral">&#39;E1&#39;</span> )</div>
<div class="line">model.set_feature_weight( -5, <span class="stringliteral">&#39;E2&#39;</span> )</div>
<div class="line">model.set_feature_weight( -6, <span class="stringliteral">&#39;gc&#39;</span> )</div>
<div class="line"> </div>
<div class="line">sampler = ir.Sampler(model)</div>
<div class="line"><span class="comment"># draw samples</span></div>
<div class="line"><span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(10):</div>
<div class="line">    sample = sampler.sample()</div>
<div class="line">    print_sample(sample)</div>
<div class="line">    print([(f.weight, model.eval_feature(sample,fname)) <span class="keywordflow">for</span> fname, f <span class="keywordflow">in</span> model.features.items() <span class="keywordflow">if</span> f.weight!=0])</div>
<div class="line">    print(model_objective(model,sample))</div>
</div><!-- fragment --> <pre class="fragment">UUGUUCGCUAUUGGAUGGGACGCCCUCUGCGUAGCUUUUCCAAUAAUGGAUAGCUUCGAAGGGGUUCCCUUUUUAUUGAAGAAUAGCGGCGGGUGUCGCU
[(-3, -36.316440000000014), (-3, -6.800000190734863), (-4, -44.01118000000002), (-4, -21.0), (-5, -41.33763000000001), (-5, -20.0), (-6, 49)]
402.0821905722048
UUUACCGCUAUUGGUAGGGGCGCCCACCGCGUUGUUUUACCAAUAACGGUAAACAUCGAGGGGGUUCCCUCUUAAUUGAUGAAUAGCGGCGGGAGCCGCU
[(-3, -38.38947000000002), (-3, -13.199999809265137), (-4, -48.024850000000015), (-4, -28.700000762939453), (-5, -42.55497000000001), (-5, -22.700000762939453), (-6, 53)]
469.94266629425067
UCUUUCGCAUUCGAAAGGGGCGCCCACCGCGUUACCCUUUCAAAAAUGGAAUGUAUCGAGGGGGUACCCUUUUAUUUGAUAGGAUGCGGCGGGAGCCGCA
[(-3, -42.76479000000003), (-3, -15.100000381469727), (-4, -44.86687000000001), (-4, -25.100000381469727), (-5, -41.69928000000001), (-5, -21.700000762939453), (-6, 53)]
452.45825648498555
UCAUUCGUAAUUGGAUGGAGCGCCCACCGCGUUAUUCUUCCAAAAUUGGAUAAUAUCGAGGGGGUUUCCUUAUUUUUGAUAGAUUGCGGCGGGAGCCGCA
[(-3, -39.60681000000003), (-3, -16.899999618530273), (-4, -42.43219000000001), (-4, -22.0), (-5, -38.17965000000001), (-5, -17.799999237060547), (-6, 47)]
425.1474350408938
UUUUUCGCAUUUGGAAGGGGCGCCCUCCGCGUAAUUUUUCCAUAUUUGGAAAAUUUCGUGGGGGUUCCCCUAAUUAUGAAAAAAUGCGGCGGGUGCCGCA
[(-3, -38.02782000000001), (-3, -10.800000190734863), (-4, -42.79384000000002), (-4, -19.600000381469727), (-5, -40.97598000000001), (-5, -19.399999618530273), (-6, 48)]
409.938720190735
UUAUUCGUUAUUGAAUGGGGCGCCCACCGCGUAGCCUCUUCAAAAUUGGAUAGCUUCGAGGGGGUUCCCUUAUAUUUGAAGAGUAGCGGCGGGUGCCGCU
[(-3, -41.54745000000003), (-3, -16.299999237060547), (-4, -45.22852000000002), (-4, -24.700000762939453), (-5, -42.06093000000001), (-5, -20.200000762939453), (-6, 52)]
452.56108457763696
UGUUGCGGAUCUGUAACGCUCUCGCAGCGGGAAGGCGUUGCUUUUAUGCAAUUCUCCCUGCGCGAAGCGUUUAAAAGGGAGUGAUCCGCCGCGUGGCGGA
[(-3, -41.90910000000003), (-3, -12.800000190734863), (-4, -49.242190000000015), (-4, -31.799999237060547), (-5, -44.49561000000001), (-5, -23.100000381469727), (-6, 57)]
484.27410942779557
UUAAUUGUAUUUGAUUGGGGCACCCUCCGUGUAGUUUUAUCAAAAUUGGUUUACUUCAAGGGGGUACCCUCAUUUUUGAAGAAAUGCGGCGGGUGCCGCA
[(-3, -35.95479000000002), (-3, -7.400000095367432), (-4, -40.85320000000001), (-4, -17.299999237060547), (-5, -38.54130000000001), (-5, -18.600000381469727), (-6, 44)]
384.3836691416932
UUAACUGCAAUUGGUUGGGGCACCCUCCGUGUUGUUUUACCAAUUUUGGUUUACAUCGAGGGGGUACCCUUAAUAUUGAUGAAUUGCGGCGGGUGCCGCA
[(-3, -35.95479000000002), (-3, -6.900000095367432), (-4, -42.79384000000002), (-4, -19.200000762939453), (-5, -41.33763000000001), (-5, -24.200000762939453), (-6, 48)]
416.2278871525575
UUAAUCGCAUUUGGUUGGGGCACCCACCGUGUUACCUUACCAAUAAUGGUUUGUAUCAAGGGGGUACCCUUUUAAUUGAUAAGAUGCGGCGGGUGCCGCA
[(-3, -37.533780000000014), (-3, -6.800000190734863), (-4, -43.287880000000015), (-4, -23.200000762939453), (-5, -41.33763000000001), (-5, -23.200000762939453), (-6, 48)]
433.6410174386599
</pre><h1><a class="anchor" id="autotoc_md166"></a>
MDBS targeting distribution plots</h1>
<div class="fragment"><div class="line"><span class="comment"># collect some statistics</span></div>
<div class="line"><span class="keyword">def </span>callback(total,accepted,fstats):</div>
<div class="line">    rmsd = sampler.rmsd(fstats.means(),sampler.model.features)</div>
<div class="line">    the_statistics.append({<span class="stringliteral">&#39;samples&#39;</span>:total, <span class="stringliteral">&#39;rmsd&#39;</span>:rmsd, <span class="stringliteral">&#39;accepted&#39;</span>:accepted})</div>
<div class="line">    <span class="comment">#print(fstats.report(),total,accepted,rmsd)</span></div>
<div class="line">    </div>
<div class="line">the_statistics = list()</div>
</div><!-- fragment --><div class="fragment"><div class="line">model = construct_design_model(benchmark_targets)</div>
<div class="line"> </div>
<div class="line">model.set_feature_weight( 0, <span class="stringliteral">&#39;E0&#39;</span> )</div>
<div class="line">model.set_feature_weight( 0, <span class="stringliteral">&#39;E1&#39;</span> )</div>
<div class="line">model.set_feature_weight( 0, <span class="stringliteral">&#39;E2&#39;</span> )</div>
<div class="line">model.set_feature_weight( 0, <span class="stringliteral">&#39;gc&#39;</span> )</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">sampler = ir.Sampler( model )</div>
<div class="line"> </div>
<div class="line">sampler.samples_per_round = 500</div>
<div class="line">sampler.tweak_factor = 0.1</div>
<div class="line">sampler.cooling = 2**(1/16)</div>
<div class="line">sampler.verbose = <span class="keyword">True</span></div>
<div class="line"> </div>
<div class="line">sampler.callback = callback</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment"># control number of gc&#39;s</span></div>
<div class="line">seqlen = len(benchmark_targets[0])</div>
<div class="line">sampler.set_target( 0.85 * seqlen, 0.05 * seqlen, <span class="stringliteral">&#39;gc&#39;</span> )</div>
<div class="line"> </div>
<div class="line"><span class="comment"># control Turner energy</span></div>
<div class="line">sampler.set_target( -40, 0.5, <span class="stringliteral">&#39;E0&#39;</span> )</div>
<div class="line"> </div>
<div class="line"><span class="comment"># control Turner energy</span></div>
<div class="line">sampler.set_target( -40, 0.5, <span class="stringliteral">&#39;E1&#39;</span> )</div>
<div class="line"> </div>
<div class="line"><span class="comment"># control Turner energy</span></div>
<div class="line">sampler.set_target( -30, 0.5, <span class="stringliteral">&#39;E2&#39;</span> )</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">the_samples = report_time(</div>
<div class="line">    <span class="keyword">lambda</span>: [sampler.targeted_sample() <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(100)])</div>
</div><!-- fragment --> <pre class="fragment">-- 500 0 0.0000 Tweak factor 0.1 Samples per round 500 RMSD 36.610
E0=-1.69 +/-7.41 E1=-2.55 +/-7.26 E2=6.17 +/-6.23 gc=50.60 +/-6.13
Weights {'E0': -3.831, 'E1': -3.745, 'E2': -3.617, 'gc': 3.44}
-- 1000 0 0.0000 Tweak factor 0.1 Samples per round 500 RMSD 5.217
E0=-39.35 +/-2.36 E1=-44.65 +/-2.07 E2=-27.28 +/-2.60 gc=93.91 +/-0.29
Weights {'E0': -3.896, 'E1': -3.28, 'E2': -3.889, 'gc': 2.548}
-- 1500 0 0.0000 Tweak factor 0.0958 Samples per round 522 RMSD 5.668
E0=-42.17 +/-3.70 E1=-45.36 +/-2.47 E2=-30.38 +/-2.26 gc=94.74 +/-0.48
Weights {'E0': -3.688, 'E1': -2.766, 'E2': -3.852, 'gc': 1.615}
-- 2022 0 0.0000 Tweak factor 0.0958 Samples per round 522 RMSD 4.939
E0=-42.70 +/-3.77 E1=-44.33 +/-2.41 E2=-29.19 +/-2.24 gc=93.42 +/-0.66
Weights {'E0': -3.43, 'E1': -2.352, 'E2': -3.93, 'gc': 0.809}
-- 2544 0 0.0000 Tweak factor 0.0917 Samples per round 545 RMSD 9.407
E0=-46.88 +/-3.34 E1=-50.62 +/-2.37 E2=-31.83 +/-2.36 gc=98.80 +/-0.97
Weights {'E0': -2.799, 'E1': -1.378, 'E2': -3.762, 'gc': -0.456}
-- 3089 0 0.0000 Tweak factor 0.0917 Samples per round 545 RMSD 7.084
E0=-45.11 +/-3.47 E1=-47.62 +/-3.44 E2=-31.53 +/-2.65 gc=95.69 +/-1.90
Weights {'E0': -2.33, 'E1': -0.679, 'E2': -3.622, 'gc': -1.436}
-- 3634 0 0.0000 Tweak factor 0.0917 Samples per round 545 RMSD 3.035
E0=-35.92 +/-4.74 E1=-35.73 +/-4.84 E2=-29.60 +/-2.76 gc=83.65 +/-3.71
Weights {'E0': -2.704, 'E1': -1.071, 'E2': -3.658, 'gc': -1.313}
-- 4179 1 0.0002 Tweak factor 0.0917 Samples per round 545 RMSD 2.503
E0=-40.99 +/-3.97 E1=-41.42 +/-4.25 E2=-30.49 +/-2.65 gc=89.67 +/-2.91
Weights {'E0': -2.613, 'E1': -0.94, 'E2': -3.613, 'gc': -1.741}
-- 4724 1 0.0002 Tweak factor 0.0878 Samples per round 569 RMSD 2.603
E0=-36.56 +/-4.66 E1=-36.43 +/-4.53 E2=-29.60 +/-2.97 gc=83.46 +/-3.75
Weights {'E0': -2.916, 'E1': -1.253, 'E2': -3.648, 'gc': -1.606}
-- 5293 1 0.0002 Tweak factor 0.0878 Samples per round 569 RMSD 1.875
E0=-40.52 +/-4.16 E1=-40.99 +/-4.27 E2=-30.20 +/-2.81 gc=88.57 +/-2.98
Weights {'E0': -2.87, 'E1': -1.167, 'E2': -3.631, 'gc': -1.92}
-- 5862 3 0.0005 Tweak factor 0.0878 Samples per round 569 RMSD 1.615
E0=-37.81 +/-4.43 E1=-37.75 +/-4.47 E2=-29.34 +/-2.92 gc=84.63 +/-3.55
Weights {'E0': -3.063, 'E1': -1.364, 'E2': -3.688, 'gc': -1.888}
-- 6431 3 0.0005 Tweak factor 0.0878 Samples per round 569 RMSD 1.066
E0=-39.64 +/-3.99 E1=-40.02 +/-4.27 E2=-29.80 +/-2.81 gc=87.09 +/-3.48
Weights {'E0': -3.094, 'E1': -1.363, 'E2': -3.706, 'gc': -2.072}
-- 7000 4 0.0006 Tweak factor 0.0878 Samples per round 569 RMSD 1.031
E0=-38.72 +/-4.26 E1=-38.54 +/-4.35 E2=-29.33 +/-2.86 gc=85.15 +/-3.57
Weights {'E0': -3.207, 'E1': -1.491, 'E2': -3.764, 'gc': -2.085}
-- 7569 4 0.0005 Tweak factor 0.0878 Samples per round 569 RMSD 0.871
E0=-39.55 +/-4.47 E1=-39.38 +/-4.31 E2=-29.56 +/-2.81 gc=86.50 +/-3.45
Weights {'E0': -3.246, 'E1': -1.545, 'E2': -3.803, 'gc': -2.216}
-- 8138 5 0.0006 Tweak factor 0.0878 Samples per round 569 RMSD 0.752
E0=-38.97 +/-4.03 E1=-39.25 +/-4.62 E2=-29.49 +/-2.77 gc=85.62 +/-3.49
Weights {'E0': -3.337, 'E1': -1.611, 'E2': -3.847, 'gc': -2.271}
-- 8707 6 0.0007 Tweak factor 0.0878 Samples per round 569 RMSD 0.639
E0=-39.35 +/-4.06 E1=-39.42 +/-4.23 E2=-29.29 +/-2.85 gc=85.61 +/-3.51
Weights {'E0': -3.394, 'E1': -1.662, 'E2': -3.909, 'gc': -2.325}
-- 9276 7 0.0008 Tweak factor 0.0878 Samples per round 569 RMSD 0.615
E0=-39.37 +/-4.28 E1=-39.65 +/-4.40 E2=-29.63 +/-2.79 gc=85.93 +/-3.59
Weights {'E0': -3.449, 'E1': -1.693, 'E2': -3.942, 'gc': -2.406}
-- 9845 8 0.0008 Tweak factor 0.0841 Samples per round 594 RMSD 0.648
E0=-38.90 +/-3.96 E1=-39.56 +/-4.27 E2=-29.61 +/-2.92 gc=85.36 +/-3.60
Weights {'E0': -3.541, 'E1': -1.73, 'E2': -3.975, 'gc': -2.436}
-- 10439 11 0.0011 Tweak factor 0.0841 Samples per round 594 RMSD 0.582
E0=-39.66 +/-3.94 E1=-39.60 +/-4.10 E2=-29.41 +/-2.78 gc=85.86 +/-3.39
Weights {'E0': -3.57, 'E1': -1.764, 'E2': -4.024, 'gc': -2.508}
-- 11033 11 0.0010 Tweak factor 0.0805 Samples per round 620 RMSD 0.615
E0=-39.64 +/-4.26 E1=-39.12 +/-4.55 E2=-29.41 +/-2.85 gc=85.51 +/-3.53
Weights {'E0': -3.599, 'E1': -1.834, 'E2': -4.072, 'gc': -2.549}
-- 11653 11 0.0009 Tweak factor 0.0805 Samples per round 620 RMSD 0.532
E0=-39.31 +/-4.05 E1=-39.71 +/-4.35 E2=-29.41 +/-3.01 gc=85.48 +/-3.57
Weights {'E0': -3.654, 'E1': -1.857, 'E2': -4.119, 'gc': -2.588}
-- 12273 13 0.0011 Tweak factor 0.0805 Samples per round 620 RMSD 0.485
E0=-39.70 +/-3.85 E1=-39.69 +/-4.17 E2=-29.68 +/-2.82 gc=85.81 +/-3.41
Weights {'E0': -3.678, 'E1': -1.883, 'E2': -4.145, 'gc': -2.653}
-- 12893 14 0.0011 Tweak factor 0.0771 Samples per round 648 RMSD 0.659
E0=-38.96 +/-3.99 E1=-39.36 +/-4.37 E2=-29.55 +/-2.74 gc=84.83 +/-3.45
Weights {'E0': -3.759, 'E1': -1.932, 'E2': -4.18, 'gc': -2.639}
-- 13541 14 0.0010 Tweak factor 0.0771 Samples per round 648 RMSD 0.612
E0=-39.69 +/-3.85 E1=-40.01 +/-4.27 E2=-29.51 +/-2.80 gc=86.08 +/-3.40
Weights {'E0': -3.782, 'E1': -1.931, 'E2': -4.217, 'gc': -2.723}
-- 14189 17 0.0012 Tweak factor 0.0771 Samples per round 648 RMSD 0.482
E0=-39.41 +/-4.10 E1=-39.55 +/-4.17 E2=-29.44 +/-2.74 gc=85.26 +/-3.62
Weights {'E0': -3.828, 'E1': -1.965, 'E2': -4.261, 'gc': -2.743}
-- 14837 18 0.0012 Tweak factor 0.0738 Samples per round 677 RMSD 0.488
E0=-39.63 +/-4.09 E1=-39.79 +/-4.19 E2=-29.36 +/-2.90 gc=85.60 +/-3.62
Weights {'E0': -3.855, 'E1': -1.981, 'E2': -4.308, 'gc': -2.787}
-- 15514 19 0.0012 Tweak factor 0.0707 Samples per round 707 RMSD 0.497
E0=-39.54 +/-4.05 E1=-39.54 +/-4.07 E2=-29.38 +/-2.83 gc=85.41 +/-3.55
Weights {'E0': -3.888, 'E1': -2.014, 'E2': -4.352, 'gc': -2.817}
-- 16221 20 0.0012 Tweak factor 0.0707 Samples per round 707 RMSD 0.368
E0=-39.48 +/-3.92 E1=-39.67 +/-4.22 E2=-29.67 +/-2.73 gc=85.23 +/-3.54
Weights {'E0': -3.925, 'E1': -2.037, 'E2': -4.375, 'gc': -2.833}
-- 16928 21 0.0012 Tweak factor 0.0677 Samples per round 738 RMSD 0.369
E0=-39.73 +/-3.85 E1=-39.78 +/-4.15 E2=-29.66 +/-2.96 gc=85.56 +/-3.60
Weights {'E0': -3.943, 'E1': -2.052, 'E2': -4.398, 'gc': -2.871}
-- 17666 24 0.0014 Tweak factor 0.0648 Samples per round 771 RMSD 0.460
E0=-39.49 +/-3.91 E1=-39.44 +/-4.42 E2=-29.51 +/-2.80 gc=85.18 +/-3.53
Weights {'E0': -3.976, 'E1': -2.088, 'E2': -4.43, 'gc': -2.883}
-- 18437 27 0.0015 Tweak factor 0.0621 Samples per round 805 RMSD 0.515
E0=-39.81 +/-3.96 E1=-40.28 +/-4.13 E2=-29.65 +/-2.82 gc=85.91 +/-3.30
Weights {'E0': -3.988, 'E1': -2.071, 'E2': -4.452, 'gc': -2.939}
-- 19242 27 0.0014 Tweak factor 0.0621 Samples per round 805 RMSD 0.501
E0=-39.52 +/-4.05 E1=-39.42 +/-4.39 E2=-29.34 +/-2.87 gc=85.04 +/-3.67
Weights {'E0': -4.018, 'E1': -2.107, 'E2': -4.493, 'gc': -2.942}
-- 20047 27 0.0013 Tweak factor 0.0621 Samples per round 805 RMSD 0.337
E0=-39.62 +/-4.06 E1=-39.74 +/-4.16 E2=-29.57 +/-2.80 gc=85.24 +/-3.42
Weights {'E0': -4.041, 'E1': -2.123, 'E2': -4.519, 'gc': -2.957}
-- 20852 27 0.0013 Tweak factor 0.0595 Samples per round 840 RMSD 0.414
E0=-39.51 +/-3.95 E1=-39.91 +/-4.05 E2=-29.52 +/-2.79 gc=85.45 +/-3.46
Weights {'E0': -4.071, 'E1': -2.128, 'E2': -4.548, 'gc': -2.984}
-- 21692 29 0.0013 Tweak factor 0.0595 Samples per round 840 RMSD 0.373
E0=-39.76 +/-3.85 E1=-39.67 +/-4.07 E2=-29.63 +/-2.80 gc=85.50 +/-3.50
Weights {'E0': -4.085, 'E1': -2.148, 'E2': -4.57, 'gc': -3.013}
-- 22532 31 0.0014 Tweak factor 0.0569 Samples per round 878 RMSD 0.417
E0=-39.37 +/-3.98 E1=-39.87 +/-4.40 E2=-29.57 +/-2.79 gc=85.31 +/-3.49
Weights {'E0': -4.121, 'E1': -2.155, 'E2': -4.595, 'gc': -3.031}
-- 23410 31 0.0013 Tweak factor 0.0569 Samples per round 878 RMSD 0.407
E0=-39.52 +/-3.88 E1=-39.62 +/-3.98 E2=-29.56 +/-2.89 gc=85.31 +/-3.44
Weights {'E0': -4.148, 'E1': -2.177, 'E2': -4.619, 'gc': -3.049}
-- 24288 34 0.0014 Tweak factor 0.0569 Samples per round 878 RMSD 0.401
E0=-39.89 +/-3.88 E1=-39.54 +/-4.21 E2=-29.52 +/-2.79 gc=85.43 +/-3.31
Weights {'E0': -4.155, 'E1': -2.203, 'E2': -4.647, 'gc': -3.073}
-- 25166 35 0.0014 Tweak factor 0.0569 Samples per round 878 RMSD 0.396
E0=-39.39 +/-3.85 E1=-39.78 +/-4.19 E2=-29.59 +/-2.87 gc=85.19 +/-3.46
Weights {'E0': -4.19, 'E1': -2.215, 'E2': -4.671, 'gc': -3.084}
-- 26044 36 0.0014 Tweak factor 0.0569 Samples per round 878 RMSD 0.330
E0=-39.95 +/-3.94 E1=-39.83 +/-4.09 E2=-29.66 +/-2.76 gc=85.54 +/-3.50
Weights {'E0': -4.192, 'E1': -2.225, 'E2': -4.69, 'gc': -3.115}
-- 26922 38 0.0014 Tweak factor 0.0545 Samples per round 917 RMSD 0.355
E0=-39.54 +/-3.96 E1=-39.73 +/-4.25 E2=-29.59 +/-2.91 gc=85.22 +/-3.55
Weights {'E0': -4.218, 'E1': -2.24, 'E2': -4.712, 'gc': -3.126}
-- 27839 39 0.0014 Tweak factor 0.0545 Samples per round 917 RMSD 0.342
E0=-39.58 +/-4.05 E1=-39.70 +/-4.23 E2=-29.62 +/-2.76 gc=85.24 +/-3.65
Weights {'E0': -4.24, 'E1': -2.256, 'E2': -4.733, 'gc': -3.14}
-- 28756 39 0.0014 Tweak factor 0.0545 Samples per round 917 RMSD 0.313
E0=-39.77 +/-3.98 E1=-39.88 +/-4.26 E2=-29.69 +/-2.67 gc=85.48 +/-3.45
Weights {'E0': -4.253, 'E1': -2.263, 'E2': -4.75, 'gc': -3.166}
-- 29673 41 0.0014 Tweak factor 0.0522 Samples per round 957 RMSD 0.356
E0=-39.55 +/-3.86 E1=-39.76 +/-4.16 E2=-29.58 +/-2.82 gc=85.27 +/-3.67
Weights {'E0': -4.276, 'E1': -2.276, 'E2': -4.771, 'gc': -3.18}
-- 30630 44 0.0014 Tweak factor 0.0522 Samples per round 957 RMSD 0.321
E0=-39.69 +/-3.87 E1=-39.78 +/-4.10 E2=-29.58 +/-2.77 gc=85.31 +/-3.47
Weights {'E0': -4.293, 'E1': -2.287, 'E2': -4.793, 'gc': -3.196}
-- 31587 44 0.0014 Tweak factor 0.0522 Samples per round 957 RMSD 0.291
E0=-39.65 +/-3.92 E1=-39.76 +/-4.14 E2=-29.68 +/-2.79 gc=85.24 +/-3.48
Weights {'E0': -4.311, 'E1': -2.3, 'E2': -4.81, 'gc': -3.208}
-- 32544 45 0.0014 Tweak factor 0.05 Samples per round 999 RMSD 0.313
E0=-39.61 +/-3.81 E1=-39.90 +/-4.17 E2=-29.66 +/-2.78 gc=85.34 +/-3.44
Weights {'E0': -4.331, 'E1': -2.305, 'E2': -4.827, 'gc': -3.225}
-- 33543 46 0.0014 Tweak factor 0.0479 Samples per round 1044 RMSD 0.400
E0=-39.74 +/-3.91 E1=-39.46 +/-4.14 E2=-29.56 +/-2.73 gc=85.29 +/-3.47
Weights {'E0': -4.343, 'E1': -2.331, 'E2': -4.848, 'gc': -3.239}
-- 34587 47 0.0014 Tweak factor 0.0479 Samples per round 1044 RMSD 0.270
E0=-39.67 +/-3.97 E1=-39.72 +/-4.29 E2=-29.82 +/-2.80 gc=85.27 +/-3.61
Weights {'E0': -4.359, 'E1': -2.344, 'E2': -4.856, 'gc': -3.252}
-- 35631 48 0.0013 Tweak factor 0.0459 Samples per round 1090 RMSD 0.311
E0=-39.71 +/-4.00 E1=-39.65 +/-4.09 E2=-29.64 +/-2.86 gc=85.22 +/-3.65
Weights {'E0': -4.372, 'E1': -2.36, 'E2': -4.873, 'gc': -3.262}
-- 36721 50 0.0014 Tweak factor 0.0439 Samples per round 1138 RMSD 0.323
E0=-39.87 +/-3.86 E1=-40.01 +/-4.25 E2=-29.84 +/-2.80 gc=85.61 +/-3.49
Weights {'E0': -4.378, 'E1': -2.359, 'E2': -4.88, 'gc': -3.289}
-- 37859 50 0.0013 Tweak factor 0.0439 Samples per round 1138 RMSD 0.262
E0=-39.78 +/-3.85 E1=-39.92 +/-3.99 E2=-29.59 +/-2.78 gc=85.22 +/-3.47
Weights {'E0': -4.388, 'E1': -2.362, 'E2': -4.898, 'gc': -3.299}
-- 38997 50 0.0013 Tweak factor 0.042 Samples per round 1189 RMSD 0.309
E0=-39.57 +/-3.97 E1=-39.75 +/-4.11 E2=-29.77 +/-2.70 gc=85.29 +/-3.42
Weights {'E0': -4.406, 'E1': -2.373, 'E2': -4.908, 'gc': -3.311}
-- 40186 54 0.0013 Tweak factor 0.042 Samples per round 1189 RMSD 0.241
E0=-39.75 +/-3.93 E1=-39.78 +/-4.19 E2=-29.69 +/-2.82 gc=85.16 +/-3.58
Weights {'E0': -4.416, 'E1': -2.382, 'E2': -4.921, 'gc': -3.318}
-- 41375 55 0.0013 Tweak factor 0.0403 Samples per round 1241 RMSD 0.328
E0=-39.64 +/-3.80 E1=-39.67 +/-3.99 E2=-29.62 +/-2.74 gc=85.23 +/-3.50
Weights {'E0': -4.431, 'E1': -2.395, 'E2': -4.936, 'gc': -3.327}
-- 42616 58 0.0014 Tweak factor 0.0403 Samples per round 1241 RMSD 0.326
E0=-39.90 +/-3.80 E1=-39.98 +/-4.24 E2=-29.63 +/-2.76 gc=85.53 +/-3.49
Weights {'E0': -4.435, 'E1': -2.396, 'E2': -4.951, 'gc': -3.348}
-- 43857 59 0.0013 Tweak factor 0.0403 Samples per round 1241 RMSD 0.299
E0=-39.68 +/-3.98 E1=-39.68 +/-4.22 E2=-29.64 +/-2.75 gc=85.13 +/-3.47
Weights {'E0': -4.448, 'E1': -2.409, 'E2': -4.965, 'gc': -3.354}
-- 45098 62 0.0014 Tweak factor 0.0403 Samples per round 1241 RMSD 0.248
E0=-39.68 +/-3.88 E1=-39.74 +/-4.10 E2=-29.78 +/-2.71 gc=85.16 +/-3.56
Weights {'E0': -4.461, 'E1': -2.42, 'E2': -4.974, 'gc': -3.36}
-- 46339 64 0.0014 Tweak factor 0.0386 Samples per round 1296 RMSD 0.264
E0=-39.80 +/-3.74 E1=-39.65 +/-4.16 E2=-29.69 +/-2.73 gc=85.14 +/-3.42
Weights {'E0': -4.468, 'E1': -2.433, 'E2': -4.986, 'gc': -3.365}
-- 47635 69 0.0014 Tweak factor 0.0386 Samples per round 1296 RMSD 0.263
E0=-39.84 +/-3.69 E1=-39.81 +/-4.04 E2=-29.71 +/-2.82 gc=85.36 +/-3.42
Weights {'E0': -4.475, 'E1': -2.441, 'E2': -4.997, 'gc': -3.379}
-- 48931 70 0.0014 Tweak factor 0.0369 Samples per round 1354 RMSD 0.312
E0=-39.47 +/-3.95 E1=-39.82 +/-4.16 E2=-29.74 +/-2.85 gc=85.09 +/-3.58
Weights {'E0': -4.494, 'E1': -2.447, 'E2': -5.007, 'gc': -3.383}
-- 50285 72 0.0014 Tweak factor 0.0369 Samples per round 1354 RMSD 0.231
E0=-39.94 +/-3.86 E1=-39.89 +/-4.16 E2=-29.71 +/-2.85 gc=85.34 +/-3.49
Weights {'E0': -4.496, 'E1': -2.452, 'E2': -5.017, 'gc': -3.395}
-- 51639 74 0.0014 Tweak factor 0.0354 Samples per round 1414 RMSD 0.283
E0=-39.61 +/-3.97 E1=-39.80 +/-4.07 E2=-29.66 +/-2.78 gc=85.10 +/-3.54
Weights {'E0': -4.51, 'E1': -2.459, 'E2': -5.03, 'gc': -3.399}
-- 53053 77 0.0015 Tweak factor 0.0354 Samples per round 1414 RMSD 0.253
E0=-39.73 +/-3.96 E1=-39.79 +/-4.18 E2=-29.84 +/-2.70 gc=85.34 +/-3.29
Weights {'E0': -4.519, 'E1': -2.466, 'E2': -5.035, 'gc': -3.411}
-- 54467 82 0.0015 Tweak factor 0.0354 Samples per round 1414 RMSD 0.242
E0=-39.68 +/-3.97 E1=-39.76 +/-4.07 E2=-29.79 +/-2.72 gc=85.18 +/-3.51
Weights {'E0': -4.531, 'E1': -2.474, 'E2': -5.043, 'gc': -3.417}
-- 55881 84 0.0015 Tweak factor 0.0339 Samples per round 1476 RMSD 0.291
E0=-39.64 +/-3.90 E1=-39.83 +/-4.20 E2=-29.64 +/-2.75 gc=85.23 +/-3.50
Weights {'E0': -4.543, 'E1': -2.48, 'E2': -5.055, 'gc': -3.425}
-- 57357 85 0.0015 Tweak factor 0.0339 Samples per round 1476 RMSD 0.208
E0=-39.78 +/-3.93 E1=-39.88 +/-4.11 E2=-29.78 +/-2.79 gc=85.25 +/-3.60
Weights {'E0': -4.55, 'E1': -2.484, 'E2': -5.062, 'gc': -3.433}
-- 58833 86 0.0015 Tweak factor 0.0324 Samples per round 1542 RMSD 0.331
E0=-39.89 +/-3.95 E1=-39.69 +/-4.10 E2=-29.61 +/-2.66 gc=85.42 +/-3.55
Weights {'E0': -4.554, 'E1': -2.494, 'E2': -5.075, 'gc': -3.447}
-- 60375 89 0.0015 Tweak factor 0.0324 Samples per round 1542 RMSD 0.200
E0=-39.88 +/-3.87 E1=-39.98 +/-4.14 E2=-29.84 +/-2.74 gc=85.34 +/-3.43
Weights {'E0': -4.558, 'E1': -2.495, 'E2': -5.08, 'gc': -3.458}
-- 61917 93 0.0015 Tweak factor 0.0324 Samples per round 1542 RMSD 0.194
E0=-39.89 +/-3.92 E1=-39.92 +/-4.31 E2=-29.77 +/-2.76 gc=85.28 +/-3.49
Weights {'E0': -4.562, 'E1': -2.498, 'E2': -5.088, 'gc': -3.467}
-- 63459 96 0.0015 Tweak factor 0.031 Samples per round 1610 RMSD 0.296
E0=-39.66 +/-3.87 E1=-39.65 +/-4.22 E2=-29.67 +/-2.71 gc=85.06 +/-3.47
Weights {'E0': -4.572, 'E1': -2.508, 'E2': -5.098, 'gc': -3.469}
Time: 30.93s
</pre><div class="fragment"><div class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</div>
<div class="line"><span class="keyword">import</span> seaborn <span class="keyword">as</span> sns</div>
<div class="line"> </div>
<div class="line">fig, (ax1, ax2) = plt.subplots(2, 1, figsize=(2.5,5))</div>
<div class="line"> </div>
<div class="line">sns.scatterplot(x=[row[<span class="stringliteral">&#39;samples&#39;</span>] <span class="keywordflow">for</span> row <span class="keywordflow">in</span> the_statistics], y=[100*row[<span class="stringliteral">&#39;accepted&#39;</span>]/row[<span class="stringliteral">&#39;samples&#39;</span>] <span class="keywordflow">for</span> row <span class="keywordflow">in</span> the_statistics],ax=ax1)</div>
<div class="line">ax1.set_ylabel(<span class="stringliteral">&quot;Accepted percentage&quot;</span>)</div>
<div class="line">sns.scatterplot(x=[row[<span class="stringliteral">&#39;samples&#39;</span>] <span class="keywordflow">for</span> row <span class="keywordflow">in</span> the_statistics], y=[row[<span class="stringliteral">&#39;rmsd&#39;</span>] <span class="keywordflow">for</span> row <span class="keywordflow">in</span> the_statistics],ax=ax2)</div>
<div class="line">ax2.set_xlabel(<span class="stringliteral">&quot;Total samples&quot;</span>)</div>
<div class="line">ax2.set_ylabel(<span class="stringliteral">&quot;RMSD&quot;</span>)</div>
<div class="line">fig.tight_layout()</div>
<div class="line">plt.savefig(<span class="stringliteral">&#39;mdbs_design_run.pdf&#39;</span>)</div>
<div class="line">plt.show()</div>
<div class="line"> </div>
<div class="line"><span class="comment">#print(the_statistics[-1])</span></div>
</div><!-- fragment --><p ><img src="MultitargetRNADesign_files/MultitargetRNADesign_22_0.png" alt="png" class="inline"/></p>
<div class="fragment"><div class="line"><span class="keyword">import</span> math</div>
<div class="line"><span class="keyword">def </span>distribution_heatmaps(model,n,feature_list,fig,*,limits,labels,targets=None,ax=None,cmap=&quot;Blues&quot;):</div>
<div class="line">    sampler = ir.Sampler(model)</div>
<div class="line">    samples = [sampler.sample() <span class="keywordflow">for</span> _ <span class="keywordflow">in</span> range(n)]</div>
<div class="line">    </div>
<div class="line">    <span class="keyword">def </span>eval_features(sample):</div>
<div class="line">        <span class="keywordflow">return</span> {f:model.eval_feature(sample,f) <span class="keywordflow">for</span> f <span class="keywordflow">in</span> feature_list}</div>
<div class="line">    </div>
<div class="line">    features = [eval_features(sample) <span class="keywordflow">for</span> sample <span class="keywordflow">in</span> samples]</div>
<div class="line"> </div>
<div class="line">    k = len(feature_list)</div>
<div class="line">    </div>
<div class="line">    the_plots = [(i,j) <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(1,k) <span class="keywordflow">for</span> j <span class="keywordflow">in</span> range(0,i)]</div>
<div class="line">    nplots = len(the_plots)</div>
<div class="line">    dimx = int(math.sqrt(nplots))</div>
<div class="line">    dimy = nplots // dimx</div>
<div class="line">    </div>
<div class="line">    the_cells = [(i,j) <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(0,dimx) <span class="keywordflow">for</span> j <span class="keywordflow">in</span> range(0,dimy)]</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">if</span> ax <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line">        ax = fig.subplots(dimx,dimy+1,</div>
<div class="line">                          squeeze=<span class="keyword">False</span>,</div>
<div class="line">                          width_ratios=[1]*dimy+[1]</div>
<div class="line">                         )</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> x <span class="keywordflow">in</span> range(dimx):</div>
<div class="line">        <span class="keywordflow">for</span> y <span class="keywordflow">in</span> range(dimy+1):</div>
<div class="line">            <span class="keywordflow">if</span> (x,y) <span class="keywordflow">not</span> <span class="keywordflow">in</span> the_cells[:nplots]:</div>
<div class="line">                ax[x][y].axis(<span class="stringliteral">&quot;off&quot;</span>)</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> idx,(i,j) <span class="keywordflow">in</span> enumerate(the_plots):</div>
<div class="line"> </div>
<div class="line">        fi = feature_list[i]</div>
<div class="line">        fj = feature_list[j]</div>
<div class="line">        </div>
<div class="line">        cax = ax[the_cells[idx][0]][the_cells[idx][1]]</div>
<div class="line">        </div>
<div class="line">        sns.kdeplot(x=[f[fj] <span class="keywordflow">for</span> f <span class="keywordflow">in</span> features],y=[f[fi] <span class="keywordflow">for</span> f <span class="keywordflow">in</span> features], ax = cax,</div>
<div class="line">                cmap=cmap, levels=8, thresh=0.2, cbar = <span class="keyword">False</span>, fill=<span class="keyword">True</span>)</div>
<div class="line">        <span class="keywordflow">if</span> targets:</div>
<div class="line">            cax.axhline(y = targets[fi], color = <span class="stringliteral">&#39;red&#39;</span>, linestyle = <span class="stringliteral">&#39;dashed&#39;</span>)</div>
<div class="line">            cax.axvline(x = targets[fj], color = <span class="stringliteral">&#39;red&#39;</span>, linestyle = <span class="stringliteral">&#39;dashed&#39;</span>)</div>
<div class="line"> </div>
<div class="line">        cax.set_ylabel(labels[i])</div>
<div class="line">        cax.set_xlabel(labels[j])</div>
<div class="line"> </div>
<div class="line">        cax.set_ylim(limits[i])</div>
<div class="line">        cax.set_xlim(limits[j])</div>
<div class="line"> </div>
<div class="line">    plt.colorbar(plt.cm.ScalarMappable(cmap=cmap),ax=ax[0][dimy],</div>
<div class="line">        pad=0.2,</div>
<div class="line">        location=<span class="stringliteral">&quot;left&quot;</span>,</div>
<div class="line">        boundaries=[0.2+i/10 <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(9)],</div>
<div class="line">        values=[i/8 <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(1,9)])</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">return</span> ax</div>
</div><!-- fragment --><div class="fragment"><div class="line">sel_features = [<span class="stringliteral">&quot;E0&quot;</span>,<span class="stringliteral">&quot;E1&quot;</span>,<span class="stringliteral">&quot;E2&quot;</span>,<span class="stringliteral">&quot;gc&quot;</span>]</div>
<div class="line">labels = [<span class="stringliteral">&quot;E1&quot;</span>,<span class="stringliteral">&quot;E2&quot;</span>,<span class="stringliteral">&quot;E3&quot;</span>,<span class="stringliteral">&quot;GC content&quot;</span>]</div>
<div class="line">limits = [(-50,15),(-50,15),(-50,15),(30, seqlen)]</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">n = 1000</div>
<div class="line"> </div>
<div class="line">k=len(sel_features)</div>
<div class="line"> </div>
<div class="line">targets = {k:f.target <span class="keywordflow">for</span> k,f <span class="keywordflow">in</span> sampler.model.features.items() <span class="keywordflow">if</span> k <span class="keywordflow">in</span> sel_features}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">fig = plt.figure(figsize=(10,5))</div>
<div class="line">ax = distribution_heatmaps(model,n,sel_features,fig,</div>
<div class="line">                           limits=limits,labels=labels,cmap=<span class="stringliteral">&quot;Blues&quot;</span>)</div>
<div class="line">distribution_heatmaps(sampler.model,n,sel_features,fig,</div>
<div class="line">                      limits=limits,labels=labels,</div>
<div class="line">                      targets=targets,</div>
<div class="line">                      ax=ax,cmap=<span class="stringliteral">&quot;Reds&quot;</span>)</div>
<div class="line">fig.tight_layout()</div>
<div class="line">plt.savefig(<span class="stringliteral">&#39;mdbs_design_heatmaps.pdf&#39;</span>)</div>
<div class="line">plt.show()</div>
</div><!-- fragment --><p ><img src="MultitargetRNADesign_files/MultitargetRNADesign_24_0.png" alt="png" class="inline"/></p>
<div class="fragment"></div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4 </li>
  </ul>
</div>
</body>
</html>
