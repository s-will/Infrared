<!-- HTML header for doxygen 1.9.7-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.7"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Infrared: Bookchapter Tutorial</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<!--  -->
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="style.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript">
  DoxygenAwesomeDarkModeToggle.init()
</script>
<script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript">
  DoxygenAwesomeInteractiveToc.init()
</script>
<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript">
  DoxygenAwesomeParagraphLink.init()
</script>
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript">
  DoxygenAwesomeFragmentCopyButton.init()
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Infrared
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.7 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_Doc_2Tutorials_2Bookchapter.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Bookchapter Tutorial</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md58">Online resources and software environment</a></li>
<li class="level1"><a href="#autotoc_md60">Disclaimer</a></li>
<li class="level1"><a href="#autotoc_md61">1 Introduction</a><ul><li class="level2"><a href="#autotoc_md62">Multiple targets</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md63">3 Methods</a><ul><li class="level2"><a href="#autotoc_md64">3.1 Elementary use of Infrared - A simple design model</a></li>
<li class="level2"><a href="#autotoc_md65">3.2 Sequence constraints in IUPAC code</a></li>
<li class="level2"><a href="#autotoc_md66">3.3 Control of GC content</a></li>
<li class="level2"><a href="#autotoc_md67">3.4 Controlling energy - Multiple features</a></li>
<li class="level2"><a href="#autotoc_md68">3.5 Targeting Turner energy - Customized features</a></li>
<li class="level2"><a href="#autotoc_md69">3.6 Multiple target targets</a><ul><li class="level3"><a href="#autotoc_md70">Target specific GC content and high affinity to all targets</a></li>
<li class="level3"><a href="#autotoc_md71">Target specific GC content and specific Turner energies for all targets</a></li>
</ul>
</li>
<li class="level2"><a href="#autotoc_md72">Plot dependencies and tree decomposition</a></li>
<li class="level2"><a href="#autotoc_md73">3.7 Negative design by sampling</a></li>
<li class="level2"><a href="#autotoc_md74">3.8 Larger single-target designs by constraint generation</a></li>
<li class="level2"><a href="#autotoc_md75">3.9 Negative design by stochastic optimization with partial resampling</a></li>
<li class="level2"><a href="#autotoc_md76">3.10 A real world example: design of a Tandem-Riboswitch</a><ul><li class="level3"><a href="#autotoc_md77">Run optimzation in parallel</a></li>
</ul>
</li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md78">APPENDIX</a><ul><li class="level2"><a href="#autotoc_md79">Generate RNAPOND figures</a></li>
<li class="level2"><a href="#autotoc_md80">Generate stochastic optimization figure</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="autotoc_md56"></a></p>
<p>A collection of code from the Infrared RNA design bookchapter</p>
<hr  />
<h1><a class="anchor" id="autotoc_md58"></a>
Online resources and software environment</h1>
<p>​</p>
<p>This document is hosted online as <a href="https://www.lix.polytechnique.fr/~will/Software/Infrared/current/Doc/Bookchapter.ipynb">Jupyter notebook</a> with precomputed results. Download this file to view, edit and run it in Jupyter.</p>
<p>​</p>
<p>We recommend to install all required software using Mamba (or Conda) and PIP.</p>
<div class="fragment"><div class="line">mamba create -n infrared -c conda-forge infrared jupyter jupytext matplotlib seaborn graphviz logomaker</div>
<div class="line"> </div>
<div class="line">mamba activate infrared</div>
<div class="line"> </div>
<div class="line"># optionally install the Vienna RNA package (only Linux or MacOS)</div>
<div class="line">mamba install -c conda-forge -c bioconda viennarna</div>
<div class="line"> </div>
<div class="line">pip install graphviz</div>
<div class="line"> </div>
<div class="line">mamba deactivate infrared</div>
</div><!-- fragment --><p>​</p>
<p>Start the Jupyter notebook server after activating the environment</p>
<div class="fragment"><div class="line">mamba activate infrared</div>
<div class="line"> </div>
<div class="line">jupyter notebook</div>
</div><!-- fragment --><p>The <a href="https://gitlab.inria.fr/amibio/Infrared/-/tree/master/Doc/Tutorials">original sources</a> are part of the Infrared distribution and hosted on Gitlab (in Jupytext light Script format).</p>
<p>​</p>
<hr  />
<h1><a class="anchor" id="autotoc_md60"></a>
Disclaimer</h1>
<p>This notebook contains code for the examples from the bookchapter <a href="https://hal-lirmm.ccsd.cnrs.fr/X-LIX/hal-03711828v2">"Developing complex RNA design applications in the Infrared framework"</a> by Hua-Ting Yao, Yann Ponty, and Sebastian Will.</p>
<p>This document should be used <b>in parallel to the bookchapter</b>.</p>
<p>The main purpose of this notebook is to allow readers of the chapter to easily run examples and possibly experiment with the code. Code is therefore given in the same order as in the bookchapter and under corresponding section titles. In turn, the notebook contains almost no explanations, as these are given in the manuscript.</p>
<p>Compared to the code given in the chapter, we extended some code to make it even more illustrative, e.g. by plotting results. Finally, we provide code to generate figures of the bookchapter in the Appendix.</p>
<h1><a class="anchor" id="autotoc_md61"></a>
1 Introduction</h1>
<div class="fragment"><div class="line"><span class="comment">#[Intro]</span></div>
<div class="line"><span class="keyword">import</span> infrared <span class="keyword">as</span> ir</div>
<div class="line"><span class="keyword">import</span> <a class="code hl_namespace" href="namespaceinfrared_1_1rna.html">infrared.rna</a> <span class="keyword">as</span> rna</div>
<div class="ttc" id="anamespaceinfrared_1_1rna_html"><div class="ttname"><a href="namespaceinfrared_1_1rna.html">infrared.rna</a></div><div class="ttdef"><b>Definition</b> rna.py:1</div></div>
</div><!-- fragment --><div class="fragment"><div class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</div>
</div><!-- fragment --><div class="fragment"><div class="line">target = <span class="stringliteral">&quot;((((((((((...))))((((....))))))))))&quot;</span></div>
<div class="line">model = ir.Model(len(target), 4)</div>
<div class="line">model.add_constraints(rna.BPComp(i, j) <span class="keywordflow">for</span> (i, j) <span class="keywordflow">in</span> rna.parse(target))</div>
<div class="line">sampler = ir.Sampler(model)</div>
<div class="line">samples = [sampler.sample() <span class="keywordflow">for</span> _ <span class="keywordflow">in</span> range(10)]</div>
</div><!-- fragment --><div class="fragment"><div class="line">sequences = [rna.ass_to_seq(x) <span class="keywordflow">for</span> x <span class="keywordflow">in</span> samples]</div>
<div class="line">sequences</div>
</div><!-- fragment --><pre class="fragment">['GCAGUUGGAGCAGUUUUGCGAGGUUUCGCAACUGC',
 'CCGUGGGGCUUGAGGUUUCUCAAUGGGGAUUACGG',
 'UGGUGGUGGGCCUCCCAUUAAAUUCUUAGUUGCUA',
 'CUGUCACGUUCUCAGCGAAUAAAUAUAUUUGGUAG',
 'CGUUUGGAUUACAAGUUAAGUAAGAAUUUUAGGCG',
 'UCGAGGAAUUUGGAAUUGUAGUCUGUUAUCUUCGG',
 'AGCGUACGGCGCAGCUGCCGAGUCGUCGGUGUGCU',
 'AAGGUUGGGACCGUUCUGGGAGGAUUCCCAGCUUU',
 'GGAGGAAUGACUAUCGUGGGAUUUUUCCUUCCUUC',
 'ACGGUGACCGCUUCGGUUGUCGCUUGGCGUACUGU']
</pre><p>We are going to visualize the nucleotide frequencies of the sampled sequences if module <code>logomaker</code> is availabe. (e.g. install by <code>conda install logomaker</code>)</p>
<div class="fragment"><div class="line"><span class="keyword">def </span>draw_logo(samples,name=None):</div>
<div class="line">    <span class="keyword">import</span> logomaker <span class="keyword">as</span> lm</div>
<div class="line">    </div>
<div class="line">    sequences = [rna.ass_to_seq(x) <span class="keywordflow">for</span> x <span class="keywordflow">in</span> samples]</div>
<div class="line">    </div>
<div class="line">    matrix = lm.alignment_to_matrix(sequences = sequences)</div>
<div class="line">    logo = lm.Logo(matrix)</div>
<div class="line">    logo.style_xticks(rotation=90, fmt=<span class="stringliteral">&#39;%d&#39;</span>, anchor=0)</div>
<div class="line">    logo.ax.xaxis.set_ticks_position(<span class="stringliteral">&#39;none&#39;</span>)</div>
<div class="line">    <span class="keywordflow">if</span> name <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line">        plt.savefig(name)</div>
<div class="line">    plt.show()</div>
<div class="line">    logo.ax.xaxis.set_tick_params(pad=-1)</div>
<div class="line">    <span class="keywordflow">return</span> sequences</div>
<div class="line"> </div>
<div class="line"><span class="keyword">def </span>opt_draw_logo(samples,name=None,num=10):</div>
<div class="line">    <span class="keywordflow">try</span>:</div>
<div class="line">        draw_logo(samples,name)</div>
<div class="line">    <span class="keywordflow">except</span> ModuleNotFoundError <span class="keyword">as</span> e:</div>
<div class="line">        print(e)</div>
<div class="line">    <span class="keywordflow">for</span> x <span class="keywordflow">in</span> samples[:num]:</div>
<div class="line">        print(rna.ass_to_seq(x))</div>
<div class="line">    <span class="keywordflow">if</span> len(samples)&gt;num:</div>
<div class="line">        print(<span class="stringliteral">&quot;...&quot;</span>)</div>
<div class="line"> </div>
<div class="line"><span class="keyword">def </span>assignments_to_seqs(xs):</div>
<div class="line">    <span class="keywordflow">return</span> [rna.ass_to_seq(x) <span class="keywordflow">for</span> x <span class="keywordflow">in</span> xs]</div>
<div class="line"> </div>
<div class="line">opt_draw_logo(samples)</div>
</div><!-- fragment --><p><img src="Bookchapter_files/Bookchapter_8_0.png" alt="png" class="inline"/></p>
<pre class="fragment">GCAGUUGGAGCAGUUUUGCGAGGUUUCGCAACUGC
CCGUGGGGCUUGAGGUUUCUCAAUGGGGAUUACGG
UGGUGGUGGGCCUCCCAUUAAAUUCUUAGUUGCUA
CUGUCACGUUCUCAGCGAAUAAAUAUAUUUGGUAG
CGUUUGGAUUACAAGUUAAGUAAGAAUUUUAGGCG
UCGAGGAAUUUGGAAUUGUAGUCUGUUAUCUUCGG
AGCGUACGGCGCAGCUGCCGAGUCGUCGGUGUGCU
AAGGUUGGGACCGUUCUGGGAGGAUUCCCAGCUUU
GGAGGAAUGACUAUCGUGGGAUUUUUCCUUCCUUC
ACGGUGACCGCUUCGGUUGUCGCUUGGCGUACUGU
</pre><h2><a class="anchor" id="autotoc_md62"></a>
Multiple targets</h2>
<div class="fragment"><div class="line"><span class="comment">#[Multiple_targets]</span></div>
<div class="line">targets = [<span class="stringliteral">&quot;((((((((((...))))((((....))))))))))&quot;</span>,</div>
<div class="line">           <span class="stringliteral">&quot;((((((.((((((((....))))..))))))))))&quot;</span>,</div>
<div class="line">           <span class="stringliteral">&quot;.((((((...)))))).(((((((....)))))))&quot;</span>]</div>
</div><!-- fragment --><div class="fragment"><div class="line"><span class="keywordflow">for</span> target <span class="keywordflow">in</span> targets:</div>
<div class="line">    model.add_constraints(rna.BPComp(i, j) <span class="keywordflow">for</span> (i, j) <span class="keywordflow">in</span> rna.parse(target))</div>
</div><!-- fragment --><div class="fragment"><div class="line">sampler = ir.Sampler(model)</div>
<div class="line">designs = [sampler.sample() <span class="keywordflow">for</span> _ <span class="keywordflow">in</span> range(10)]</div>
<div class="line"> </div>
<div class="line">samples = [x <span class="keywordflow">for</span> x <span class="keywordflow">in</span> designs]</div>
<div class="line">opt_draw_logo(samples)</div>
</div><!-- fragment --><p><img src="Bookchapter_files/Bookchapter_12_0.png" alt="png" class="inline"/></p>
<pre class="fragment">GGGACAUAGGAUGUCUGGAGAUGGCUCUUUGUCUC
UUCUGAGUCCUUCGGAUUUUCGAUGGGGAUUGGGA
UUCUGUGUCUUGCGGAUUCCUGCUUGGGAGUAGGA
AGGAGGUGGGAUUUCCAGGGGGAAGUCCUUCUUUU
GGGAGUUGGAAGUUUUAAGGGGUGAUUUUGUUUUU
AAGGGUUAGAGGUUUUAAGGGGUACUUCUGUCCUU
GAGACGUGGGGUGUUUAGAGGUAGGCUUUUGUUUC
UUUUGGGCUCUCUGGGUCUCUGGCCAGGGUCGGAG
GGGGUCCGAGGGGCUCGGAGGUCGCCUUCGAUUUC
GGGACGUGGGAUGUCCAGAGACGGGUCUUCGUUUU
</pre><div class="fragment"><div class="line"><span class="comment">#[Multiple_targets-bpenergy]</span></div>
<div class="line"><span class="keywordflow">for</span> target <span class="keywordflow">in</span> targets:</div>
<div class="line">    model.add_functions([rna.BPEnergy(i, j, <span class="keyword">False</span>) <span class="keywordflow">for</span> (i, j) <span class="keywordflow">in</span> rna.parse(target)], <span class="stringliteral">&#39;energy&#39;</span>)</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md63"></a>
3 Methods</h1>
<h2><a class="anchor" id="autotoc_md64"></a>
3.1 Elementary use of Infrared - A simple design model</h2>
<div class="fragment"><div class="line"><span class="comment">#[3.1]</span></div>
<div class="line">n = 35</div>
</div><!-- fragment --><div class="fragment"><div class="line">model = ir.Model(n,4)</div>
</div><!-- fragment --><div class="fragment"><div class="line">target = <span class="stringliteral">&quot;((((((((((...))))((((....))))))))))&quot;</span></div>
<div class="line">model.add_constraints(rna.BPComp(i, j) <span class="keywordflow">for</span> (i, j) <span class="keywordflow">in</span> rna.parse(target))</div>
</div><!-- fragment --><div class="fragment"><div class="line">sampler = ir.Sampler(model)</div>
</div><!-- fragment --><div class="fragment"><div class="line">samples = [sampler.sample() <span class="keywordflow">for</span> _ <span class="keywordflow">in</span> range(10)]</div>
</div><!-- fragment --><div class="fragment"><div class="line">sequences = [rna.ass_to_seq(sample) <span class="keywordflow">for</span> sample <span class="keywordflow">in</span> samples]</div>
</div><!-- fragment --><div class="fragment"><div class="line">opt_draw_logo(samples)</div>
</div><!-- fragment --><p><img src="Bookchapter_files/Bookchapter_22_0.png" alt="png" class="inline"/></p>
<pre class="fragment">CUGUGGGGAGUAUCUCUGCGCCGUAGCGCUCGCGG
UGGGGUUAGUGUUGCUAUCUGGUACCGGGGCUCCA
UGGGGUUCAUAGGAUGAUCAAAUAAUUGGGUUCUA
CUAAUUCGAUCCGAUCGACGAAGGCUCGUGAUUAG
UUUGGGGAGUUAAACUUUUUGGUUGUGGGUCCAGG
GGUGGUGCGGAGAUUGCGACUAGUGAGUUACCGCU
CGGGAGCUAUUGGAUAGACUGUUAUUAGUUUUUCG
UAAUAAGUCCAGCGGGCGCGGACACUCGUUUGUUA
UUGCCCUGGUUGCGUCAUUCCCCAAGGGGGGGUGA
UUCAUGGUAUUACAUGCUCGAAUCGUUGGUGUGAA
</pre><h2><a class="anchor" id="autotoc_md65"></a>
3.2 Sequence constraints in IUPAC code</h2>
<div class="fragment"><div class="line"><span class="comment">#[3.2]</span></div>
<div class="line">iupac_sequence = <span class="stringliteral">&quot;SNNNNNNNNNRYYNNNNNNNNGNRANNNNNNNNNS&quot;</span></div>
</div><!-- fragment --><div class="fragment"><div class="line"><span class="keywordflow">for</span> i, x <span class="keywordflow">in</span> enumerate(iupac_sequence):</div>
<div class="line">    model.add_constraints(ir.ValueIn(i, rna.iupacvalues(x)))</div>
</div><!-- fragment --><div class="fragment"><div class="line">sampler = ir.Sampler(model)</div>
</div><!-- fragment --><div class="fragment"><div class="line">samples = [sampler.sample() <span class="keywordflow">for</span> _ <span class="keywordflow">in</span> range(20)]</div>
<div class="line"> </div>
<div class="line">opt_draw_logo(samples)</div>
</div><!-- fragment --><p><img src="Bookchapter_files/Bookchapter_27_0.png" alt="png" class="inline"/></p>
<pre class="fragment">CUACAUUCCGGUCCGGAUUUUGGGAGGGAAUGUGG
CUCUAGUGUGAUUCGCAGUGCGAGAGCGUCUAGAG
CGUUGUAUUUAUCGGGUCUUUGUAAGGAGGUGGCG
CGGGUGGGGGACCCCCUACGAGUAAUCGUCAUUCG
CGGGGUUGCUGUUAGUACAAGGCGAUUUGAUUCUG
GUGGUGAGUGAUCUACUUAACGAGAGUUGUGCCGC
GGACCUUUAAGCUUUAAGUUAGCAAUGACGGGUCC
GUUAGUUUAGACCUUGAUAUAGGGAUGUGGCUGAC
GAGGCUGACUAUUAGUCAACUGGGAGGUUAGCCUC
GAUCAUUUCUACUAGAAGGAUGUGAGUUUGUGAUC
...
</pre><h2><a class="anchor" id="autotoc_md66"></a>
3.3 Control of GC content</h2>
<p>add functions for GC control:</p>
<div class="fragment"><div class="line"><span class="comment">#[3.3]</span></div>
<div class="line">model.add_functions([rna.GCCont(i) <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(n)], <span class="stringliteral">&#39;gc&#39;</span>)</div>
</div><!-- fragment --><p>set a weight and sample</p>
<div class="fragment"><div class="line">model.set_feature_weight(1, <span class="stringliteral">&#39;gc&#39;</span>)</div>
<div class="line">sampler = ir.Sampler(model)</div>
<div class="line">samples = [sampler.sample() <span class="keywordflow">for</span> _ <span class="keywordflow">in</span> range(1000)]</div>
</div><!-- fragment --><div class="fragment"><div class="line">opt_draw_logo(samples)</div>
</div><!-- fragment --><p><img src="Bookchapter_files/Bookchapter_33_0.png" alt="png" class="inline"/></p>
<pre class="fragment">CUGGGCGAGCGUCGCUCUAGGGGGACCUGGCCCAG
GGCCGGGGGUGCCGUCCGGCCGGGAGGCCCCGGUC
GGUUUGUCGGAUCUCGGGUCGGCGAUGACCAGGCC
CGGUGCGAUUGCUGGUCUGCUGGAAAGCGGCGCCG
GGACCCCCGCGCCGUGGCCUUGCGAGAGGGGGUUC
CCCGCCCGGAGUCUCUGUCCCGGGAGGGGGGCGGG
CGCCGCUUCGGCUCGGGGAGGGUAACCUCGUGGCG
CGCCGGCCCGGCUUGGGCGGCGGAAGCCGCCGGCG
GCGGGGGUGUGCUACACCCCAGAGAUGGGCCCCGC
CGCCGGCCGGACUUUGGGGGGGCGACCCCUCGGUG
...
</pre><div class="fragment"><div class="line"><span class="comment"># Code to produce the figures in the paper</span></div>
<div class="line">WRITEFIGS = <span class="keyword">False</span></div>
<div class="line"><span class="keywordflow">for</span> name,weight <span class="keywordflow">in</span> [(<span class="stringliteral">&#39;minus&#39;</span>, -1), (<span class="stringliteral">&#39;zero&#39;</span>, 0), (<span class="stringliteral">&#39;plus&#39;</span>, 1)]:</div>
<div class="line">    </div>
<div class="line">    model.set_feature_weight(weight, <span class="stringliteral">&#39;gc&#39;</span>)</div>
<div class="line">    sampler = ir.Sampler(model)</div>
<div class="line">    samples = [sampler.sample() <span class="keywordflow">for</span> _ <span class="keywordflow">in</span> range(1000)]</div>
<div class="line"> </div>
<div class="line">    opt_draw_logo(samples, f<span class="stringliteral">&quot;gc_content_{name}-logo.svg&quot;</span>)</div>
<div class="line">    sequences = assignments_to_seqs(samples)</div>
<div class="line"> </div>
<div class="line">    gc_contents = [100*sum(x <span class="keywordflow">in</span> <span class="stringliteral">&quot;GC&quot;</span> <span class="keywordflow">for</span> x <span class="keywordflow">in</span> sequence)/len(sequence) <span class="keywordflow">for</span> sequence <span class="keywordflow">in</span> sequences]</div>
<div class="line">    h = plt.hist(gc_contents,bins=10,range=(0,100))</div>
<div class="line">    <span class="keywordflow">if</span> WRITEFIGS:</div>
<div class="line">        plt.savefig(f<span class="stringliteral">&quot;gc_content_{name}-hist.svg&quot;</span>)</div>
</div><!-- fragment --><p><img src="Bookchapter_files/Bookchapter_34_0.png" alt="png" class="inline"/></p>
<pre class="fragment">CAUAAUUUUUGUUAAAAGUGAGGAAUUACAUUAUG
GUAAUUUGAUACUGUUGAUAUGUGAAUAUAAUUGC
CUUCUUUAUUAUCAAUGUAUAGAAAUAUAAAGGAG
GGUAGAUAUAGUCUGUAAUAUGAAAAUAUUCUAUC
GUUUAUUCGAAUUUUGGAAUUGAAAAAUUGUAGAC
CUCAGUAAGAAUUUUUUUUUUGUAAAAAAAUUGAG
CUUCUAGUAUAUCAUAUUAUAGGAAUGUAUAGAGG
CUUAAAAUAUAUUAUAUAGUUGGAAGAUUUUUGAG
CUUUUAAUUAAUUUAAUUAUUGUAAAAUAUAAAAG
CUUUUGUUUUGUUAAGGAAAUGUAAAUUUCGAAAG
...
</pre><p><img src="Bookchapter_files/Bookchapter_34_2.png" alt="png" class="inline"/></p>
<p><img src="Bookchapter_files/Bookchapter_34_3.png" alt="png" class="inline"/></p>
<pre class="fragment">GCUAGAUGGUGCCACUGGAGUGAAAGCUUUCUGGC
CACAGAAGUUGCCAGUUUCCGGUGAUGGAUCUGUG
CAGUGACUCGACCUGGGGACGGCAAUGUUUUACUG
CUCAACUCAGAUCCUGAUUAGGAAACUAAGUUGGG
CUGCUUGGACGUCGUUUUCUCGGGAGAGGAGGUAG
GAAUAGGCGGACUUUGCUGCCGUAAGGCGUUAUUC
GUUUCGGUGGAUCCUGUAAAGGAGAUUUUCGGAAC
CGGCUUGGGUGUCGUUUGAGUGGAAAUUCAGGUUG
GGGACUGGGGACCCUUUUUGCGAGAGUAAAGUCUC
GGUGACCGUUACCAACGGCCGGCGAUGGUGUUGCC
...
</pre><p><img src="Bookchapter_files/Bookchapter_34_5.png" alt="png" class="inline"/></p>
<p><img src="Bookchapter_files/Bookchapter_34_6.png" alt="png" class="inline"/></p>
<pre class="fragment">GCAUAUCGCGACCCGCGCGUGGGGACACGAUGUGC
GGCAUAGCGCGCCGUGCUGCCGCAAGGUGUAUGCC
CGGCGCGUCGACCCGACCUGCGGAAGCGGGCGCCG
CGCGCUGGGGGCCCUCCCCGAGGGAUCGGAGCGCG
CUGGUGGGUGGUCCACUUGGCGUGAGCCGCGCCGG
CGGGGGCCGGGCCCCGGCGCCGUGAGGUGCUUCCG
CCGGGGGGCCGCCGGCCGGGUGUGAGCCCCCCCGG
CGCGCCGCGGGCUCCGCUCGCGAGAGCGAGGUGCG
GGUGCGCGGGGUCCCCGGCCGGAGAUGGCUGUACC
GCCGUGGGGGACCUCCCGUGCGCGAGCACUGUGGC
...
</pre><p><img src="Bookchapter_files/Bookchapter_34_8.png" alt="png" class="inline"/></p>
<p>Set a target of 75% GC content and then draw targeted samples</p>
<div class="fragment"><div class="line"><span class="comment">#[3.3.3]</span></div>
<div class="line">sampler = ir.Sampler(model)</div>
<div class="line">sampler.set_target( 0.75 * n, 0.01 * n, <span class="stringliteral">&#39;gc&#39;</span> )</div>
<div class="line">samples = [sampler.targeted_sample() <span class="keywordflow">for</span> _ <span class="keywordflow">in</span> range(1000)]</div>
</div><!-- fragment --><div class="fragment"><div class="line">opt_draw_logo(samples)</div>
<div class="line">sequences = assignments_to_seqs(samples)</div>
<div class="line"> </div>
<div class="line">gc_contents = [100*sum(x <span class="keywordflow">in</span> <span class="stringliteral">&quot;GC&quot;</span> <span class="keywordflow">for</span> x <span class="keywordflow">in</span> sequence)/len(sequence) <span class="keywordflow">for</span> sequence <span class="keywordflow">in</span> sequences]</div>
<div class="line">gc_content = sum(gc_contents) / len(gc_contents)</div>
<div class="line">print(f<span class="stringliteral">&quot;GC content in samples: {gc_content:0.2f}%&quot;</span>)</div>
</div><!-- fragment --><p><img src="Bookchapter_files/Bookchapter_37_0.png" alt="png" class="inline"/></p>
<pre class="fragment">CCCAGGGGGGACCCUCCGUCGGCGACGACUUUGGG
GCGGGCGUGGAUCCCGCCCGUGCGAAUGGGCUUGC
GGUUCCAACUGCUGGUUGCGGGGGACCGCGGGGCC
GCCAGUCGGGACCUCCGGGGGGCAAUUCCGCUGGC
GGCGUUGGGGGUCUUUCCCGUGCGAGCGGGGCGUC
GGGGCGCCGUACUGCGGGUUGGCAACGGUCGCUCC
CCGGACUUGGAUCUCGACCGGGGGACCGGGUCCGG
GCCGCGCUAUGCCGUGGGUGCGCAAGUGUCGCGGC
GGGGUCCUUAGCUUAGGCCCUGGGAGGGGGGCCCC
GCUUCGGGUCGCUGACCGCACGCAAGUGCCGGGGC
...
GC content in samples: 74.29%
</pre><h2><a class="anchor" id="autotoc_md67"></a>
3.4 Controlling energy - Multiple features</h2>
<div class="fragment"><div class="line"><span class="comment">#[3.4]</span></div>
<div class="line">model = ir.Model(n,4)</div>
<div class="line">bps = rna.parse(target)</div>
<div class="line">model.add_constraints(rna.BPComp(i, j) <span class="keywordflow">for</span> (i, j) <span class="keywordflow">in</span> bps)</div>
<div class="line">model.add_functions([rna.GCCont(i) <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(n)], <span class="stringliteral">&#39;gc&#39;</span>)</div>
</div><!-- fragment --><p>add (base pair) energy control</p>
<div class="fragment"><div class="line">model.add_functions([rna.BPEnergy(i, j, (i-1, j+1) <span class="keywordflow">not</span> <span class="keywordflow">in</span> bps)</div>
<div class="line">                     <span class="keywordflow">for</span> (i, j) <span class="keywordflow">in</span> bps], <span class="stringliteral">&#39;energy&#39;</span>)</div>
</div><!-- fragment --><p>target specific GC and low energy</p>
<div class="fragment"><div class="line">model.set_feature_weight(-2, <span class="stringliteral">&#39;energy&#39;</span>)</div>
<div class="line">sampler = ir.Sampler(model)</div>
<div class="line">sampler.set_target(0.75*n, 0.01*n, <span class="stringliteral">&#39;gc&#39;</span>)</div>
<div class="line">samples = [sampler.targeted_sample() <span class="keywordflow">for</span> _ <span class="keywordflow">in</span> range(10)]</div>
</div><!-- fragment --><div class="fragment"><div class="line">opt_draw_logo(samples)</div>
</div><!-- fragment --><p><img src="Bookchapter_files/Bookchapter_44_0.png" alt="png" class="inline"/></p>
<pre class="fragment">CCGGGCUCCGAGUCGGGCUGGCUAUCCAGGCCUGG
GCCGGGCGCUCUAGGCGCCUCGACUGAGGUUCGGC
CCGGGGCGUGAACCGCGUCCUUCCAGGGACUCCGG
GCGGCCACCCCGUGGGUGGGUUAACAUCCGGCCGC
CCGGGCCGGGCAAUCCGUGCCAGAAGGCAGCCUGG
AGCGCACCACUCGGUGGGGGCCGCCGCUCUGUGCU
AGGUGCUGCGGCUCGCACGGCACCAGCCGGCGCUU
GCGCUAGCGCCUAGCGCCGCGAAUCCGCGUAGCGC
CCGGGGGGCCAUGGGCCCCUAUUGAUAGGCCCCGG
UUCGGCGAGGCUACUUCGCCUGAGGGGGCGCCGGG
</pre><p>add stacking energy control - this could be used in place of defining base pair energyin the code above</p>
<div class="fragment"><div class="line"><span class="comment">#[stackenergy]</span></div>
<div class="line">model.add_functions([rna.StackEnergy(i, j)</div>
<div class="line">    <span class="keywordflow">for</span> (i,j) <span class="keywordflow">in</span> bps <span class="keywordflow">if</span> (i+1,j-1) <span class="keywordflow">in</span> bps], <span class="stringliteral">&#39;energy&#39;</span>)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md68"></a>
3.5 Targeting Turner energy - Customized features</h2>
<p><em>Note:</em> From this point on, we require RNA energy evaluation based on the Vienna RNA library. Under Mac and Linux, the functionality is accessed via module RNA of the library. Since, this is typically unavailable on Windows, we provide a work around.</p>
<div class="fragment"><div class="line"><span class="comment">#[3.5]</span></div>
<div class="line"><span class="keywordflow">try</span>:</div>
<div class="line">    <span class="keyword">from</span> RNA <span class="keyword">import</span> energy_of_struct</div>
<div class="line"><span class="keywordflow">except</span>:</div>
<div class="line">    print(<span class="stringliteral">&quot;*Warning*: the RNA Python bindings cannot be imported.\n\n&quot;</span></div>
<div class="line">          <span class="stringliteral">&quot;For Linux and MaxOS it is recommened to install viennarna via conda. &quot;</span></div>
<div class="line">          <span class="stringliteral">&quot;Windows users are asked to install the Vienna package using the provided Windows installer &quot;</span></div>
<div class="line">          <span class="stringliteral">&quot;and make sure that the command line tool RNAeval is found based on their search path.&quot;</span></div>
<div class="line">         )</div>
<div class="line">    <span class="keyword">def </span>energy_of_struct(seq,struct):</div>
<div class="line">        <span class="keywordflow">try</span>:</div>
<div class="line">            <span class="keyword">import</span> subprocess</div>
<div class="line">            <span class="keyword">import</span> re</div>
<div class="line">            p = subprocess.run([<span class="stringliteral">&quot;RNAeval&quot;</span>], input=f<span class="stringliteral">&quot;{seq}\n{struct}&quot;</span>.encode(<span class="stringliteral">&#39;utf-8&#39;</span>), capture_output=<span class="keyword">True</span>)</div>
<div class="line">            m = re.search(<span class="stringliteral">r&#39;([0-9-.]*)\&zwj;)$&#39;</span>,p.stdout.decode(<span class="stringliteral">&#39;utf-8&#39;</span>).split(<span class="stringliteral">&#39;\n&#39;</span>)[1])</div>
<div class="line">            res = float(m[1])</div>
<div class="line">        <span class="keywordflow">except</span> Exception <span class="keyword">as</span> e:</div>
<div class="line">            print(f<span class="stringliteral">&quot;Cannot evaluate energy of {seq}, {struct}&quot;</span>)</div>
<div class="line">            <span class="keywordflow">raise</span> e</div>
<div class="line">        <span class="keywordflow">return</span> res</div>
</div><!-- fragment --><div class="fragment"><div class="line"><span class="comment"># Restate current model</span></div>
<div class="line">model = ir.Model(n,4) </div>
<div class="line">bps = rna.parse(target)</div>
<div class="line">model.add_constraints(rna.BPComp(i, j) <span class="keywordflow">for</span> (i, j) <span class="keywordflow">in</span> bps)</div>
<div class="line">model.add_functions([rna.GCCont(i) <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(n)], <span class="stringliteral">&#39;gc&#39;</span>)</div>
<div class="line">model.add_functions([rna.BPEnergy(i, j, (i-1, j+1) <span class="keywordflow">not</span> <span class="keywordflow">in</span> bps)</div>
<div class="line">                     <span class="keywordflow">for</span> (i, j) <span class="keywordflow">in</span> bps], <span class="stringliteral">&#39;energy&#39;</span>)</div>
</div><!-- fragment --><p>add the Turner energy feature</p>
<div class="fragment"><div class="line">model.add_feature(<span class="stringliteral">&#39;Energy&#39;</span>, <span class="stringliteral">&#39;energy&#39;</span>,</div>
<div class="line">    <span class="keyword">lambda</span> sample, target=target:</div>
<div class="line">        energy_of_struct(rna.ass_to_seq(sample), target))</div>
</div><!-- fragment --><p>specify targets and draw targeted samples</p>
<div class="fragment"><div class="line">sampler = ir.Sampler(model)</div>
<div class="line">sampler.set_target(0.75*n, 0.05*n, <span class="stringliteral">&#39;gc&#39;</span>)</div>
<div class="line">sampler.set_target(-10, 0.5, <span class="stringliteral">&#39;Energy&#39;</span>)</div>
<div class="line">samples = [sampler.targeted_sample() <span class="keywordflow">for</span> _ <span class="keywordflow">in</span> range(10)]</div>
</div><!-- fragment --><div class="fragment"><div class="line">opt_draw_logo(samples)</div>
<div class="line">sequences = assignments_to_seqs(samples)</div>
<div class="line"> </div>
<div class="line">[(seq,energy_of_struct(seq, target)) <span class="keywordflow">for</span> seq <span class="keywordflow">in</span> sequences]</div>
</div><!-- fragment --><p><img src="Bookchapter_files/Bookchapter_54_0.png" alt="png" class="inline"/></p>
<pre class="fragment">CUACGUGCGGAAGCCGCGCGCUGCAGCGCGUGUGG
GGCCGCUUGGUGGUCAGUGGGGGUCCCUGGCGGCC
CGCCUGCGCUGACAGUGGCUGCUCGCAGCUGGGCG
CCUGCGUGGCCCGGCCAGAUCUCGGGGUUCGCGGG
CCGGCUUGGCCUGGCCGGGGGAUGGUUUCGGCCGG
UGUGCCUACAGAUUGUGCGCCGCCGGGCGGGUGCG
AUCUGGGUGGCCCCUGCGGGUCCUCACCCCCGGAU
UUUGUCCGUGCAGCGCGGGGCUCCAGCCCGGCGGG
CAUCCGUGCGACAUGCAGGCGACGGUGCCCGGGUG
UGCACGGCUCAUGGGGCUGGGCGACCUCACGUGCG





[('CUACGUGCGGAAGCCGCGCGCUGCAGCGCGUGUGG', -10.399999618530273),
 ('GGCCGCUUGGUGGUCAGUGGGGGUCCCUGGCGGCC', -10.100000381469727),
 ('CGCCUGCGCUGACAGUGGCUGCUCGCAGCUGGGCG', -10.100000381469727),
 ('CCUGCGUGGCCCGGCCAGAUCUCGGGGUUCGCGGG', -10.199999809265137),
 ('CCGGCUUGGCCUGGCCGGGGGAUGGUUUCGGCCGG', -10.0),
 ('UGUGCCUACAGAUUGUGCGCCGCCGGGCGGGUGCG', -10.199999809265137),
 ('AUCUGGGUGGCCCCUGCGGGUCCUCACCCCCGGAU', -9.600000381469727),
 ('UUUGUCCGUGCAGCGCGGGGCUCCAGCCCGGCGGG', -9.800000190734863),
 ('CAUCCGUGCGACAUGCAGGCGACGGUGCCCGGGUG', -10.199999809265137),
 ('UGCACGGCUCAUGGGGCUGGGCGACCUCACGUGCG', -9.600000381469727)]
</pre><h2><a class="anchor" id="autotoc_md69"></a>
3.6 Multiple target targets</h2>
<div class="fragment"><div class="line"><span class="comment">#[3.6]</span></div>
<div class="line">model = ir.Model(n,4) </div>
<div class="line">model.add_functions([rna.GCCont(i) <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(n)], <span class="stringliteral">&#39;gc&#39;</span>)</div>
<div class="line"><span class="keywordflow">for</span> k, target <span class="keywordflow">in</span> enumerate(targets):</div>
<div class="line">    bps = rna.parse(target)</div>
<div class="line">    model.add_constraints(rna.BPComp(i, j) <span class="keywordflow">for</span> (i, j) <span class="keywordflow">in</span> bps)</div>
<div class="line">    model.add_functions([rna.BPEnergy(i, j, (i-1, j+1) <span class="keywordflow">not</span> <span class="keywordflow">in</span> bps)</div>
<div class="line">                         <span class="keywordflow">for</span> (i, j) <span class="keywordflow">in</span> bps], f<span class="stringliteral">&#39;energy{k}&#39;</span>)</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md70"></a>
Target specific GC content and high affinity to all targets</h3>
<div class="fragment"><div class="line"><span class="comment"># set weights for energy targets</span></div>
<div class="line"><span class="keywordflow">for</span> k,_ <span class="keywordflow">in</span> enumerate(targets):</div>
<div class="line">    model.set_feature_weight(-2, f<span class="stringliteral">&#39;energy{k}&#39;</span>)</div>
<div class="line"> </div>
<div class="line"><span class="comment"># create sampler and set target</span></div>
<div class="line">sampler = ir.Sampler(model)</div>
<div class="line">sampler.set_target(0.75*n, 0.05*n, <span class="stringliteral">&#39;gc&#39;</span>)</div>
<div class="line">samples = [sampler.targeted_sample() <span class="keywordflow">for</span> _ <span class="keywordflow">in</span> range(5)]</div>
<div class="line"> </div>
<div class="line">opt_draw_logo(samples)</div>
<div class="line">sequences = assignments_to_seqs(samples)</div>
<div class="line"> </div>
<div class="line"><span class="comment"># annotate sequences with energies (annotate with Turner energies only if RNA module is available)</span></div>
<div class="line"><span class="keywordflow">try</span>:</div>
<div class="line">    <span class="keyword">import</span> RNA</div>
<div class="line">    sequences = [<span class="stringliteral">&quot;&quot;</span>.join([seq]+[f<span class="stringliteral">&quot; {energy_of_struct(seq, target):5.1f}&quot;</span> <span class="keywordflow">for</span> target <span class="keywordflow">in</span> targets]) <span class="keywordflow">for</span> seq <span class="keywordflow">in</span> sequences]</div>
<div class="line"><span class="keywordflow">except</span> ModuleNotFoundError:</div>
<div class="line">    <span class="keywordflow">pass</span></div>
<div class="line"> </div>
<div class="line">sequences</div>
</div><!-- fragment --><p><img src="Bookchapter_files/Bookchapter_58_0.png" alt="png" class="inline"/></p>
<pre class="fragment">AGGGGCCAGGGGUCCUGGGGGGCACCCCUGCCCCU
CCCCGGGCCUCUCGGGUCCUCGGUUGAGGCCGGGG
CCCCCCAUCCUGGGGGUUCCCCCUUGGGGGGGGGG
UCCCGCACCCUGCGGGUCCCCGUUUGGGGGCGGGG
CCCCCGAUCCUCGGGGUUCCCCGUUGGGACGGGGG





['AGGGGCCAGGGGUCCUGGGGGGCACCCCUGCCCCU -17.6 -21.8 -19.3',
 'CCCCGGGCCUCUCGGGUCCUCGGUUGAGGCCGGGG -16.8 -20.0 -18.0',
 'CCCCCCAUCCUGGGGGUUCCCCCUUGGGGGGGGGG -16.0 -24.2 -21.5',
 'UCCCGCACCCUGCGGGUCCCCGUUUGGGGGCGGGG -19.0 -21.9 -19.3',
 'CCCCCGAUCCUCGGGGUUCCCCGUUGGGACGGGGG -15.5 -23.4 -20.1']
</pre><h3><a class="anchor" id="autotoc_md71"></a>
Target specific GC content and specific Turner energies for all targets</h3>
<p>add Turner energy features for all target targets</p>
<div class="fragment"><div class="line"><span class="comment">#[add-multi-energy-features]</span></div>
<div class="line"><span class="keywordflow">for</span> k, target <span class="keywordflow">in</span> enumerate(targets):</div>
<div class="line">    model.add_feature(f<span class="stringliteral">&#39;Energy{k}&#39;</span>, f<span class="stringliteral">&#39;energy{k}&#39;</span>,</div>
<div class="line">        <span class="keyword">lambda</span> sample, target=target:</div>
<div class="line">            energy_of_struct(rna.ass_to_seq(sample), target))</div>
<div class="line">sampler = ir.Sampler(model)</div>
<div class="line">sampler.set_target(0.75*n, 0.01*n, <span class="stringliteral">&#39;gc&#39;</span>)</div>
<div class="line">sampler.set_target( -15, 1, <span class="stringliteral">&#39;Energy0&#39;</span>)</div>
<div class="line">sampler.set_target( -20, 1, <span class="stringliteral">&#39;Energy1&#39;</span>)</div>
<div class="line">sampler.set_target( -20, 1, <span class="stringliteral">&#39;Energy2&#39;</span>)</div>
</div><!-- fragment --><div class="fragment"><div class="line">samples = [sampler.targeted_sample() <span class="keywordflow">for</span> _ <span class="keywordflow">in</span> range(5)]</div>
</div><!-- fragment --><div class="fragment"><div class="line">opt_draw_logo(samples)</div>
<div class="line">sequences = assignments_to_seqs(samples)</div>
<div class="line"> </div>
<div class="line"><span class="comment"># annotate sequences with energies</span></div>
<div class="line">[<span class="stringliteral">&quot;&quot;</span>.join([seq]+[f<span class="stringliteral">&quot; {energy_of_struct(seq, target):5.1f}&quot;</span> <span class="keywordflow">for</span> target <span class="keywordflow">in</span> targets]) <span class="keywordflow">for</span> seq <span class="keywordflow">in</span> sequences]</div>
</div><!-- fragment --><p><img src="Bookchapter_files/Bookchapter_63_0.png" alt="png" class="inline"/></p>
<pre class="fragment">AGGGCCUGGGAGGCCCGAGGGUCGAUCCUGGCCCU
CCCCCAGCUCCUGGGGUCCCCUAUAGGGGUGGGGG
AGGGGCUGGAGGCUCUAGGGGGCGACUCCGCCCCU
GGGGCUUGGGGAGCCCAGGGGCUAGCUCUAGCCCC
UCCUCCACCCUGGGGGUCCCUCCCAAGGGGGAGGG





['AGGGCCUGGGAGGCCCGAGGGUCGAUCCUGGCCCU -14.7 -20.8 -19.8',
 'CCCCCAGCUCCUGGGGUCCCCUAUAGGGGUGGGGG -15.9 -19.6 -19.2',
 'AGGGGCUGGAGGCUCUAGGGGGCGACUCCGCCCCU -15.0 -20.9 -19.3',
 'GGGGCUUGGGGAGCCCAGGGGCUAGCUCUAGCCCC -14.3 -19.2 -20.7',
 'UCCUCCACCCUGGGGGUCCCUCCCAAGGGGGAGGG -15.2 -19.8 -20.7']
</pre><h2><a class="anchor" id="autotoc_md72"></a>
Plot dependencies and tree decomposition</h2>
<div class="fragment"><div class="line"><span class="keyword">from</span> IPython.display <span class="keyword">import</span> Image</div>
<div class="line"><span class="keyword">import</span> re</div>
</div><!-- fragment --><div class="fragment"><div class="line"><span class="comment"># Plot dependency graph</span></div>
<div class="line"> </div>
<div class="line">filename = <span class="stringliteral">&#39;dependency_graph.dot&#39;</span></div>
<div class="line">model.write_graph(filename, <span class="keyword">True</span>)</div>
<div class="line"> </div>
<div class="line">ir.dotfile_to_png(filename)</div>
<div class="line">ir.dotfile_to_pdf(filename)</div>
<div class="line"> </div>
<div class="line">filename = re.sub(<span class="stringliteral">r&quot;dot$&quot;</span>,<span class="stringliteral">&quot;png&quot;</span>,filename)</div>
<div class="line"> </div>
<div class="line">Image(filename=filename,width=600)</div>
</div><!-- fragment --><p><img src="Bookchapter_files/Bookchapter_66_0.png" alt="png" class="inline"/></p>
<div class="fragment"><div class="line"><span class="comment"># Plot tree decomposition</span></div>
<div class="line">sampler = ir.Sampler(model)</div>
<div class="line">print(f<span class="stringliteral">&quot;Tree width: {sampler.treewidth()}&quot;</span>)</div>
<div class="line">filename=<span class="stringliteral">&quot;treedecomp&quot;</span></div>
<div class="line">sampler.plot_td(filename,<span class="stringliteral">&#39;png&#39;</span>)</div>
<div class="line">sampler.plot_td(filename,<span class="stringliteral">&#39;pdf&#39;</span>)</div>
<div class="line">sampler.plot_td(filename+<span class="stringliteral">&quot;.dot&quot;</span>,<span class="stringliteral">&#39;dot&#39;</span>)</div>
<div class="line">Image(filename=filename+<span class="stringliteral">&quot;.png&quot;</span>,width=300)</div>
</div><!-- fragment --> <pre class="fragment">Tree width: 2
</pre><p><img src="Bookchapter_files/Bookchapter_67_1.png" alt="png" class="inline"/></p>
<h2><a class="anchor" id="autotoc_md73"></a>
3.7 Negative design by sampling</h2>
<div class="fragment"><div class="line"><span class="comment">#[3.7]</span></div>
<div class="line"><span class="keyword">import</span> RNA</div>
</div><!-- fragment --><div class="fragment"><div class="line">target = targets[0]</div>
<div class="line">n = len(target)</div>
</div><!-- fragment --><div class="fragment"><div class="line"><span class="keyword">def </span>is_mfe_design(sequence, target):</div>
<div class="line">    fc = RNA.fold_compound(sequence)</div>
<div class="line">    <span class="keywordflow">return</span> fc.eval_structure(target) == fc.mfe()[1]</div>
</div><!-- fragment --><div class="fragment"><div class="line"><span class="keyword">def </span>single_target_design_model(target):</div>
<div class="line">    n, bps = len(target), rna.parse(target)</div>
<div class="line">    model = ir.Model(n, 4)</div>
<div class="line">    model.add_constraints(rna.BPComp(i, j) <span class="keywordflow">for</span> (i, j) <span class="keywordflow">in</span> bps)</div>
<div class="line">    model.add_functions([rna.GCCont(i) <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(n)], <span class="stringliteral">&#39;gc&#39;</span>)</div>
<div class="line">    model.add_functions([rna.BPEnergy(i, j, (i-1, j+1) <span class="keywordflow">not</span> <span class="keywordflow">in</span> bps)</div>
<div class="line">        <span class="keywordflow">for</span> (i, j) <span class="keywordflow">in</span> bps], <span class="stringliteral">&#39;energy&#39;</span>)</div>
<div class="line">    model.set_feature_weight(-1.5, <span class="stringliteral">&#39;energy&#39;</span>)</div>
<div class="line">    <span class="keywordflow">return</span> model</div>
</div><!-- fragment --><p>solve by direct sampling</p>
<div class="fragment"><div class="line">sampler = ir.Sampler(single_target_design_model(target))</div>
<div class="line">sampler.set_target(0.7 * n, 0.1 * n, <span class="stringliteral">&#39;gc&#39;</span>)</div>
<div class="line"><span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(50):</div>
<div class="line">    seq = rna.ass_to_seq(sampler.targeted_sample())</div>
<div class="line">    <span class="keywordflow">if</span> is_mfe_design(seq, target):</div>
<div class="line">        print(f<span class="stringliteral">&quot;{i} {seq}&quot;</span>)</div>
</div><!-- fragment --> <pre class="fragment">2 CUGAGGCGCCUAUGGCGGGGGCCGACCCCCCUCAG
3 GGUCGGAGGGGCCCCCUGAGCUACCGCUCCCGACC
6 GGGCGGAGGCAGGGCCUUCCCUAUCGGGGCCGCCU
7 GGGGGCGGGCUUAGCCCUCGUUAAAGCGAGCCCCC
13 CGCGGCCCGAUGUUCGGGAGCCGCUGCUCGCCGCG
17 CACCGGCCCCAAGGGGGGACGGACCCGUCCCGGUG
18 CCCUGGCCGCUAUGCGGGCGGAAUUCUGCCCAGGG
26 GGGUGGGUCCAAGGGACGCGGCAAACCGCCCACCC
28 GCGGCUAGAGUUACUCUCCGGCAUUCCGGGGCCGC
37 GGCCCUGCGGUUGCCGCCCCCCAAAGGGGAGGGCC
38 UCCUGCGCGCCGUGCGUCGAUGCCCAUCGGCGGGA
40 CGAACCCCCCUACGGGGGCGCCAGUGCGCGGUUCG
42 GCGGGGUCCGGGACGGAUGGGAGCACUCACCCCGC
46 CCCCGCGGUGUAACGCCGCCUACGCAGGUGCGGGG
</pre><div class="fragment"><div class="line"><span class="keyword">def </span>target_frequency(sequence, target):</div>
<div class="line">    fc = RNA.fold_compound(sequence)</div>
<div class="line">    fc.pf()</div>
<div class="line">    <span class="keywordflow">return</span> fc.pr_structure(target)</div>
</div><!-- fragment --><div class="fragment"><div class="line">sampler = ir.Sampler(single_target_design_model(target))</div>
<div class="line">sampler.set_target(0.7 * n, 0.1 * n, <span class="stringliteral">&#39;gc&#39;</span>)</div>
<div class="line">best = 0</div>
<div class="line"><span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(100):</div>
<div class="line">    seq = rna.ass_to_seq(sampler.targeted_sample())</div>
<div class="line">    freq = target_frequency(seq, target)</div>
<div class="line">    <span class="keywordflow">if</span> freq &gt; best:</div>
<div class="line">        best = freq</div>
<div class="line">        print(f<span class="stringliteral">&quot;{i} {seq} {freq:.6f}&quot;</span>)</div>
</div><!-- fragment --> <pre class="fragment">0 CGUGCGCCCCACAGGGGGGGGAUUACCCCCGUGCG 0.114687
5 GCCGUACGCCAUUGGCGGGGAAGUUUCUCUGCGGC 0.568546
8 GCACCCGGCCGUUGGCCGGUCGAUAGACCGGGUGC 0.929765
</pre><h2><a class="anchor" id="autotoc_md74"></a>
3.8 Larger single-target designs by constraint generation</h2>
<p>RNAPOND-like negative design (generating constraints for disruptive base pairs).</p>
<div class="fragment"><div class="line"><span class="comment">#[3.8]</span></div>
<div class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</div>
<div class="line"> </div>
<div class="line"><span class="comment"># A hard instance, eterna37</span></div>
<div class="line"><span class="comment"># target = &quot;(((((.((((((.((((((.((((((.((((((.((((((....((((((......)))))).)))))).(((((...(((((((...)))))))))))).)))))).((((((((((((...)))))))...))))).))))))....))))))....))))))....)))))&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment"># a slightly harder instance</span></div>
<div class="line">target = <span class="stringliteral">&quot;..(((..((((.....)))).((...(((.....)))...))...)))..&quot;</span></div>
<div class="line"> </div>
<div class="line">n = len(target)</div>
<div class="line">bps = rna.parse(target)</div>
</div><!-- fragment --><div class="fragment"><div class="line"><span class="keyword">def </span>cg_design_iteration():</div>
<div class="line">    model = single_target_design_model(target)</div>
<div class="line">    model.add_constraints(rna.NotBPComp(i, j) <span class="keywordflow">for</span> (i, j) <span class="keywordflow">in</span> dbps)</div>
<div class="line">    sampler = ir.Sampler(model, lazy=<span class="keyword">True</span>)</div>
<div class="line">    <span class="keywordflow">if</span> sampler.treewidth() &gt; 10 <span class="keywordflow">or</span> <span class="keywordflow">not</span> sampler.is_consistent():</div>
<div class="line">        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Not found&quot;</span></div>
<div class="line">    ctr = Counter()</div>
<div class="line">    found, sol = <span class="keyword">False</span>, <span class="keywordtype">None</span></div>
<div class="line">    <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(100):</div>
<div class="line">        seq = rna.ass_to_seq(sampler.targeted_sample())</div>
<div class="line">        fc = RNA.fold_compound(seq)</div>
<div class="line">        mfe, mfe_e = fc.mfe()</div>
<div class="line">        <span class="keywordflow">if</span> fc.eval_structure(target) == mfe_e:</div>
<div class="line">            sol = seq</div>
<div class="line">        ctr.update(rna.parse(mfe))</div>
<div class="line">    ndbps = [x[0] <span class="keywordflow">for</span> x <span class="keywordflow">in</span> ctr.most_common() <span class="keywordflow">if</span> x[0] <span class="keywordflow">not</span> <span class="keywordflow">in</span> bps]</div>
<div class="line">    dbps.extend(ndbps[:2])</div>
<div class="line">    <span class="keywordflow">return</span> sol</div>
<div class="line">dbps, seq = [], <span class="keywordtype">None</span></div>
<div class="line"><span class="keywordflow">while</span> seq <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line">    seq = cg_design_iteration()</div>
<div class="line">print(seq)</div>
</div><!-- fragment --> <pre class="fragment">UACCACCGGGGCAAAUCCCCAUCGUAGGCAACAAGCUAUAGACCAUGGAG
</pre><h2><a class="anchor" id="autotoc_md75"></a>
3.9 Negative design by stochastic optimization with partial resampling</h2>
<p>Define multi-target design model for resampling of subsets</p>
<div class="fragment"><div class="line"><span class="comment">#[3.9]</span></div>
<div class="line"><span class="keyword">import</span> RNA</div>
<div class="line">targets = [<span class="stringliteral">&quot;((((((((((...))))((((....))))))))))&quot;</span>,</div>
<div class="line">           <span class="stringliteral">&quot;((((((.((((((((....))))..))))))))))&quot;</span>,</div>
<div class="line">           <span class="stringliteral">&quot;.((((((...)))))).(((((((....)))))))&quot;</span>]</div>
</div><!-- fragment --><div class="fragment"><div class="line"><span class="comment">#[multi-defect]</span></div>
<div class="line"><span class="keyword">def </span>multi_defect(sequence, targets, xi=1):</div>
<div class="line">    k = len(targets)</div>
<div class="line">    fc = RNA.fold_compound(sequence)</div>
<div class="line">    ee = fc.pf()[1]</div>
<div class="line">    eos = [fc.eval_structure(target) <span class="keywordflow">for</span> target <span class="keywordflow">in</span> targets]</div>
<div class="line">    diff_ee = sum(1/k * (eos[i] - ee) <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(k))</div>
<div class="line">    diff_targets = sum(2/(k*(k-1)) * abs(eos[i]-eos[j])</div>
<div class="line">        <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(k) <span class="keywordflow">for</span> j <span class="keywordflow">in</span> range(k) <span class="keywordflow">if</span> i&lt;j)</div>
<div class="line">    <span class="keywordflow">return</span> diff_ee + xi * diff_targets</div>
</div><!-- fragment --><div class="fragment"><div class="line"><span class="keyword">import</span> random</div>
<div class="line"><span class="keyword">import</span> math</div>
</div><!-- fragment --><p>Optimize an ojective function by a Monte-Carlo optimization strategy with model resampling</p>
<div class="fragment"><div class="line"><span class="comment">#[mc-optimize]</span></div>
<div class="line"><span class="keyword">def </span>mc_optimize(model, objective, steps, temp, start=None):</div>
<div class="line">    sampler = ir.Sampler(model)</div>
<div class="line">    cur = sampler.sample() <span class="keywordflow">if</span> start <span class="keywordflow">is</span> <span class="keywordtype">None</span> <span class="keywordflow">else</span> start</div>
<div class="line">    curval = objective(cur)</div>
<div class="line">    best, bestval = cur, curval</div>
<div class="line">    </div>
<div class="line">    ccs = model.connected_components()</div>
<div class="line">    weights = [1/len(cc) <span class="keywordflow">for</span> cc <span class="keywordflow">in</span> ccs]</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(steps):</div>
<div class="line">        cc = random.choices(ccs,weights)[0]</div>
<div class="line">        new = sampler.resample(cc, cur)</div>
<div class="line">        newval = objective(new)</div>
<div class="line">        <span class="keywordflow">if</span> (newval &gt;= curval</div>
<div class="line">            <span class="keywordflow">or</span> random.random() &lt;= math.exp((newval-curval)/temp)):</div>
<div class="line">            cur, curval = new, newval</div>
<div class="line">            <span class="keywordflow">if</span> curval &gt; bestval:</div>
<div class="line">                best, bestval = cur, curval</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> (best, bestval)</div>
</div><!-- fragment --><div class="fragment"><div class="line"><span class="comment">#[mc-multi-design-model]</span></div>
<div class="line">n = len(targets[0])</div>
<div class="line">model = ir.Model(n, 4)</div>
<div class="line">model.add_functions([rna.GCCont(i) <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(n)], <span class="stringliteral">&#39;gc&#39;</span>)</div>
<div class="line"><span class="keywordflow">for</span> target <span class="keywordflow">in</span> targets:</div>
<div class="line">    ss = rna.parse(target)</div>
<div class="line">    model.add_constraints(rna.BPComp(i, j) <span class="keywordflow">for</span> (i, j) <span class="keywordflow">in</span> ss)</div>
<div class="line">    model.add_functions([rna.BPEnergy(i, j, (i-1, j+1) <span class="keywordflow">not</span> <span class="keywordflow">in</span> ss)</div>
<div class="line">        <span class="keywordflow">for</span> (i, j) <span class="keywordflow">in</span> ss], <span class="stringliteral">&#39;energy&#39;</span>)</div>
<div class="line">model.set_feature_weight(-0.8, <span class="stringliteral">&#39;energy&#39;</span>)</div>
<div class="line">model.set_feature_weight(-0.3, <span class="stringliteral">&#39;gc&#39;</span>)</div>
</div><!-- fragment --><div class="fragment"><div class="line">best, best_val = mc_optimize(model,</div>
<div class="line">    <span class="keyword">lambda</span> x: - multi_defect(rna.ass_to_seq(x),targets,1),</div>
<div class="line">    1000, 0.01)</div>
<div class="line"> </div>
<div class="line">print(rna.ass_to_seq(best), - best_val)</div>
</div><!-- fragment --> <pre class="fragment">GGGGUGCGGGGUACCCGGGGGUAGUCCCCUACCCC 2.445469538370768
</pre><h2><a class="anchor" id="autotoc_md76"></a>
3.10 A real world example: design of a Tandem-Riboswitch</h2>
<div class="fragment"><div class="line"><span class="comment">#[3.10]</span></div>
<div class="line">seqTheo0 = <span class="stringliteral">&quot;AAGUGAUACCAGCAUCGUCUUGAUGCCCUUGGCAGCACUUCAGAAAUCUC&quot;</span>\</div>
<div class="line">           <span class="stringliteral">&quot;UGAAGUGCUGUUUUUUUU&quot;</span></div>
<div class="line">seqTet0  = <span class="stringliteral">&quot;GGCCUAAAACAUACCAGAGAAAUCUGGAGAGGUGAAGAAUACGACCACCU&quot;</span>\</div>
<div class="line">           <span class="stringliteral">&quot;AGGCCGACAGUGGCCUAGGUGGUCGUUUUUUUUU&quot;</span></div>
</div><!-- fragment --><div class="fragment"><div class="line">seqTheo  = <span class="stringliteral">&quot;NNNNGAUACCAGCAUCGUCUUGAUGCCCUUGGCAGCNNNNNNNNNNNNNN&quot;</span>\</div>
<div class="line">           <span class="stringliteral">&quot;NNNNNNNNNNUUUUUUUU&quot;</span></div>
<div class="line">aptTheo  = <span class="stringliteral">&quot;(((((...((((((((.....)))))...)))...)))))..........&quot;</span>\</div>
<div class="line">           <span class="stringliteral">&quot;..................&quot;</span></div>
<div class="line">termTheo = <span class="stringliteral">&quot;...............................(((((((((((((....))&quot;</span>\</div>
<div class="line">           <span class="stringliteral">&quot;))))))))))).......&quot;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">seqTet   = <span class="stringliteral">&quot;NNNNNAAAACAUACCAGAGAAAUCUGGAGAGGUGAAGAAUACGACCACCU&quot;</span>\</div>
<div class="line">           <span class="stringliteral">&quot;ANNNNNNNNNNNNNNNNNNNNNNNNUUUUUUUUU&quot;</span></div>
<div class="line">termTet  = <span class="stringliteral">&quot;........................................((((((((((&quot;</span>\</div>
<div class="line">           <span class="stringliteral">&quot;(((((......)))))))))))))))........&quot;</span></div>
<div class="line">aptTet   = <span class="stringliteral">&quot;((((((.......(((((....)))))...((((...........)))))&quot;</span>\</div>
<div class="line">           <span class="stringliteral">&quot;))))).............................&quot;</span></div>
</div><!-- fragment --><div class="fragment"><div class="line">spacerLen = 30</div>
<div class="line">aptamers    = aptTheo  + <span class="stringliteral">&quot;.&quot;</span>*spacerLen + aptTet</div>
<div class="line">terminators = termTheo + <span class="stringliteral">&quot;.&quot;</span>*spacerLen + termTet</div>
<div class="line">sequence    = seqTheo  + <span class="stringliteral">&quot;N&quot;</span>*spacerLen + seqTet</div>
</div><!-- fragment --><div class="fragment"><div class="line">n = len(aptTheo) + spacerLen + len(aptTet)</div>
<div class="line">variants = dict(</div>
<div class="line">    empty = <span class="stringliteral">&#39;.&#39;</span>*n,</div>
<div class="line">    aptTheo = aptTheo + <span class="stringliteral">&#39;.&#39;</span>*(n-len(aptTheo)),</div>
<div class="line">    aptTet = <span class="stringliteral">&#39;.&#39;</span>*(n-len(aptTet)) + aptTet,</div>
<div class="line">    termTheo = termTheo + <span class="stringliteral">&#39;.&#39;</span>*(n-len(aptTheo)),</div>
<div class="line">    termTet = <span class="stringliteral">&#39;.&#39;</span>*(n-len(aptTet)) + termTet,</div>
<div class="line">    spacer = <span class="stringliteral">&#39;.&#39;</span>*len(aptTheo) + <span class="stringliteral">&#39;x&#39;</span>*spacerLen + <span class="stringliteral">&#39;.&#39;</span>*len(aptTet)</div>
<div class="line">)</div>
</div><!-- fragment --><div class="fragment"><div class="line"><span class="keyword">def </span>constrained_efe(sequence,c):</div>
<div class="line">    fc = RNA.fold_compound(sequence)</div>
<div class="line">    fc.hc_add_from_db(c)</div>
<div class="line">    <span class="keywordflow">return</span> fc.pf()[1]</div>
<div class="line"> </div>
<div class="line"><span class="keyword">def </span>rstd_objective(sequence):</div>
<div class="line">    efe = {k:constrained_efe(sequence,variants[k]) </div>
<div class="line">           <span class="keywordflow">for</span> k <span class="keywordflow">in</span> variants}</div>
<div class="line">        </div>
<div class="line">    term_stability = efe[<span class="stringliteral">&#39;termTheo&#39;</span>] + efe[<span class="stringliteral">&#39;termTet&#39;</span>] \</div>
<div class="line">        - 2*efe[<span class="stringliteral">&#39;empty&#39;</span>]</div>
<div class="line">    apt_target = abs(efe[<span class="stringliteral">&#39;aptTheo&#39;</span>]-efe[<span class="stringliteral">&#39;empty&#39;</span>]-7) \</div>
<div class="line">        + abs(efe[<span class="stringliteral">&#39;aptTet&#39;</span>]-efe[<span class="stringliteral">&#39;empty&#39;</span>]-10)</div>
<div class="line">    spacer_unfolding = efe[<span class="stringliteral">&#39;spacer&#39;</span>]-efe[<span class="stringliteral">&#39;empty&#39;</span>]</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> term_stability + apt_target + spacer_unfolding</div>
</div><!-- fragment --><div class="fragment"><div class="line">rstd_targets = [aptamers, terminators]</div>
<div class="line">n = len(rstd_targets[0])</div>
<div class="line">model = ir.Model(n, 4)</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">for</span> i, x <span class="keywordflow">in</span> enumerate(sequence):</div>
<div class="line">    model.add_constraints(ir.ValueIn(i, rna.iupacvalues(x)))</div>
<div class="line"> </div>
<div class="line">model.add_functions([rna.GCCont(i) <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(n)], <span class="stringliteral">&#39;gc&#39;</span>)</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">for</span> k,target <span class="keywordflow">in</span> enumerate(rstd_targets):</div>
<div class="line">    ss = rna.parse(target)</div>
<div class="line">    model.add_constraints(rna.BPComp(i, j) <span class="keywordflow">for</span> (i, j) <span class="keywordflow">in</span> ss)</div>
<div class="line">    model.add_functions([rna.BPEnergy(i, j, (i-1, j+1) <span class="keywordflow">not</span> <span class="keywordflow">in</span> ss)</div>
<div class="line">        <span class="keywordflow">for</span> (i, j) <span class="keywordflow">in</span> ss], f<span class="stringliteral">&#39;energy{k}&#39;</span>)</div>
<div class="line">model.set_feature_weight(-0.6, <span class="stringliteral">&#39;energy0&#39;</span>)</div>
<div class="line">model.set_feature_weight(-1, <span class="stringliteral">&#39;energy1&#39;</span>)</div>
<div class="line">model.set_feature_weight(-0.3, <span class="stringliteral">&#39;gc&#39;</span>)</div>
</div><!-- fragment --><div class="fragment"><div class="line"><span class="comment">#[rstd-optimize-call]</span></div>
<div class="line">objective = <span class="keyword">lambda</span> x: -rstd_objective(rna.ass_to_seq(x))</div>
<div class="line">best, best_val = ir.mc_optimize(model, objective,</div>
<div class="line">                                steps = 500, temp = 0.03)</div>
<div class="line">print(rna.ass_to_seq(best), -best_val)</div>
</div><!-- fragment --> <pre class="fragment">CGAGGAUACCAGCAUCGUCUUGAUGCCCUUGGCAGCCUUGCCACUUAUGUGGCGAGGUUGUUUUUUUUAAUAUAUCAGAGCUUUUUUUUAAUAAUCGCAGCCUAAAACAUACCAGAGAAAUCUGGAGAGGUGAAGAAUACGACCACCUAGGUUGGAAAGGGCCUGGGUGGUUGUUUUUUUUU 1.2818794250488281
</pre><h3><a class="anchor" id="autotoc_md77"></a>
Run optimzation in parallel</h3>
<div class="fragment"><div class="line"><span class="keyword">import</span> concurrent.futures</div>
<div class="line"> </div>
<div class="line">steps = 500</div>
<div class="line">jobs = 12</div>
<div class="line"> </div>
<div class="line"><span class="keyword">def </span>my_rstd_optimize(i):</div>
<div class="line">    random.seed(<span class="keywordtype">None</span>)</div>
<div class="line">    objective = <span class="keyword">lambda</span> x: -rstd_objective(rna.ass_to_seq(x))</div>
<div class="line">    best,best_val = mc_optimize(model, objective, steps = steps, temp = 0.03)</div>
<div class="line">    <span class="keywordflow">return</span> rna.ass_to_seq(best), -best_val</div>
<div class="line"> </div>
<div class="line"><span class="keyword">with</span> concurrent.futures.ProcessPoolExecutor() <span class="keyword">as</span> executor:</div>
<div class="line">    res = executor.map(my_rstd_optimize, range(jobs))</div>
<div class="line">res = list(res)</div>
</div><!-- fragment --><div class="fragment"><div class="line"><span class="keywordflow">for</span> seq, val <span class="keywordflow">in</span> res:</div>
<div class="line">    print(f<span class="stringliteral">&quot;{seq} {val:.2f}&quot;</span>)</div>
<div class="line">    fc = RNA.fold_compound(seq)</div>
<div class="line">    <span class="keywordflow">for</span> k,c <span class="keywordflow">in</span> variants.items():</div>
<div class="line">        print(f<span class="stringliteral">&quot;{k:20} {fc.eval_structure(c):8.2f} {constrained_efe(seq,c):8.2f} {constrained_efe(seq,c)-constrained_efe(seq,variants[&#39;empty&#39;]):8.2f}&quot;</span>)</div>
</div><!-- fragment --> <pre class="fragment">GUUUGAUACCAGCAUCGUCUUGAUGCCCUUGGCAGCGGGCGUGGAACUCCGCGUCCGUUGUUUUUUUUGAUGACCGCAAUAAUCCUCAUACGUAGCAACGGGUAAAACAUACCAGAGAAAUCUGGAGAGGUGAAGAAUACGACCACCUACCUGCUGGUACGGGUAGGUGGUCGUUUUUUUUU 3.91
empty                    0.00   -76.32     0.00
aptTheo                -11.90   -69.34     6.98
aptTet                 -15.40   -66.46     9.87
termTheo               -23.10   -76.31     0.01
termTet                -28.20   -76.32     0.00
spacer                   0.00   -72.58     3.74
GUUUGAUACCAGCAUCGUCUUGAUGCCCUUGGCAGCGGGCGCAGUCCCCUGCGUCCGUUGUUUUUUUUGUCAGCAUAGUAAGUAAAAUAAUGUAAUCGCGGGUAAAACAUACCAGAGAAAUCUGGAGAGGUGAAGAAUACGACCACCUACCCGCGUUUACGGGUGGGUGGUUGUUUUUUUUU 4.30
empty                    0.00   -74.90     0.00
aptTheo                -11.90   -67.57     7.33
aptTet                 -17.60   -63.58    11.32
termTheo               -23.00   -74.87     0.03
termTet                -28.00   -74.90     0.00
spacer                   0.00   -72.29     2.61
GUUCGAUACCAGCAUCGUCUUGAUGCCCUUGGCAGCGGGCGUCGGCAACGACGUCCGUUGUUUUUUUUUUGGACAACGAUACUUAAAUACGGAAAUGGCGGGUAAAACAUACCAGAGAAAUCUGGAGAGGUGAAGAAUACGACCACCUACCUGCGAGUACGGGUAGGUGGUCGUUUUUUUUU 3.97
empty                    0.00   -76.22     0.00
aptTheo                -13.90   -69.66     6.57
aptTet                 -15.40   -66.17    10.06
termTheo               -23.90   -76.16     0.07
termTet                -28.20   -76.22     0.00
spacer                   0.00   -72.81     3.41
GUUCGAUACCAGCAUCGUCUUGAUGCCCUUGGCAGCGGGCGCACAACCGUGCGUCCGUUGUUUUUUUUCUUGACAGCGCGCUUGAAAUACGGUAAUUACUGGUAAAACAUACCAGAGAAAUCUGGAGAGGUGAAGAAUACGACCACCUACCGGCAAUUACUGGUAGGUGGUUGUUUUUUUUU 3.90
empty                    0.00   -75.42     0.00
aptTheo                -13.90   -68.35     7.06
aptTet                 -15.40   -65.48     9.94
termTheo               -23.60   -75.40     0.02
termTet                -26.10   -75.42     0.00
spacer                   0.00   -71.67     3.75
GUUUGAUACCAGCAUCGUCUUGAUGCCCUUGGCAGCGGACCGUUUGCAAACGGUCCGCUGUUUUUUUUAUAUAAUUUAAAUAACCGCGGAAAGUCUCAUUUGUAAAACAUACCAGAGAAAUCUGGAGAGGUGAAGAAUACGACCACCUACGGGUGCUAUUCUGUGGGUGGUUGUUUUUUUUU 3.21
empty                    0.00   -70.64     0.00
aptTheo                -11.50   -63.07     7.57
aptTet                 -10.00   -60.69     9.95
termTheo               -24.00   -70.59     0.05
termTet                -23.90   -70.63     0.00
spacer                   0.00   -68.10     2.54
GGUUGAUACCAGCAUCGUCUUGAUGCCCUUGGCAGCGGCCCGCCCUUAGGCGGGCUGCUGUUUUUUUUAAUAUAUUCAUACUAAACGCAACUAGCACUCGCUUAAAACAUACCAGAGAAAUCUGGAGAGGUGAAGAAUACGACCACCUAAGCGAGAGGGCGCUUAGGUGGUUGUUUUUUUUU 3.35
empty                    0.00   -78.81     0.00
aptTheo                -13.80   -71.58     7.23
aptTet                 -15.60   -68.97     9.84
termTheo               -28.30   -78.79     0.02
termTet                -26.10   -78.80     0.00
spacer                   0.00   -75.86     2.94
GGAAGAUACCAGCAUCGUCUUGAUGCCCUUGGCAGCUUCCGUAGAAAGCUGCGGAGGCUGUUUUUUUUACACGAAUACAUGACUUUUAUUGACCUAACGCGCUAAAACAUACCAGAGAAAUCUGGAGAGGUGAAGAAUACGACCACCUAGUGCGGCUAGGUACUAGGUGGUCGUUUUUUUUU 2.11
empty                    0.00   -72.60     0.00
aptTheo                -15.70   -65.60     7.00
aptTet                 -16.20   -62.70     9.90
termTheo               -22.40   -72.56     0.04
termTet                -28.30   -72.60     0.00
spacer                   0.00   -70.63     1.97
CCGUGAUACCAGCAUCGUCUUGAUGCCCUUGGCAGCGCGGGUGCGAUGGCAUUCGCGCUGUUUUUUUUCACAAACAAUUAUUGCUAAUCUGGAUACAAGGCGUAAAACAUACCAGAGAAAUCUGGAGAGGUGAAGAAUACGACCACCUACGCCCAGAAUGGCGUAGGUGGUUGUUUUUUUUU 5.06
empty                    0.00   -76.41     0.00
aptTheo                -16.20   -69.48     6.93
aptTet                 -17.60   -65.93    10.48
termTheo               -24.20   -76.21     0.20
termTet                -28.10   -76.39     0.02
spacer                   0.00   -72.12     4.29
UUCGGAUACCAGCAUCGUCUUGAUGCCCUUGGCAGCUGGAACGUAUGAACGUUCCAGUUGUUUUUUUUUUACUACAUACCCACGCGGUUCUCAAAAAACGACUAAAACAUACCAGAGAAAUCUGGAGAGGUGAAGAAUACGACCACCUAGUCGUUAUGCCGACUGGGUGGUCGUUUUUUUUU 3.29
empty                    0.00   -71.18     0.00
aptTheo                -11.90   -64.15     7.02
aptTet                 -15.50   -61.15    10.03
termTheo               -20.40   -71.08     0.09
termTet                -27.90   -71.17     0.01
spacer                   0.00   -68.04     3.13
CGCCGAUACCAGCAUCGUCUUGAUGCCCUUGGCAGCGGCGGUCGACGGCGGCCGCCGCUGUUUUUUUUCUAUCUUCAAACACAAUACCCAGCGCAUCCCGUAUAAAACAUACCAGAGAAAUCUGGAGAGGUGAAGAAUACGACCACCUAUGCGGUGCAAUGCAUGGGUGGUCGUUUUUUUUU 2.03
empty                    0.00   -77.03     0.00
aptTheo                -18.10   -69.93     7.10
aptTet                 -13.80   -67.04     9.99
termTheo               -27.20   -76.77     0.26
termTet                -26.80   -77.02     0.00
spacer                   0.00   -75.38     1.65
CCCUGAUACCAGCAUCGUCUUGAUGCCCUUGGCAGCGGGGGCGGUGACCCGCCUCCGCUGUUUUUUUUUAACAUGAUUCAAACAGAUGGACCGCGAACCCAGUAAAACAUACCAGAGAAAUCUGGAGAGGUGAAGAAUACGACCACCUAUUGGGCAGGUCCAGUAGGUGGUUGUUUUUUUUU 3.60
empty                    0.00   -75.76     0.00
aptTheo                -16.70   -68.81     6.95
aptTet                 -14.20   -66.07     9.69
termTheo               -27.40   -75.65     0.12
termTet                -24.90   -75.76     0.00
spacer                   0.00   -72.64     3.13
GCCCGAUACCAGCAUCGUCUUGAUGCCCUUGGCAGCGGGCCGCCGAGAGGCGGUCCGUUGUUUUUUUUCCAGCAUAAAACGUAGCCAUCUUCAGCCAGGUCAUAAAACAUACCAGAGAAAUCUGGAGAGGUGAAGAAUACGACCACCUAUGGCUCACUGGCCAUAGGUGGUCGUUUUUUUUU 5.19
empty                    0.00   -80.78     0.00
aptTheo                -18.50   -73.78     6.99
aptTet                 -13.50   -70.20    10.58
termTheo               -26.70   -80.15     0.63
termTet                -29.00   -80.77     0.00
spacer                   0.00   -76.81     3.97
</pre><h1><a class="anchor" id="autotoc_md78"></a>
APPENDIX</h1>
<h2><a class="anchor" id="autotoc_md79"></a>
Generate RNAPOND figures</h2>
<div class="fragment"><div class="line"><span class="comment">#[APPENDIX]</span></div>
<div class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</div>
<div class="line"> </div>
<div class="line"><span class="comment"># a slightly harder instance</span></div>
<div class="line">target = <span class="stringliteral">&quot;..(((..((((.....)))).((...(((.....)))...))...)))..&quot;</span></div>
<div class="line"> </div>
<div class="line">n = len(target)</div>
<div class="line">bps = rna.parse(target)</div>
<div class="line">steps = 100</div>
</div><!-- fragment --><div class="fragment"><div class="line"><span class="keyword">import</span> matplotlib.patches <span class="keyword">as</span> patches</div>
<div class="line"><span class="keyword">import</span> matplotlib.cm <span class="keyword">as</span> cm</div>
<div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div>
<div class="line"><span class="keyword">import</span> seaborn <span class="keyword">as</span> sns</div>
<div class="line"> </div>
<div class="line">tick = list(range(0,n,5))</div>
<div class="line">cmap = sns.light_palette((260, 75, 60), input=<span class="stringliteral">&quot;husl&quot;</span>, as_cmap=<span class="keyword">True</span>)</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Function to draw base pair counts for each sampling</span></div>
<div class="line"><span class="keyword">def </span>draw_heatmap(ax, counter, bps, dbps, new_dbps, vmax, steps=steps, cbar=True):</div>
<div class="line">    <span class="comment"># Initial count matrix</span></div>
<div class="line">    counts = np.zeros((n,n))</div>
<div class="line">    mask = np.tri(counts.shape[0], k=-1)</div>
<div class="line">    <span class="keywordflow">for</span> bp, count <span class="keywordflow">in</span> counter.items():</div>
<div class="line">        counts[bp[0]][bp[1]] = count</div>
<div class="line">    <span class="comment"># Normalization</span></div>
<div class="line">    counts = counts/steps</div>
<div class="line"> </div>
<div class="line">    sns.heatmap(counts, vmax=vmax/steps, mask=mask, square=<span class="keyword">True</span>, cmap=cmap, ax=ax, cbar=cbar)</div>
<div class="line">    <span class="keywordflow">for</span> i, j <span class="keywordflow">in</span> bps:</div>
<div class="line">        ax.add_patch(patches.Rectangle((j,i), 1, 1, fc=<span class="stringliteral">&quot;none&quot;</span>, ec=<span class="stringliteral">&quot;blue&quot;</span>, lw=1))</div>
<div class="line">    <span class="keywordflow">for</span> i, j <span class="keywordflow">in</span> dbps:</div>
<div class="line">        ax.add_patch(patches.Rectangle((j,i), 1, 1, fc=<span class="stringliteral">&quot;none&quot;</span>, ec=<span class="stringliteral">&quot;red&quot;</span>, lw=1))</div>
<div class="line">    <span class="keywordflow">for</span> i, j <span class="keywordflow">in</span> new_dbps:</div>
<div class="line">        ax.add_patch(patches.Rectangle((j,i), 1, 1, fc=<span class="stringliteral">&quot;none&quot;</span>, ec=<span class="stringliteral">&quot;green&quot;</span>, lw=1))</div>
<div class="line"> </div>
<div class="line">    ax.xaxis.tick_top()</div>
<div class="line">    ax.yaxis.tick_right()</div>
<div class="line">    ax.set_xticks(tick)</div>
<div class="line">    ax.set_xticklabels(tick)</div>
<div class="line">    ax.set_yticks(tick)</div>
<div class="line">    ax.set_yticklabels(tick)</div>
</div><!-- fragment --><div class="fragment"><div class="line"><span class="keyword">def </span>cg_design_iteration():</div>
<div class="line">    model = single_target_design_model(target)</div>
<div class="line">    model.add_constraints(rna.NotBPComp(i, j) <span class="keywordflow">for</span> (i, j) <span class="keywordflow">in</span> dbps)</div>
<div class="line">    sampler = ir.Sampler(model, lazy=<span class="keyword">True</span>)</div>
<div class="line">    <span class="keywordflow">if</span> sampler.treewidth() &gt; 10 <span class="keywordflow">or</span> <span class="keywordflow">not</span> sampler.is_consistent():</div>
<div class="line">        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Not found&quot;</span></div>
<div class="line">    ctr = Counter()</div>
<div class="line">    found, sol = <span class="keyword">False</span>, <span class="keywordtype">None</span></div>
<div class="line">    <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(steps):</div>
<div class="line">        seq = rna.ass_to_seq(sampler.targeted_sample())</div>
<div class="line">        fc = RNA.fold_compound(seq)</div>
<div class="line">        mfe, mfe_e = fc.mfe()</div>
<div class="line">        <span class="keywordflow">if</span> fc.eval_structure(target) == mfe_e:</div>
<div class="line">            found, sol = <span class="keyword">True</span>, seq</div>
<div class="line">        ctr.update(rna.parse(mfe))</div>
<div class="line">    ndbps = [x[0] <span class="keywordflow">for</span> x <span class="keywordflow">in</span> ctr.most_common() <span class="keywordflow">if</span> x[0] <span class="keywordflow">not</span> <span class="keywordflow">in</span> bps]</div>
<div class="line">    dbps.extend(ndbps[:2])</div>
<div class="line">    <span class="keywordflow">if</span> found:</div>
<div class="line">        records.append((ctr, dbps[:], []))</div>
<div class="line">    <span class="keywordflow">else</span>:</div>
<div class="line">        records.append((ctr, dbps[:], ndbps[:2]))</div>
<div class="line">    <span class="keywordflow">return</span> found, sol</div>
<div class="line"> </div>
<div class="line"><span class="comment"># One can use seed() provided by infrared to reproduce the result</span></div>
<div class="line">random.seed(1000)</div>
<div class="line">found, records, dbps, seq = <span class="keyword">False</span>, [], [], <span class="keywordtype">None</span></div>
<div class="line"><span class="keywordflow">while</span> <span class="keywordflow">not</span> found: found, seq = cg_design_iteration()</div>
<div class="line">print(seq)</div>
</div><!-- fragment --> <pre class="fragment">UGCCGAGCCCGGAAAACGGGGAGAUUGCGCCAGUCGCUAGCUAUGCGGGA
</pre><div class="fragment"><div class="line">to_draw = [records[i] <span class="keywordflow">for</span> i <span class="keywordflow">in</span> [0, 1, -1]]</div>
<div class="line">vmax = max(map(<span class="keyword">lambda</span> t: max(t[0].values()), to_draw))</div>
</div><!-- fragment --><div class="fragment"><div class="line">fig, axs = plt.subplots(1,3, figsize=(27,7))</div>
<div class="line">fig.tight_layout()</div>
<div class="line"><span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(3):</div>
<div class="line">    ax = axs[i]</div>
<div class="line">    counter, disruptive, new_dbps = to_draw[i]</div>
<div class="line">    draw_heatmap(ax, counter, bps, disruptive, new_dbps, vmax, steps=100, cbar=i==2)</div>
<div class="line"> </div>
<div class="line">axs[0].set_title(<span class="stringliteral">&#39;First Round&#39;</span>, y=-0.01)</div>
<div class="line">axs[1].set_title(<span class="stringliteral">&#39;Second Round&#39;</span>, y=-0.01)</div>
<div class="line">axs[2].set_title(<span class="stringliteral">&#39;Final Round&#39;</span>, y=-0.01)</div>
<div class="line"> </div>
<div class="line">plt.savefig(<span class="stringliteral">&#39;count_matrix.pdf&#39;</span>, dpi=200, bbox_inches=<span class="stringliteral">&#39;tight&#39;</span>)</div>
<div class="line">plt.show()</div>
</div><!-- fragment --><p><img src="Bookchapter_files/Bookchapter_106_0.png" alt="png" class="inline"/></p>
<h2><a class="anchor" id="autotoc_md80"></a>
Generate stochastic optimization figure</h2>
<div class="fragment"><div class="line"><span class="keyword">import</span> concurrent.futures</div>
<div class="line"> </div>
<div class="line"><span class="keyword">def </span>mc_optimize_allsteps(model, objective, steps, temp, start=None):</div>
<div class="line">    res = list()</div>
<div class="line"> </div>
<div class="line">    sampler = ir.Sampler(model)</div>
<div class="line">    cur = sampler.sample() <span class="keywordflow">if</span> start <span class="keywordflow">is</span> <span class="keywordtype">None</span> <span class="keywordflow">else</span> start</div>
<div class="line">    curval = objective(cur)</div>
<div class="line">    best, bestval = cur, curval</div>
<div class="line">    res.append((rna.ass_to_seq(best),bestval))</div>
<div class="line">    </div>
<div class="line">    ccs = model.connected_components()</div>
<div class="line">    weights = [1/len(cc) <span class="keywordflow">for</span> cc <span class="keywordflow">in</span> ccs]</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(steps):</div>
<div class="line">        cc = random.choices(ccs,weights)[0]</div>
<div class="line">        new = sampler.resample(cc, cur)</div>
<div class="line">        newval = objective(new)</div>
<div class="line">        <span class="keywordflow">if</span> (newval &gt;= curval</div>
<div class="line">            <span class="keywordflow">or</span> random.random() &lt;= math.exp((newval-curval)/temp)):</div>
<div class="line">            cur, curval = new, newval</div>
<div class="line">            <span class="keywordflow">if</span> curval &gt; bestval:</div>
<div class="line">                best, bestval = cur, curval</div>
<div class="line">        res.append((rna.ass_to_seq(best),bestval))</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> res</div>
<div class="line"> </div>
<div class="line">n = len(targets[0])</div>
<div class="line">model = ir.Model(n, 4)</div>
<div class="line">model.add_functions([rna.GCCont(i) <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(n)], <span class="stringliteral">&#39;gc&#39;</span>)</div>
<div class="line"><span class="keywordflow">for</span> target <span class="keywordflow">in</span> targets:</div>
<div class="line">    ss = rna.parse(target)</div>
<div class="line">    model.add_constraints(rna.BPComp(i, j) <span class="keywordflow">for</span> (i, j) <span class="keywordflow">in</span> ss)</div>
<div class="line">    model.add_functions([rna.BPEnergy(i, j, (i-1, j+1) <span class="keywordflow">not</span> <span class="keywordflow">in</span> ss)</div>
<div class="line">        <span class="keywordflow">for</span> (i, j) <span class="keywordflow">in</span> ss], <span class="stringliteral">&#39;energy&#39;</span>)</div>
<div class="line">model.set_feature_weight(-0.8, <span class="stringliteral">&#39;energy&#39;</span>)</div>
<div class="line">model.set_feature_weight(-0.3, <span class="stringliteral">&#39;gc&#39;</span>)</div>
<div class="line"> </div>
<div class="line">objective = <span class="keyword">lambda</span> x: - multi_defect(rna.ass_to_seq(x),targets,1)</div>
<div class="line"> </div>
<div class="line"><span class="keyword">def </span>my_mc_optimize_allsteps(i):</div>
<div class="line">    random.seed(<span class="keywordtype">None</span>)</div>
<div class="line">    res = mc_optimize_allsteps(model,objective,6400,0.01)</div>
<div class="line">    <span class="keywordflow">return</span> [(b,-v) <span class="keywordflow">for</span> b,v <span class="keywordflow">in</span> res]</div>
<div class="line"> </div>
<div class="line"><span class="keyword">with</span> concurrent.futures.ProcessPoolExecutor() <span class="keyword">as</span> executor:</div>
<div class="line">    res = executor.map(my_mc_optimize_allsteps, range(48))</div>
<div class="line">res = list(res)</div>
</div><!-- fragment --><div class="fragment"><div class="line">the_steps = [0]+[25*(2**i) <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(8+1)]</div>
<div class="line">res2 = [[r[steps][1] <span class="keywordflow">for</span> r <span class="keywordflow">in</span> res] <span class="keywordflow">for</span> steps <span class="keywordflow">in</span> the_steps]</div>
<div class="line"><span class="comment">#print(res2)</span></div>
<div class="line">fig, ax = plt.subplots()</div>
<div class="line">box = ax.boxplot(res2,</div>
<div class="line">                 labels=the_steps,</div>
<div class="line">                 patch_artist=<span class="keyword">True</span>,</div>
<div class="line">                 boxprops=dict(facecolor=<span class="stringliteral">&#39;lightgrey&#39;</span>,linewidth=1.25),</div>
<div class="line">                 medianprops=dict(color=<span class="stringliteral">&#39;blue&#39;</span>, linewidth=1.25)</div>
<div class="line">                )</div>
<div class="line">ax.set_ylabel(<span class="stringliteral">&quot;Multi-defect&quot;</span>)</div>
<div class="line">ax.set_xlabel(<span class="stringliteral">&quot;Iterations&quot;</span>)</div>
<div class="line">ax.yaxis.grid(<span class="keyword">True</span>)</div>
<div class="line">plt.savefig(<span class="stringliteral">&quot;optimization.svg&quot;</span>)</div>
</div><!-- fragment --><p><img src="Bookchapter_files/Bookchapter_109_0.png" alt="png" class="inline"/> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.7 </li>
  </ul>
</div>
</body>
</html>
