<!-- HTML header for doxygen 1.9.7-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.7"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Infrared: Multi-dimensional Boltzmann sampling</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<!--  -->
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="style.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript">
  DoxygenAwesomeDarkModeToggle.init()
</script>
<script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript">
  DoxygenAwesomeInteractiveToc.init()
</script>
<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript">
  DoxygenAwesomeParagraphLink.init()
</script>
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript">
  DoxygenAwesomeFragmentCopyButton.init()
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Infrared
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.7 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_Doc_2Examples_2MultiDimensionalBoltzmannSampling.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Multi-dimensional Boltzmann sampling</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md141">Online resources and software environment</a></li>
<li class="level1"><a href="#autotoc_md143">Targeting dinucleotide frequencies by MDBS</a></li>
<li class="level1"><a href="#autotoc_md144">Import modules + define timing function</a></li>
<li class="level1"><a href="#autotoc_md145">Preliminaries</a></li>
<li class="level1"><a href="#autotoc_md146">Network function for dinucleotide counting</a></li>
<li class="level1"><a href="#autotoc_md147">Input instance(s)</a></li>
<li class="level1"><a href="#autotoc_md148">Feature network model for the design task</a></li>
<li class="level1"><a href="#autotoc_md149">Generate model</a></li>
<li class="level1"><a href="#autotoc_md150">Draw samples (without targeting)</a></li>
<li class="level1"><a href="#autotoc_md151">Draw targeted samples</a></li>
<li class="level1"><a href="#autotoc_md152">Plots sampling effectivity</a></li>
<li class="level1"><a href="#autotoc_md153">Distribution plots</a></li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="autotoc_md139"></a></p>
<hr  />
<h1><a class="anchor" id="autotoc_md141"></a>
Online resources and software environment</h1>
<p>​</p>
<p>This document is hosted online as <a href="https://www.lix.polytechnique.fr/~will/Software/Infrared/current/Doc/MultiDimensionalBoltzmannSampling.ipynb">Jupyter notebook</a> with precomputed results. Download this file to view, edit and run examples in Jupyter.</p>
<p>​</p>
<p>We recommend to install all required software using Mamba (or Conda) and PIP.</p>
<div class="fragment"><div class="line">mamba create -n infrared -c conda-forge infrared jupyter jupytext matplotlib seaborn graphviz</div>
<div class="line"> </div>
<div class="line">mamba activate infrared</div>
<div class="line"> </div>
<div class="line">pip install graphviz</div>
<div class="line"> </div>
<div class="line">mamba deactivate infrared</div>
</div><!-- fragment --><p>​</p>
<p>Start the Jupyter notebook server after activating the environment</p>
<div class="fragment"><div class="line">mamba activate infrared</div>
<div class="line"> </div>
<div class="line">jupyter notebook</div>
</div><!-- fragment --><p>The <a href="https://gitlab.inria.fr/amibio/Infrared/-/tree/master/Doc/Examples">original sources</a> are part of the Infrared distribution and hosted on Gitlab (in Jupytext light Script format).</p>
<p>​</p>
<hr  />
<h1><a class="anchor" id="autotoc_md143"></a>
Targeting dinucleotide frequencies by MDBS</h1>
<p>We demonstrate sampling of sequences targeting specific dinucleotide frequences and additional requirements; in this example, compatibility with an RNA target structure.</p>
<p>The targeting of dinucleotide frequencies is performed using the multi-dimensional Boltzmann sampling functionality of Infrared's Sampler (aka MultiDimensionalBoltzmannSampler) class.</p>
<h1><a class="anchor" id="autotoc_md144"></a>
Import modules + define timing function</h1>
<div class="fragment"><div class="line"><span class="keyword">import</span> infrared <span class="keyword">as</span> ir</div>
<div class="line"><span class="keyword">import</span> <a class="code hl_namespace" href="namespaceinfrared_1_1rna.html">infrared.rna</a> <span class="keyword">as</span> rna</div>
<div class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</div>
<div class="line"><span class="keyword">import</span> random</div>
<div class="line"> </div>
<div class="line"><span class="keyword">import</span> time</div>
<div class="line"><span class="keyword">def </span>report_time(f,desc=&quot;&quot;):</div>
<div class="line">    start=time.time()</div>
<div class="line">    res=f()</div>
<div class="line">    desc = <span class="stringliteral">&quot;&quot;</span> <span class="keywordflow">if</span> desc==<span class="stringliteral">&quot;&quot;</span> <span class="keywordflow">else</span> f<span class="stringliteral">&#39; ({desc})&#39;</span></div>
<div class="line">    print(f<span class="stringliteral">&#39;Time{desc}: {time.time()-start:0.2f}s&#39;</span>)</div>
<div class="line">    <span class="keywordflow">return</span> res</div>
<div class="ttc" id="anamespaceinfrared_1_1rna_html"><div class="ttname"><a href="namespaceinfrared_1_1rna.html">infrared.rna</a></div><div class="ttdef"><b>Definition</b> rna.py:1</div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md145"></a>
Preliminaries</h1>
<div class="fragment"><div class="line">alphabet = <span class="stringliteral">&quot;ACGU&quot;</span></div>
<div class="line">dimers = [ x+y <span class="keywordflow">for</span> x <span class="keywordflow">in</span> alphabet <span class="keywordflow">for</span> y <span class="keywordflow">in</span> alphabet ]</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md146"></a>
Network function for dinucleotide counting</h1>
<p>For use in the model, define counting of dinucleotide frequencies. The generated class will be constructed by the position \(i\) (to count the dimer at positions \(i\), \(i+1\)) and the respective dimer as string ("AA", "AC", ...).</p>
<p>Note how the dimer argument is passed from the first lambda function (&lsquo;init&rsquo;), which specified the construction and returns the dependency list [ \(i,i+1\)] , to the second one (&lsquo;value&rsquo;), which evaluates the function given the values of variables \(i\) and \(i+1\).</p>
<div class="fragment"><div class="line">ir.def_function_class(<span class="stringliteral">&#39;DinuclFreq&#39;</span>,</div>
<div class="line">    <span class="keyword">lambda</span> i,dimer: [i,i+1],</div>
<div class="line">    <span class="keyword">lambda</span> x,y,dimer: rna.values_to_seq([x,y])==dimer</div>
<div class="line">)</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md147"></a>
Input instance(s)</h1>
<div class="fragment"><div class="line"><span class="comment">#&gt;CP000576.1:c381532-381475 Prochlorococcus marinus str. MIT 9301, complete genome</span></div>
<div class="line"><span class="comment">#UUUCGUUCACCCUCAUUUGAGGGCGCAGUUCGAGUCAUACCAUGGAACGGGGGAUGGC</span></div>
<div class="line">seq0    = <span class="stringliteral">&quot;UUUCGUUCACCCUCAUUUGAGGGCGCAGUUCGAGUCAUACCAUGGAACGGGGGAUGGC&quot;</span></div>
<div class="line">struct0 = <span class="stringliteral">&quot;...[[[[[.(((((....)))))..........(((((.((...]]]]]))..)))))&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment"># Yann&#39;s example</span></div>
<div class="line">seq = <span class="stringliteral">&quot;CACUGUCGACUCAGUCAGUGAGUCGCGACUGACUGCAUCGCGACUACGUCAGUCGUACGAUCUAUUGUGCGAUAUCGCGCGAUAUAGCUAUGCG&quot;</span></div>
<div class="line">struct = <span class="keywordtype">None</span></div>
<div class="line"> </div>
<div class="line"><span class="comment"># SAM (RF00162)</span></div>
<div class="line"><span class="comment">#&gt;AP006840.1:c2688754-2688649 Symbiobacterium thermophilum IAM 14863 DNA, complete genome</span></div>
<div class="line"><span class="comment">#GGUUCAUCGAGAGUGGCGGAGGGACUGGCCCCAUGAUGCCACGGCAACCUCUCCCGCGGGGAGAACGGUGCCAAAUCCAGCGGACACUCGGUCCGAGAGAUGAAGC</span></div>
<div class="line">seq    = <span class="stringliteral">&quot;GGUUCAUCGAGAGUGGCGGAGGGACUGGCCCCAUGAUGCCACGGCAACCUCUCCCGCGGGGAGAACGGUGCCAAAUCCAGCGGACACUCGGUCCGAGAGAUGAAGC&quot;</span></div>
<div class="line">struct = <span class="stringliteral">&quot;(.((((((....((((((..(((.[[[[.)))....))))))((((.((((((((...))))))..))))))....]]]](((((.....)))))...)))))).)&quot;</span></div>
<div class="line">print(<span class="stringliteral">&quot;Sequence length&quot;</span>,len(seq))</div>
</div><!-- fragment --> <pre class="fragment">Sequence length 106
</pre><p>Obtain target frequencies from the sequence; print the counts</p>
<div class="fragment"><div class="line">tgtfreqs = Counter(seq[i]+seq[i+1] <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(len(seq)-1))</div>
<div class="line">print(tgtfreqs)</div>
</div><!-- fragment --> <pre class="fragment">Counter({'GG': 13, 'GA': 12, 'CC': 10, 'CG': 9, 'AG': 8, 'GC': 8, 'UC': 7, 'CA': 7, 'UG': 6, 'AC': 6, 'AU': 5, 'AA': 5, 'GU': 4, 'CU': 4, 'UU': 1})
</pre><h1><a class="anchor" id="autotoc_md148"></a>
Feature network model for the design task</h1>
<h1><a class="anchor" id="autotoc_md149"></a>
Generate model</h1>
<p>The model consists of</p>
<ul>
<li>\(n\) (sequence length) many variables, each with domains 0..3 (enconding the nucleotides);</li>
<li>constraints to guarantee compatibility with the given structure;</li>
<li>functions counting the different dinucleotides; defining one feature per dimer.</li>
</ul>
<div class="fragment"><div class="line">n = len(seq)</div>
<div class="line">model = ir.Model(n,4)</div>
<div class="line"> </div>
<div class="line"><span class="comment"># complementarity constraints</span></div>
<div class="line"><span class="keywordflow">if</span> struct <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line">    model.add_constraints(rna.BPComp(*bp) <span class="keywordflow">for</span> bp <span class="keywordflow">in</span> rna.parse(struct))</div>
<div class="line"> </div>
<div class="line"><span class="comment"># dinucleotide frequency functions</span></div>
<div class="line"><span class="keywordflow">for</span> dimer <span class="keywordflow">in</span> dimers:</div>
<div class="line">    model.add_functions([DinuclFreq(i,dimer) <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(n-1)],dimer)</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md150"></a>
Draw samples (without targeting)</h1>
<p>This is mainly done, to check run-times for generating a number of samples (as is done by the multi-dimensional Boltzmann sampling strategy in every iteration). As well report the treewidth of the network (as determined by the sampler).</p>
<div class="fragment"><div class="line">nsamples=100</div>
<div class="line">sampler = report_time(<span class="keyword">lambda</span>:ir.Sampler(model,lazy=<span class="keyword">False</span>),<span class="stringliteral">&#39;Construction&#39;</span>)</div>
<div class="line">print(<span class="stringliteral">&quot;Treewidth:&quot;</span>,sampler.treewidth())</div>
<div class="line">_ = report_time(<span class="keyword">lambda</span>:[rna.ass_to_seq(sampler.sample()) <span class="keywordflow">for</span> _ <span class="keywordflow">in</span> range(n)],<span class="stringliteral">&#39;Sampling&#39;</span>)</div>
</div><!-- fragment --> <pre class="fragment">Time (Construction): 0.76s
Treewidth: 4
Time (Sampling): 0.03s
</pre><h1><a class="anchor" id="autotoc_md151"></a>
Draw targeted samples</h1>
<p>Generate sampler, set parameters for the multi-dimensional Boltzmann sampling strategy and set the targets.</p>
<div class="fragment"><div class="line">sampler = ir.Sampler(model,lazy=<span class="keyword">True</span>)</div>
<div class="line">sampler.samples_per_round = 200</div>
<div class="line">sampler.tweak_factor = 0.05</div>
<div class="line"> </div>
<div class="line">tolerance = 2</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">for</span> dimer <span class="keywordflow">in</span> dimers:</div>
<div class="line">    sampler.set_target(tgtfreqs[dimer],tolerance=tolerance,featureid=dimer)</div>
</div><!-- fragment --><div class="fragment"><div class="line"><span class="comment"># collect some statistics</span></div>
<div class="line"><span class="keyword">def </span>callback(total,accepted,fstats):</div>
<div class="line">    rmsd = sampler.rmsd(fstats.means(),sampler.model.features)</div>
<div class="line">    the_statistics.append({<span class="stringliteral">&#39;samples&#39;</span>:total, <span class="stringliteral">&#39;rmsd&#39;</span>:rmsd, <span class="stringliteral">&#39;accepted&#39;</span>:accepted})</div>
<div class="line">    <span class="comment">#print(fstats.report(),rmsd)</span></div>
<div class="line">    </div>
<div class="line">sampler.callback = callback</div>
</div><!-- fragment --><p>Actually, draw the targeted samples (and stop run time.)</p>
<div class="fragment"><div class="line">sampler.verbose = <span class="keyword">False</span></div>
<div class="line"> </div>
<div class="line">the_statistics = list()</div>
<div class="line">the_samples = list() </div>
<div class="line"> </div>
<div class="line">print_samples = <span class="keywordtype">None</span></div>
<div class="line"> </div>
<div class="line">stats = ir.FeatureStatistics()</div>
<div class="line"><span class="keyword">def </span>draw_samples(n):</div>
<div class="line">    <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(n):</div>
<div class="line">        sample = sampler.targeted_sample()</div>
<div class="line">        feature_values = {dimer:model.eval_feature(sample,dimer) <span class="keywordflow">for</span> dimer <span class="keywordflow">in</span> dimers}</div>
<div class="line">        stats.record_features(model.features,feature_values)</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> print_samples:</div>
<div class="line">            line = rna.ass_to_seq(sample)</div>
<div class="line">            <span class="keywordflow">for</span> dimer,freq <span class="keywordflow">in</span> feature_values.items(): line += f<span class="stringliteral">&quot; {dimer}:{freq}&quot;</span></div>
<div class="line">            <span class="keywordflow">if</span> type(print_samples)!=int <span class="keywordflow">or</span> (i+1)%print_samples==0: </div>
<div class="line">                print(i+1, line)</div>
<div class="line">        the_samples.append(sample)</div>
<div class="line">        </div>
<div class="line">report_time(<span class="keyword">lambda</span>:draw_samples(1000))</div>
</div><!-- fragment --> <pre class="fragment">Time: 309.44s
</pre><p>Finally, report some statistics and learned weights</p>
<div class="fragment"><div class="line">print(<span class="stringliteral">&quot;Targets&quot;</span>,[f<span class="stringliteral">&quot;{dimer}:{tgtfreqs[dimer]}&quot;</span> <span class="keywordflow">for</span> dimer <span class="keywordflow">in</span> dimers])</div>
<div class="line">print(<span class="stringliteral">&quot;Stats  &quot;</span>,stats.report())</div>
<div class="line">print(<span class="stringliteral">&quot;Weights&quot;</span>,{k:f<span class="stringliteral">&#39;{f.weight:.3f}&#39;</span> <span class="keywordflow">for</span> k,f <span class="keywordflow">in</span> sampler.model.features.items()})    </div>
</div><!-- fragment --> <pre class="fragment">Targets ['AA:5', 'AC:6', 'AG:8', 'AU:5', 'CA:7', 'CC:10', 'CG:9', 'CU:4', 'GA:12', 'GC:8', 'GG:13', 'GU:4', 'UA:0', 'UC:7', 'UG:6', 'UU:1']
Stats   AA=4.82 +/-1.32 AC=5.92 +/-1.22 AG=8.19 +/-1.26 AU=5.08 +/-1.24 CA=7.03 +/-1.24 CC=10.03 +/-1.34 CG=9.11 +/-1.25 CU=4.15 +/-1.17 GA=11.88 +/-1.23 GC=7.77 +/-1.30 GG=12.94 +/-1.38 GU=3.88 +/-1.16 UA=0.35 +/-0.58 UC=6.86 +/-1.17 UG=5.90 +/-1.23 UU=1.11 +/-0.95
Weights {'AA': '0.835', 'AC': '0.516', 'AG': '0.402', 'AU': '-0.121', 'CA': '0.777', 'CC': '0.419', 'CG': '-0.080', 'CU': '-0.936', 'GA': '1.560', 'GC': '0.522', 'GG': '0.414', 'GU': '-0.678', 'UA': '-1.588', 'UC': '0.097', 'UG': '-0.194', 'UU': '-1.943'}
</pre><h1><a class="anchor" id="autotoc_md152"></a>
Plots sampling effectivity</h1>
<div class="fragment"><div class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</div>
<div class="line"><span class="keyword">import</span> seaborn <span class="keyword">as</span> sns</div>
<div class="line"> </div>
<div class="line">fig, (ax1, ax2) = plt.subplots(2, 1, figsize=(2.5,5))</div>
<div class="line"> </div>
<div class="line">sns.scatterplot(x=[row[<span class="stringliteral">&#39;samples&#39;</span>] <span class="keywordflow">for</span> row <span class="keywordflow">in</span> the_statistics], y=[100*row[<span class="stringliteral">&#39;accepted&#39;</span>]/row[<span class="stringliteral">&#39;samples&#39;</span>] <span class="keywordflow">for</span> row <span class="keywordflow">in</span> the_statistics],ax=ax1)</div>
<div class="line">ax1.set_ylabel(<span class="stringliteral">&quot;Accepted percentage&quot;</span>)</div>
<div class="line"><span class="comment">#sns.scatterplot(x=[row[&#39;samples&#39;] for row in the_statistics], y=[row[&#39;accepted&#39;] for row in the_statistics],ax=ax1)</span></div>
<div class="line"><span class="comment">#ax1.set_ylabel(&quot;Accepted samples&quot;)</span></div>
<div class="line">sns.scatterplot(x=[row[<span class="stringliteral">&#39;samples&#39;</span>] <span class="keywordflow">for</span> row <span class="keywordflow">in</span> the_statistics], y=[row[<span class="stringliteral">&#39;rmsd&#39;</span>] <span class="keywordflow">for</span> row <span class="keywordflow">in</span> the_statistics],ax=ax2)</div>
<div class="line">ax2.set_xlabel(<span class="stringliteral">&quot;Total samples&quot;</span>)</div>
<div class="line">ax2.set_ylabel(<span class="stringliteral">&quot;RMSD&quot;</span>)</div>
<div class="line">fig.tight_layout()</div>
<div class="line">plt.savefig(<span class="stringliteral">&#39;mdbs_run.pdf&#39;</span>)</div>
<div class="line">plt.show()</div>
</div><!-- fragment --><p><img src="MultiDimensionalBoltzmannSampling_files/MultiDimensionalBoltzmannSampling_27_0.png" alt="png" class="inline"/></p>
<h1><a class="anchor" id="autotoc_md153"></a>
Distribution plots</h1>
<div class="fragment"><div class="line"><span class="keyword">import</span> math</div>
<div class="line"><span class="keyword">def </span>distribution_heatmaps(model,n,feature_list,fig,*,limits,labels=None,targets=None,ax=None,cmap=&quot;Blues&quot;):</div>
<div class="line">    sampler = ir.Sampler(model)</div>
<div class="line">    samples = [sampler.sample() <span class="keywordflow">for</span> _ <span class="keywordflow">in</span> range(n)]</div>
<div class="line">    </div>
<div class="line">    <span class="keyword">def </span>eval_features(sample):</div>
<div class="line">        <span class="keywordflow">return</span> {f:model.eval_feature(sample,f) <span class="keywordflow">for</span> f <span class="keywordflow">in</span> feature_list}</div>
<div class="line">    </div>
<div class="line">    features = [eval_features(sample) <span class="keywordflow">for</span> sample <span class="keywordflow">in</span> samples]</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> labels <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line">        labels = feature_list</div>
<div class="line">    </div>
<div class="line">    k = len(feature_list)</div>
<div class="line">    </div>
<div class="line">    the_plots = [(i,j) <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(1,k) <span class="keywordflow">for</span> j <span class="keywordflow">in</span> range(0,i)]</div>
<div class="line">    nplots = len(the_plots)</div>
<div class="line">    dimx = int(math.sqrt(nplots))</div>
<div class="line">    dimy = nplots // dimx</div>
<div class="line">    </div>
<div class="line">    the_cells = [(i,j) <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(0,dimx) <span class="keywordflow">for</span> j <span class="keywordflow">in</span> range(0,dimy)]</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">if</span> ax <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line">        ax = fig.subplots(dimx,dimy+1,</div>
<div class="line">                          squeeze=<span class="keyword">False</span>,</div>
<div class="line">                          width_ratios=[1]*dimy+[1]</div>
<div class="line">                         )</div>
<div class="line">            <span class="comment">#sharex=True, sharey=True)</span></div>
<div class="line">            </div>
<div class="line">    <span class="keywordflow">for</span> x <span class="keywordflow">in</span> range(dimx):</div>
<div class="line">        <span class="keywordflow">for</span> y <span class="keywordflow">in</span> range(dimy+1):</div>
<div class="line">            <span class="keywordflow">if</span> (x,y) <span class="keywordflow">not</span> <span class="keywordflow">in</span> the_cells[:nplots]:</div>
<div class="line">                ax[x][y].axis(<span class="stringliteral">&quot;off&quot;</span>)</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> idx,(i,j) <span class="keywordflow">in</span> enumerate(the_plots):</div>
<div class="line"> </div>
<div class="line">        fi = feature_list[i]</div>
<div class="line">        fj = feature_list[j]</div>
<div class="line">        </div>
<div class="line">        cax = ax[the_cells[idx][0]][the_cells[idx][1]]</div>
<div class="line">        </div>
<div class="line">        sns.kdeplot(x=[f[fj] <span class="keywordflow">for</span> f <span class="keywordflow">in</span> features],y=[f[fi] <span class="keywordflow">for</span> f <span class="keywordflow">in</span> features], ax = cax,</div>
<div class="line">                cmap=cmap, levels=8, thresh=0.2, cbar = <span class="keyword">False</span>, fill=<span class="keyword">True</span>)</div>
<div class="line">        <span class="keywordflow">if</span> targets:</div>
<div class="line">            cax.axhline(y = targets[fi], color = <span class="stringliteral">&#39;red&#39;</span>, linestyle = <span class="stringliteral">&#39;dashed&#39;</span>)</div>
<div class="line">            cax.axvline(x = targets[fj], color = <span class="stringliteral">&#39;red&#39;</span>, linestyle = <span class="stringliteral">&#39;dashed&#39;</span>)</div>
<div class="line"> </div>
<div class="line">        cax.set_ylabel(labels[i])</div>
<div class="line">        cax.set_xlabel(labels[j])</div>
<div class="line"> </div>
<div class="line">        cax.set_ylim(limits[i])</div>
<div class="line">        cax.set_xlim(limits[j])</div>
<div class="line"> </div>
<div class="line">    plt.colorbar(plt.cm.ScalarMappable(cmap=cmap),ax=ax[0][dimy],</div>
<div class="line">        pad=0.4,</div>
<div class="line">        location=<span class="stringliteral">&quot;left&quot;</span>,</div>
<div class="line">        boundaries=[0.2+i/10 <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(9)],</div>
<div class="line">        values=[i/8 <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(1,9)])</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">return</span> ax</div>
</div><!-- fragment --><div class="fragment"><div class="line">sel_dimers = dimers <span class="comment">#[&quot;CC&quot;,&quot;GU&quot;, &quot;GG&quot;, &quot;UU&quot;]</span></div>
<div class="line"> </div>
<div class="line">limits=[(-0.5,18)]*len(sel_dimers)</div>
<div class="line"> </div>
<div class="line">n = 500</div>
<div class="line"> </div>
<div class="line">k=len(sel_dimers)</div>
<div class="line"> </div>
<div class="line"><span class="comment">#fig = plt.figure(figsize=(10,5))</span></div>
<div class="line">fig = plt.figure(figsize=(20,16))</div>
<div class="line"> </div>
<div class="line">ax = distribution_heatmaps(model,n,sel_dimers,fig,limits=limits,cmap=<span class="stringliteral">&quot;Blues&quot;</span>)</div>
<div class="line">distribution_heatmaps(sampler.model,n,sel_dimers,fig,limits=limits,</div>
<div class="line">                      targets=tgtfreqs,</div>
<div class="line">                      ax=ax,cmap=<span class="stringliteral">&quot;Reds&quot;</span>)</div>
<div class="line">fig.tight_layout()</div>
<div class="line">plt.savefig(<span class="stringliteral">&#39;mdbs_heatmaps.pdf&#39;</span>)</div>
<div class="line">plt.show()</div>
</div><!-- fragment --><p><img src="MultiDimensionalBoltzmannSampling_files/MultiDimensionalBoltzmannSampling_30_0.png" alt="png" class="inline"/> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.7 </li>
  </ul>
</div>
</body>
</html>
